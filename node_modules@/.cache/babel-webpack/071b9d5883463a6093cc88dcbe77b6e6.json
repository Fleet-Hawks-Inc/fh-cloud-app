{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./summary.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./summary.component.css\";\nimport { Component, Input, ViewChild } from '@angular/core';\nimport { HttpClient } from \"@angular/common/http\";\nimport { ApiService, HereMapService } from 'src/app/services';\nimport { environment } from 'src/environments/environment';\nimport Constants from 'src/app/pages/fleet/constants';\nimport { ToastrService } from 'ngx-toastr';\nimport * as moment from 'moment';\nimport { NgxSpinnerService } from 'ngx-spinner';\nimport * as _ from 'lodash';\nimport { NgSelectComponent } from \"@ng-select/ng-select\";\nimport { Router } from '@angular/router';\nlet SummaryComponent = class SummaryComponent {\n  constructor(apiService, httpClient, router, toastr, hereMap, spinner) {\n    var _this = this;\n\n    this.apiService = apiService;\n    this.httpClient = httpClient;\n    this.router = router;\n    this.toastr = toastr;\n    this.hereMap = hereMap;\n    this.spinner = spinner;\n    this.environment = environment.isFeatureEnabled;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.vehicles = [];\n    this.title = \"Driver List\";\n    this.vehicleIdentification = '';\n    this.suggestedVehicles = [];\n    this.vehicleManufacturersList = {};\n    this.vehicleModelList = {};\n    this.modelID = {};\n    this.exportList = [];\n    this.manufacturerID = {};\n    this.createdTime = {};\n    this.vehicleType = {};\n    this.inActiveVehiclesCount = 0;\n    this.activeVehiclesCount = 0;\n    this.soldVehiclesCount = 0;\n    this.currentStatus = null;\n    this.totalVehicleCount = 0;\n    this.lastItemSK = '';\n    this.loaded = false;\n    this.vehiclesCount = {\n      total: '',\n      active: '',\n      inactive: '',\n      sold: ''\n    };\n    this.mapView = false;\n    this.listView = true;\n    this.visible = true;\n    this.loadMsg = Constants.NO_LOAD_DATA;\n    this.isSearch = false;\n    this.get = _.get;\n    this.currentView = 'list';\n    this.dataColumns = [{\n      width: '8%',\n      field: 'vehicleIdentification',\n      header: 'Vehicle Name/Number',\n      type: \"text\"\n    }, {\n      width: '6%',\n      field: 'VIN',\n      header: 'VIN',\n      type: \"text\"\n    }, {\n      width: '5%',\n      field: 'year',\n      header: 'Year',\n      type: \"text\"\n    }, {\n      width: '5%',\n      field: 'manufacturerID',\n      header: 'Make',\n      type: \"text\"\n    }, {\n      width: '5%',\n      field: 'modelID',\n      header: 'Model',\n      type: \"text\"\n    }, {\n      width: '9%',\n      field: 'vehicleType',\n      header: 'Type',\n      type: \"text\"\n    }, {\n      width: '7%',\n      field: 'ownership',\n      header: 'Ownership',\n      type: \"text\"\n    }, {\n      width: '7%',\n      field: 'plateNumber',\n      header: 'Plate Number',\n      type: \"text\"\n    }, {\n      width: '5%',\n      field: 'currentStatus',\n      header: 'Status',\n      type: 'text'\n    }];\n\n    this.onScroll = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (event) {\n        if (_this.loaded) {\n          _this.getVehiclePage();\n        }\n\n        _this.loaded = false;\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    this.getSuggestions = _.debounce(function (value) {\n      value = value.toLowerCase();\n\n      if (value != '') {\n        this.apiService.getData(`vehicles/suggestion/${value}`).subscribe(result => {\n          this.suggestedVehicles = result;\n        });\n      } else {\n        this.suggestedVehicles = [];\n      }\n    }, 800);\n  }\n\n  ngOnInit() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      _this2.getVehiclePage();\n\n      _this2.fetchVehiclesCount();\n\n      _this2.setToggleOptions();\n    })();\n  }\n\n  getVehiclePage(refresh) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (refresh === true) {\n        _this3.lastItemSK = '';\n        _this3.vehicles = [];\n      }\n\n      if (_this3.lastItemSK !== 'end') {\n        const result = yield _this3.apiService.getData(`vehicles/fetch/summary/list?name=${_this3.vehicleIdentification}&currentStatus=${_this3.currentStatus}&lastKey=${_this3.lastItemSK}`).toPromise();\n\n        if (result.Items.length === 0) {\n          _this3.dataMessage = Constants.NO_RECORDS_FOUND;\n        }\n\n        _this3.suggestedVehicles = [];\n\n        if (result.Items.length > 0) {\n          if (result.LastEvaluatedKey !== undefined) {\n            _this3.lastItemSK = encodeURIComponent(result.Items[result.Items.length - 1].vehicleSK);\n          } else {\n            _this3.lastItemSK = 'end';\n          }\n\n          _this3.vehicles = _this3.vehicles.concat(result.Items);\n          _this3.loaded = true;\n        }\n      }\n    })();\n  }\n\n  fetchVehiclesCount() {\n    this.apiService.getData('vehicles/fetch/vehicleCount').subscribe(result => {\n      this.vehiclesCount = result;\n    });\n  }\n\n  setVehicle(vehicleID, vehicleIdentification) {\n    this.vehicleIdentification = vehicleIdentification;\n    this.vehicleID = vehicleIdentification;\n    this.suggestedVehicles = [];\n  }\n\n  searchVehicle() {\n    if (this.vehicleIdentification !== '' || this.currentStatus !== null) {\n      this.vehicleIdentification = this.vehicleIdentification.toLowerCase();\n      this.currentStatus = this.currentStatus;\n      this.vehicles = [];\n      this.lastItemSK = '';\n      this.dataMessage = Constants.FETCHING_DATA;\n      this.suggestedVehicles = [];\n      this.getVehiclePage();\n    } else {\n      return false;\n    }\n  }\n\n  resetVehicle() {\n    if (this.vehicleIdentification !== '' || this.currentStatus !== null || this.lastItemSK) {\n      this.vehicleIdentification = '';\n      this.currentStatus = null;\n      this.vehicles = [];\n      this.lastItemSK = '';\n      this.dataMessage = Constants.FETCHING_DATA;\n      this.suggestedVehicles = [];\n      this.getVehiclePage();\n    } else {\n      return false;\n    }\n  }\n\n  refreshData() {\n    this.vehicleID = '';\n    this.suggestedVehicles = [];\n    this.vehicleIdentification = '';\n    this.currentStatus = null;\n    this.vehicles = [];\n    this.lastItemSK = '';\n    this.loaded = false;\n    this.getVehiclePage();\n    this.dataMessage = Constants.FETCHING_DATA;\n  }\n\n  setToggleOptions() {\n    this.selectedColumns = this.dataColumns;\n  }\n\n  get selectedColumns() {\n    return this._selectedColumns;\n  }\n\n  set selectedColumns(val) {\n    //restore original order\n    this._selectedColumns = this.dataColumns.filter(col => val.includes(col));\n  }\n\n  generateVehicleCSV() {\n    if (this.exportList.length > 0) {\n      let dataObject = [];\n      let csvArray = [];\n      this.exportList.forEach(element => {\n        let obj = {};\n        obj[\"Vehicle Name\"] = element.vehicleIdentification;\n        obj[\"VIN#\"] = element.VIN;\n        obj[\"Year\"] = element.year;\n        obj[\"Make\"] = element.manufacturerID;\n        obj[\"Model\"] = element.modelID ? element.modelID : '-';\n        obj[\"Type\"] = element.vehicleType;\n        obj[\"Plate#\"] = element.plateNumber;\n        obj[\"Ownership\"] = element.ownership ? element.ownership : '-';\n        obj[\"Status\"] = element.currentStatus;\n        dataObject.push(obj);\n      });\n      let headers = Object.keys(dataObject[0]).join(',');\n      headers += '\\n';\n      csvArray.push(headers);\n      dataObject.forEach(element => {\n        let obj = Object.values(element).join(',');\n        obj += '\\n';\n        csvArray.push(obj);\n      });\n      const blob = new Blob(csvArray, {\n        type: 'text/csv;charset=utf-8;'\n      });\n      const link = document.createElement('a');\n\n      if (link.download !== undefined) {\n        const url = URL.createObjectURL(blob);\n        link.setAttribute('href', url);\n        link.setAttribute('download', `${moment().format(\"YYYY-MM-DD:HH:m\")}Vehicle-Report.csv`);\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n      }\n    } else {\n      this.toastr.error(\"No Records found\");\n    }\n  }\n\n  changeView() {\n    if (this.currentView == 'list') {\n      this.currentView = 'map';\n      setTimeout(() => {\n        this.hereMap.mapInit();\n      }, 500);\n    } else {\n      this.currentView = 'list';\n    }\n  }\n\n  vehicleExport() {\n    this.apiService.getData(`vehicles/fetch/export`).subscribe(result => {\n      this.exportList = result.Items;\n      this.generateVehicleCSV();\n    });\n  }\n\n  csvExport() {\n    if (this.vehicleIdentification !== '' || this.currentStatus !== null) {\n      this.exportList = this.vehicles;\n      this.generateVehicleCSV();\n    } else {\n      this.vehicleExport();\n    }\n  }\n\n  clearVideoTimeout() {\n    clearTimeout(this.liveModalTimeout);\n  }\n\n  clear(table) {\n    table.clear();\n  }\n\n};\n\nSummaryComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: HttpClient\n}, {\n  type: Router\n}, {\n  type: ToastrService\n}, {\n  type: HereMapService\n}, {\n  type: NgxSpinnerService\n}];\n\nSummaryComponent.propDecorators = {\n  table: [{\n    type: ViewChild,\n    args: ['dt']\n  }],\n  ngSelectComponent: [{\n    type: ViewChild,\n    args: [NgSelectComponent]\n  }],\n  selectedColumns: [{\n    type: Input\n  }]\n};\nSummaryComponent = __decorate([Component({\n  selector: 'app-summary',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], SummaryComponent);\nexport { SummaryComponent };","map":null,"metadata":{},"sourceType":"module"}