{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./settlements-list.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./settlements-list.component.css\";\nimport { Component } from \"@angular/core\";\nimport { ToastrService } from \"ngx-toastr\";\nimport { AccountService, DashboardUtilityService } from \"src/app/services\";\nimport { ApiService } from \"src/app/services/api.service\";\nimport Constants from \"../../../fleet/constants\";\nlet SettlementsListComponent = class SettlementsListComponent {\n  constructor(apiService, accountService, toaster, dashboardUtilityService) {\n    this.apiService = apiService;\n    this.accountService = accountService;\n    this.toaster = toaster;\n    this.dashboardUtilityService = dashboardUtilityService;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.settlements = [];\n    this.dateMinLimit = {\n      year: 1950,\n      month: 1,\n      day: 1\n    };\n    this.date = new Date();\n    this.futureDatesLimit = {\n      year: this.date.getFullYear() + 30,\n      month: 12,\n      day: 31\n    };\n    this.filter = {\n      searchValue: null,\n      startDate: null,\n      endDate: null,\n      type: null\n    };\n    this.lastItemSK = \"\";\n    this.loaded = false;\n    this.disableSearch = false;\n    this.driversObject = {};\n    this.carriersObject = {};\n    this.ownerOpObjects = {};\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.fetchSettlements();\n\n      _this.driversObject = yield _this.dashboardUtilityService.getDrivers();\n      _this.carriersObject = yield _this.dashboardUtilityService.getContactsCarriers();\n      _this.ownerOpObjects = yield _this.dashboardUtilityService.getOwnerOperators();\n    })();\n  }\n\n  unitTypeChange() {\n    this.filter.searchValue = null;\n  }\n\n  fetchSettlements(refresh) {\n    let searchParam = null;\n\n    if (refresh === true) {\n      this.lastItemSK = \"\";\n      this.settlements = [];\n    }\n\n    if (this.lastItemSK !== \"end\") {\n      if (this.filter.searchValue !== null && this.filter.searchValue !== \"\") {\n        searchParam = this.filter.type === 'settlementNo' ? encodeURIComponent(`\"${this.filter.searchValue}\"`) : `${this.filter.searchValue}`;\n      } else {\n        searchParam = null;\n      }\n\n      this.accountService.getData(`settlement/paging?type=${this.filter.type}&searchValue=${searchParam}&startDate=${this.filter.startDate}&endDate=${this.filter.endDate}&lastKey=${this.lastItemSK}`).subscribe(result => {\n        if (result.length === 0) {\n          this.dataMessage = Constants.NO_RECORDS_FOUND;\n          this.disableSearch = false;\n        }\n\n        if (result.length > 0) {\n          this.disableSearch = false;\n\n          if (result[result.length - 1].sk !== undefined) {\n            this.lastItemSK = encodeURIComponent(result[result.length - 1].sk);\n          } else {\n            this.lastItemSK = \"end\";\n          }\n\n          result.map(v => {\n            v.url = `/accounts/settlements/detail/${v.sttlID}`;\n            v.entityType = v.type.replace(\"_\", \" \");\n            v.status = v.status.replace(\"_\", \" \");\n\n            if (v.status == undefined) {\n              v.status = \"unpaid\";\n            }\n\n            v.paidAmount = v.finalTotal - v.pendingPayment;\n            v.paidAmount = v.paidAmount.toFixed(2);\n            this.settlements.push(v);\n          });\n          this.loaded = true;\n        }\n      }, err => {\n        this.disableSearch = false;\n      });\n    }\n  }\n\n  searchFilter() {\n    if (this.filter.type !== null || this.filter.searchValue !== null || this.filter.endDate !== null || this.filter.startDate !== null) {\n      this.disableSearch = true; // if (this.filter.type != '' && (this.filter.searchValue == null || this.filter.searchValue == '')) {\n      //   this.toaster.error(\"Please select any value\");\n      //   this.disableSearch = false;\n      //   return false;\n      // }\n\n      if (this.filter.startDate != \"\" && this.filter.endDate == \"\") {\n        this.toaster.error(\"Please select both start and end dates.\");\n        this.disableSearch = false;\n        return false;\n      } else if (this.filter.startDate == \"\" && this.filter.endDate != \"\") {\n        this.toaster.error(\"Please select both start and end dates.\");\n        this.disableSearch = false;\n        return false;\n      } else if (this.filter.startDate > this.filter.endDate) {\n        this.toaster.error(\"Start date should be less then end date\");\n        this.disableSearch = false;\n        return false;\n      } else {\n        this.dataMessage = Constants.FETCHING_DATA;\n        this.settlements = [];\n        this.lastItemSK = \"\";\n        this.fetchSettlements();\n      }\n    }\n  }\n\n  resetFilter() {\n    this.disableSearch = true;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.filter = {\n      searchValue: null,\n      startDate: null,\n      endDate: null,\n      type: null\n    };\n    this.settlements = [];\n    this.lastItemSK = \"\";\n    this.fetchSettlements();\n  }\n\n  deleteSettlement(settlementID) {\n    if (confirm(\"Are you sure you want to delete?\") === true) {\n      this.accountService.deleteData(`settlement/delete/${settlementID}`).subscribe(result => {\n        this.lastItemSK = \"\";\n        this.settlements = [];\n        this.fetchSettlements();\n        this.toaster.success(\"Settlement deleted successfully.\");\n      });\n    }\n  }\n\n  onScroll() {\n    if (this.loaded) {\n      this.filter = {\n        searchValue: null,\n        startDate: null,\n        endDate: null,\n        type: null\n      };\n      this.fetchSettlements();\n    }\n\n    this.loaded = false;\n  }\n\n  refreshData() {\n    this.disableSearch = true;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.filter = {\n      searchValue: null,\n      startDate: null,\n      endDate: null,\n      type: null\n    };\n    this.settlements = [];\n    this.lastItemSK = \"\";\n    this.fetchSettlements();\n  }\n\n};\n\nSettlementsListComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: AccountService\n}, {\n  type: ToastrService\n}, {\n  type: DashboardUtilityService\n}];\n\nSettlementsListComponent = __decorate([Component({\n  selector: \"app-settlements-list\",\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], SettlementsListComponent);\nexport { SettlementsListComponent };","map":null,"metadata":{},"sourceType":"module"}