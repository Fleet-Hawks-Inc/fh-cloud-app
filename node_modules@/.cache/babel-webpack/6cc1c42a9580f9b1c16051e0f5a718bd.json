{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./vendor-payment-detail.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./vendor-payment-detail.component.css\";\nimport { Component, ViewChild } from \"@angular/core\";\nimport { ActivatedRoute } from \"@angular/router\";\nimport Constants from \"src/app/pages/fleet/constants\";\nimport { AccountService, ApiService, ListService } from \"src/app/services\";\nimport { NgbModal } from \"@ng-bootstrap/ng-bootstrap\";\nimport * as html2pdf from \"html2pdf.js\";\nlet VendorPaymentDetailComponent = class VendorPaymentDetailComponent {\n  constructor(apiService, accountService, route, listService, modalService) {\n    this.apiService = apiService;\n    this.accountService = accountService;\n    this.route = route;\n    this.listService = listService;\n    this.modalService = modalService;\n    this.dataMessage = Constants.NO_RECORDS_FOUND;\n    this.paymentData = {\n      paymentNo: \"\",\n      txnDate: null,\n      vendorID: null,\n      refNo: \"\",\n      currency: \"CAD\",\n      accountID: null,\n      payMode: null,\n      payModeNo: \"\",\n      payModeDate: null,\n      billIds: [],\n      billData: [],\n      advIds: [],\n      advData: [],\n      total: {\n        subTotal: 0,\n        advTotal: 0,\n        finalTotal: 0\n      },\n      transactionLog: []\n    };\n    this.vendorName = \"\";\n    this.bills = {};\n    this.downloadDisabled = true;\n    this.downloadDisabledpdf = true;\n    this.showModal = false;\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.paymentID = _this.route.snapshot.params[\"paymentID\"];\n      yield _this.fetchPayments();\n\n      _this.fetchVendor();\n\n      _this.fetchBills();\n    })();\n  }\n\n  fetchPayments() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this2.accountService.getData(`purchase-payments/details/${_this2.paymentID}`).toPromise();\n      _this2.downloadDisabled = false;\n      _this2.downloadDisabledpdf = false;\n      _this2.paymentData = result[0];\n      _this2.pendingAmt = _this2.paymentData.total.finalTotal - _this2.paymentData.total.advTotal;\n      _this2.companyLogo = result[0].carrierDtl.logo;\n      _this2.tagLine = result[0].carrierDtl.tagLine;\n      _this2.carrierName = result[0].carrierDtl.carrierName;\n      _this2.paymentData.payMode = _this2.paymentData.payMode.replace(\"_\", \" \");\n    })();\n  }\n\n  fetchVendor() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this3.apiService.getData(`contacts/minor/detail/${_this3.paymentData.vendorID}`).toPromise();\n\n      if (result.Items.length > 0) {\n        _this3.vendorName = result.Items[0].cName;\n      }\n    })();\n  }\n\n  fetchBills() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this4.accountService.getData(`bills/get/list`).toPromise();\n      _this4.bills = result;\n    })();\n  }\n\n  showCheque() {\n    this.showModal = true;\n    let obj = {\n      entityId: this.paymentData.vendorID,\n      chequeDate: this.paymentData.payModeDate,\n      chequeAmount: this.paymentData.total.finalTotal,\n      type: \"purchasePayment\",\n      paymentTo: 'vendor',\n      chequeNo: this.paymentData.payModeNo,\n      currency: this.paymentData.currency,\n      showModal: this.showModal,\n      fromDate: this.paymentData.txnDate,\n      finalAmount: this.paymentData.total.finalTotal,\n      txnDate: this.paymentData.txnDate,\n      page: \"detail\",\n      advance: this.paymentData.total.advTotal\n    };\n    this.listService.openPaymentChequeModal(obj);\n  }\n\n  openModal() {\n    let ngbModalOptions = {\n      keyboard: false,\n      backdrop: \"static\",\n      windowClass: \"preview-adv-pay\"\n    };\n    this.venPayRef = this.modalService.open(this.previewVenPayment, ngbModalOptions);\n  }\n\n  generatePaymentPDF() {\n    let data = document.getElementById(\"print-adv-pay\");\n    html2pdf(data, {\n      margin: 0.5,\n      pagebreak: {\n        mode: \"avoid-all\",\n        before: 'print-adv-pay'\n      },\n      filename: `advance-payment-${this.paymentData.paymentNo}.pdf`,\n      image: {\n        type: \"jpeg\",\n        quality: 0.98\n      },\n      html2canvas: {\n        scale: 2,\n        logging: true,\n        dpi: 192,\n        letterRendering: true,\n        allowTaint: true,\n        useCORS: true\n      },\n      jsPDF: {\n        unit: \"in\",\n        format: \"a4\",\n        orientation: \"portrait\"\n      }\n    });\n    this.venPayRef.close();\n    this.downloadDisabled = false;\n  }\n\n};\n\nVendorPaymentDetailComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: AccountService\n}, {\n  type: ActivatedRoute\n}, {\n  type: ListService\n}, {\n  type: NgbModal\n}];\n\nVendorPaymentDetailComponent.propDecorators = {\n  previewVenPayment: [{\n    type: ViewChild,\n    args: [\"previewVenPayment\", {\n      static: true\n    }]\n  }]\n};\nVendorPaymentDetailComponent = __decorate([Component({\n  selector: \"app-vendor-payment-detail\",\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], VendorPaymentDetailComponent);\nexport { VendorPaymentDetailComponent };","map":null,"metadata":{},"sourceType":"module"}