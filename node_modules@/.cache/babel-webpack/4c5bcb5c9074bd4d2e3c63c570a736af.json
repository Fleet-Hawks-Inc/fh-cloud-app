{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./device-list.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./device-list.component.css\";\nimport { Component, ViewChild, Input } from '@angular/core';\nimport { ApiService } from '../../../../services/api.service';\nimport { ToastrService } from 'ngx-toastr';\nimport Constants from '../../constants';\nimport { Router } from '@angular/router';\nimport * as _ from \"lodash\";\nlet DeviceListComponent = class DeviceListComponent {\n  constructor(apiService, toastr, router) {\n    this.apiService = apiService;\n    this.toastr = toastr;\n    this.router = router;\n    this.get = _.get;\n    this.loaded = false;\n    this.dataColumns = [{\n      width: '20%',\n      field: 'deviceType',\n      header: 'Type',\n      type: \"text\"\n    }, {\n      width: '20%',\n      field: 'deviceSerialNo',\n      header: 'Serial/IMEI',\n      type: \"text\"\n    }, {\n      width: '20%',\n      field: 'deviceName',\n      header: 'Device Name',\n      type: \"text\"\n    }, {\n      width: '20%',\n      field: 'Vehicle/Asset',\n      header: 'Vehicle/Asset',\n      type: \"text\"\n    }, {\n      width: '20%',\n      field: 'deviceStatus',\n      header: 'Status',\n      type: \"text\"\n    }];\n    this.next = 'null';\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.devices = [];\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.setToggleOptions();\n\n      _this.next = 'null';\n      _this.devices = [];\n      yield _this.fetchDevices();\n    })();\n  }\n\n  setToggleOptions() {\n    this.selectedColumns = this.dataColumns;\n  }\n\n  get selectedColumns() {\n    return this._selectedColumns;\n  }\n\n  set selectedColumns(val) {\n    //restore original order\n    this._selectedColumns = this.dataColumns.filter(col => val.includes(col));\n  }\n\n  refreshData() {\n    this.next = 'null';\n    this.devices = [];\n    this.fetchDevices();\n  }\n\n  fetchDevices() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      try {\n        if (_this2.next === 'end') {\n          return;\n        }\n\n        _this2.dataMessage = Constants.FETCHING_DATA;\n        const result = yield _this2.apiService.getData(`devices/getDevices/${_this2.next}`).toPromise();\n\n        if (result.data.length === 0) {\n          _this2.dataMessage = Constants.NO_RECORDS_FOUND;\n          _this2.loaded = true;\n        }\n\n        if (result && result.data.length > 0) {\n          result.data.forEach(device => {\n            let deviceItem = {\n              deviceName: device.deviceName,\n              deviceStatus: device.deviceStatus,\n              deviceSerialNo: device.deviceSerialNo,\n              description: device.description,\n              deviceType: device.deviceType,\n              deviceID: device.deviceID,\n              vehicle: {\n                vehicleID: '',\n                vehicleIdentification: ''\n              },\n              asset: {\n                assetID: '',\n                assetIdentification: ''\n              }\n            };\n\n            if (device.vehicleIdentification) {\n              deviceItem.vehicle.vehicleID = device.vehicleID;\n              deviceItem.vehicle.vehicleIdentification = device.vehicleIdentification;\n            }\n\n            if (device.assetIdentification) {\n              deviceItem.asset.assetID = device.assetID;\n              deviceItem.asset.assetIdentification = device.assetIdentification;\n            }\n\n            _this2.devices.push(deviceItem);\n          });\n          _this2.next = result.nextPage || 'end';\n        } else {\n          _this2.next = 'end';\n          _this2.dataMessage = Constants.NO_RECORDS_FOUND;\n        }\n\n        _this2.loaded = true;\n      } catch (error) {\n        _this2.dataMessage = Constants.NO_RECORDS_FOUND;\n        console.error(error);\n        throw new Error(error);\n      }\n    })();\n  }\n\n  deactivateDevice(devicesType, deviceID, activate) {\n    const confirmationText = activate == true ? 'activate' : 'deactivate';\n    const status = activate == true ? 'activated' : 'deactivated';\n\n    if (confirm(`Are you sure you want to ${confirmationText}?`) === true) {\n      try {\n        let body = {\n          deviceType: devicesType,\n          deviceID: deviceID,\n          activate: activate\n        };\n        this.apiService.putData(`devices/deactivate`, body).subscribe(result => {\n          if (result) {\n            this.devices = [];\n            this.next = 'null';\n            this.fetchDevices();\n            this.toastr.success(`Device ${status} Successfully`);\n          }\n        });\n      } catch (error) {\n        console.error(error);\n        throw new Error(error);\n      }\n    }\n  }\n\n  onScroll() {\n    if (this.loaded) {\n      this.fetchDevices();\n    }\n\n    this.loaded = false;\n  }\n\n  clear(table) {\n    table.clear();\n  }\n\n  gotoAssetTracker(device) {\n    this.router.navigate([`/fleet/tracking/asset-tracker/${device.asset.assetIdentification}`], {\n      queryParams: {\n        assetId: device.asset.assetID\n      }\n    });\n  }\n\n};\n\nDeviceListComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: ToastrService\n}, {\n  type: Router\n}];\n\nDeviceListComponent.propDecorators = {\n  table: [{\n    type: ViewChild,\n    args: ['dt']\n  }],\n  selectedColumns: [{\n    type: Input\n  }]\n};\nDeviceListComponent = __decorate([Component({\n  selector: 'app-device-list',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], DeviceListComponent);\nexport { DeviceListComponent };","map":null,"metadata":{},"sourceType":"module"}