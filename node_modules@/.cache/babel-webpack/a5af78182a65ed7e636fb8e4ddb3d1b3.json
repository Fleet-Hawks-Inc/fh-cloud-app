{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./vendor-credit-notes-list.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./vendor-credit-notes-list.component.css\";\nimport { Component } from \"@angular/core\";\nimport Constants from \"src/app/pages/fleet/constants\";\nimport { AccountService, ApiService } from \"src/app/services\";\nimport { ToastrService } from \"ngx-toastr\";\nlet VendorCreditNotesListComponent = class VendorCreditNotesListComponent {\n  constructor(accountService, apiService, toaster) {\n    this.accountService = accountService;\n    this.apiService = apiService;\n    this.toaster = toaster;\n    this.allCredits = [];\n    this.vendors = [];\n    this.lastItemSK = \"\";\n    this.isSearch = false;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.filterData = {\n      vendorID: null,\n      startDate: \"\",\n      endDate: \"\",\n      lastItemSK: \"\"\n    };\n    this.purchaseOrders = [];\n    this.loaded = false;\n  }\n\n  ngOnInit() {\n    this.fetchVendors();\n    this.fetchCredits();\n    this.fetchPurchaseOrders();\n  }\n\n  getCredits() {\n    this.accountService.getData(`vendor-credits`).subscribe(res => {\n      this.allCredits = res;\n    });\n  }\n\n  fetchVendors() {\n    this.apiService.getData(`contacts/get/list/vendor`).subscribe(result => {\n      this.vendors = result;\n    });\n  }\n\n  deleteCredit(creditID) {\n    if (confirm(\"Are you sure you want to delete?\") === true) {\n      this.accountService.deleteData(`vendor-credits/delete/${creditID}`).subscribe(res => {\n        if (res) {\n          this.getCredits();\n        }\n      });\n    }\n  }\n\n  fetchCredits(refresh) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (refresh === true) {\n        _this.lastItemSK = \"\";\n        _this.allCredits = [];\n      }\n\n      if (_this.lastItemSK !== \"end\") {\n        _this.accountService.getData(`vendor-credits/paging?vendor=${_this.filterData.vendorID}&startDate=${_this.filterData.startDate}&endDate=${_this.filterData.endDate}&lastKey=${_this.lastItemSK}`).subscribe( /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (result) {\n            if (result.length === 0) {\n              _this.isSearch = false;\n              _this.dataMessage = Constants.NO_RECORDS_FOUND;\n            }\n\n            if (result.length > 0) {\n              _this.isSearch = false;\n              result.map(v => {\n                v.status = v.status.replace(\"_\", \" \");\n\n                _this.allCredits.push(v);\n              });\n\n              if (_this.allCredits[_this.allCredits.length - 1].sk !== undefined) {\n                _this.lastItemSK = encodeURIComponent(_this.allCredits[_this.allCredits.length - 1].sk);\n              } else {\n                _this.lastItemSK = \"end\";\n              }\n\n              _this.loaded = true;\n            }\n          });\n\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }());\n      }\n    })();\n  }\n\n  onScroll() {\n    if (this.loaded) {\n      this.fetchCredits();\n    }\n\n    this.loaded = false;\n  }\n\n  searchCredits() {\n    if (this.filterData.vendorID !== \"\" || this.filterData.startDate !== \"\" || this.filterData.endDate !== \"\" || this.filterData.lastItemSK !== \"\") {\n      if (this.filterData.startDate !== \"\" && this.filterData.endDate === \"\") {\n        this.toaster.error(\"Please select both start and end dates.\");\n        return false;\n      } else if (this.filterData.startDate === \"\" && this.filterData.endDate !== \"\") {\n        this.toaster.error(\"Please select both start and end dates.\");\n        return false;\n      } else if (this.filterData.startDate > this.filterData.endDate) {\n        this.toaster.error(\"Start date should be less then end date\");\n        return false;\n      } else {\n        this.isSearch = true;\n        this.allCredits = [];\n        this.lastItemSK = \"\";\n        this.dataMessage = Constants.FETCHING_DATA;\n        this.fetchCredits();\n      }\n    }\n  }\n\n  resetFilter() {\n    this.isSearch = true;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.filterData = {\n      vendorID: null,\n      startDate: \"\",\n      endDate: \"\",\n      lastItemSK: \"\"\n    };\n    this.lastItemSK = \"\";\n    this.allCredits = [];\n    this.fetchCredits();\n  }\n\n  fetchPurchaseOrders() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this2.accountService.getData(`purchase-orders/get/list`).toPromise();\n      _this2.purchaseOrders = result;\n    })();\n  }\n\n};\n\nVendorCreditNotesListComponent.ctorParameters = () => [{\n  type: AccountService\n}, {\n  type: ApiService\n}, {\n  type: ToastrService\n}];\n\nVendorCreditNotesListComponent = __decorate([Component({\n  selector: \"app-vendor-credit-notes-list\",\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], VendorCreditNotesListComponent);\nexport { VendorCreditNotesListComponent };","map":null,"metadata":{},"sourceType":"module"}