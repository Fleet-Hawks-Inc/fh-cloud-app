{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./incident-detail.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./incident-detail.component.css\";\nimport { Component } from '@angular/core';\nimport { ApiService } from '../../../../services';\nimport { ToastrService } from 'ngx-toastr';\nimport { NgxSpinnerService } from 'ngx-spinner';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { HereMapService } from '../../../../services/here-map.service';\nimport { SafetyService } from 'src/app/services/safety.service';\nimport { DomSanitizer } from '@angular/platform-browser';\nlet IncidentDetailComponent = class IncidentDetailComponent {\n  constructor(apiService, domSanitizer, safetyService, toastr, spinner, router, route, hereMap) {\n    var _this = this;\n\n    this.apiService = apiService;\n    this.domSanitizer = domSanitizer;\n    this.safetyService = safetyService;\n    this.toastr = toastr;\n    this.spinner = spinner;\n    this.router = router;\n    this.route = route;\n    this.hereMap = hereMap;\n    this.asseturl = this.apiService.AssetUrl;\n    this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl('');\n    this.errors = {};\n    this.safetyNotes = [];\n    this.incidentImages = [];\n    this.incidentVideos = [];\n    this.incidentDocs = [];\n    this.vehiclesObject = {};\n    this.driversObject = {};\n    this.tripsObject = {};\n    this.incidentID = '';\n    this.newNotes = '';\n    this.slideConfig = {\n      slidesToShow: 1,\n      slidesToScroll: 1,\n      dots: true,\n      infinite: true,\n      autoplay: true,\n      variableWidth: true,\n      autoplaySpeed: 1500\n    };\n    this.showMap = true;\n    this.slideConfig1 = {\n      slidesToShow: 1,\n      slidesToScroll: 1,\n      dots: true,\n      infinite: true,\n      autoplay: true,\n      autoplaySpeed: 1500\n    };\n\n    this.setMarker = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (location) {\n        const cords = location.split(',');\n\n        if (cords.length > 0) {\n          const lat = cords[0];\n          const lng = cords[1];\n          const startIcon = new H.map.Icon(\"/assets/img/mapIcon/dest.png\", {\n            size: {\n              w: 30,\n              h: 30\n            }\n          });\n\n          _this.map.setCenter({\n            lat,\n            lng\n          });\n\n          const currentLoc = new H.map.Marker({\n            lat,\n            lng\n          }, {\n            icon: startIcon\n          });\n\n          _this.map.addObject(currentLoc);\n        }\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  }\n\n  ngOnInit() {\n    this.incidentID = this.route.snapshot.params['incidentID'];\n    this.platform = this.hereMap.mapSetAPI();\n    this.map = this.hereMap.mapInit();\n    this.fetchEventDetail();\n    this.fetchAllVehiclesIDs();\n    this.fetchAllDriverIDs();\n    this.fetchTripsByIDs();\n    this.mapShow();\n    $('#viewDocModal').modal({\n      show: false\n    }).on('hidden.bs.modal', function () {\n      $(this).find('video')[0].pause();\n    });\n  }\n\n  fetchEventDetail() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      _this2.safetyService.getData('incidents/detail/' + _this2.incidentID).subscribe( /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator(function* (res) {\n          let result = res[0];\n          _this2.driver = result.driverID;\n          _this2.vehicle = result.vehicleID;\n          _this2.trip = result.tripID;\n          _this2.incidentType = result.incidentType;\n          _this2.severity = result.severity;\n          _this2.eventDate = result.eventDate;\n          _this2.assigned = result.assigned;\n          _this2.eventSource = result.eventSource;\n          _this2.eventTime = yield _this2.convertTimeFormat(result.eventTime);\n          _this2.location = result.location.label ? result.location.label : 'NA';\n\n          if (result.location.cords != undefined) {\n            yield _this2.setMarker(result.location.cords);\n          }\n\n          if (result.uploadedPhotos != undefined && result.uploadedPhotos.length > 0) {\n            _this2.incidentImages = result.uploadPics; // this.incidentImages = result.uploadedPhotos.map(x => ({\n            //    path: `${this.asseturl}/${result.pk}/${x}`,\n            //    name: x,\n            //  }));\n          }\n\n          if (result.uploadedVideos != undefined && result.uploadedVideos.length > 0) {\n            _this2.incidentVideos = result.uploadVideo; //   this.incidentVideos = result.uploadedVideos.map(x => ({path: `${this.asseturl}/${result.pk}/${x}`, name: x}));\n          }\n\n          if (result.uploadedDocs != undefined && result.uploadedDocs.length > 0) {\n            _this2.incidentDocs = result.uploadDocument; // this.incidentDocs = result.uploadedDocs.map(x => ({path: `${this.asseturl}/${result.pk}/${x}`, name: x}));\n          }\n\n          _this2.createdBy = result.createdBy;\n          _this2.safetyNotes = result.safetyNotes;\n        });\n\n        return function (_x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n    })();\n  }\n\n  convertTimeFormat(time) {\n    // Check correct time format and split into components\n    time = time.toString().match(/^([01]\\d|2[0-3])(:)([0-5]\\d)(:[0-5]\\d)?$/) || [time];\n\n    if (time.length > 1) {\n      // If time format correct\n      time = time.slice(1); // Remove full string match value\n\n      time[5] = +time[0] < 12 ? ' AM' : ' PM'; // Set AM/PM\n\n      time[0] = +time[0] % 12 || 12; // Adjust hours\n    }\n\n    return time.join(''); // return adjusted time or original string\n  }\n\n  mapShow() {\n    setTimeout(() => {\n      this.hereMap.mapSetAPI();\n      this.hereMap.mapInit();\n    }, 100);\n  }\n\n  fetchAllVehiclesIDs() {\n    this.apiService.getData('vehicles/get/list').subscribe(result => {\n      this.vehiclesObject = result;\n    });\n  }\n\n  fetchAllDriverIDs() {\n    this.apiService.getData('drivers/get/list').subscribe(result => {\n      this.driversObject = result;\n    });\n  }\n\n  addNotes() {\n    if (this.newNotes.trim().length > 0) {\n      let data = {\n        notes: this.newNotes,\n        incidentID: this.incidentID\n      };\n      this.safetyService.postData('incidents/notes', data).subscribe(res => {\n        this.fetchEventDetail();\n        this.toastr.success('Notes added successfully');\n        this.newNotes = '';\n      });\n    }\n  }\n\n  fetchTripsByIDs() {\n    this.apiService.getData('common/trips/get/list').subscribe(result => {\n      this.tripsObject = result;\n    });\n  }\n\n  setPDFSrc(val) {\n    let pieces = val.split(/[\\s.]+/);\n    let ext = pieces[pieces.length - 1];\n    this.pdfSrc = '';\n\n    if (ext == 'doc' || ext == 'docx') {\n      this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl('https://docs.google.com/viewer?url=' + val + '&embedded=true');\n    } else {\n      this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(val);\n    }\n  }\n\n};\n\nIncidentDetailComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: DomSanitizer\n}, {\n  type: SafetyService\n}, {\n  type: ToastrService\n}, {\n  type: NgxSpinnerService\n}, {\n  type: Router\n}, {\n  type: ActivatedRoute\n}, {\n  type: HereMapService\n}];\n\nIncidentDetailComponent = __decorate([Component({\n  selector: 'app-incident-detail',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], IncidentDetailComponent);\nexport { IncidentDetailComponent };","map":null,"metadata":{},"sourceType":"module"}