{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./sales-order-list.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./sales-order-list.component.css\";\nimport { Component } from '@angular/core';\nimport { AccountService, ApiService } from 'src/app/services';\nimport { ToastrService } from 'ngx-toastr';\nimport Constants from 'src/app/pages/fleet/constants';\nlet SalesOrderListComponent = class SalesOrderListComponent {\n  constructor(accountService, toaster, apiService) {\n    this.accountService = accountService;\n    this.toaster = toaster;\n    this.apiService = apiService;\n    this.isSearch = false;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.allSales = [];\n    this.filterData = {\n      category: null,\n      unit: '',\n      status: null,\n      startDate: '',\n      endDate: ''\n    };\n    this.lastItemSK = '';\n    this.customersObjects = {};\n    this.loaded = false;\n    this.allStatus = [{\n      name: 'Open',\n      value: 'open'\n    }, {\n      name: 'Sent',\n      value: 'sent'\n    }, {\n      name: 'Closed',\n      value: 'closed'\n    }, {\n      name: 'Voided',\n      value: 'voided'\n    }];\n    this.emailDisabled = false;\n  }\n\n  ngOnInit() {\n    this.fetchCustomersByIDs();\n    this.fetchSales();\n  }\n\n  getSales() {\n    this.accountService.getData(`sales-orders`).subscribe(res => {\n      this.allSales = res;\n    });\n  }\n  /*\r\n  * Get all customers's IDs of names from api\r\n  */\n\n\n  fetchCustomersByIDs() {\n    this.apiService.getData('contacts/get/list').subscribe(result => {\n      this.customersObjects = result;\n    });\n  }\n\n  deleteSale(id) {\n    if (confirm('Are you sure you want to delete?') === true) {\n      this.accountService.deleteData(`sales-orders/delete/${id}`).subscribe(res => {\n        if (res) {\n          this.toaster.success('Order deleted successfully!');\n          this.getSales();\n        }\n      });\n    }\n  }\n\n  resetUnit() {\n    this.filterData.unit = '';\n  }\n\n  fetchSales(refresh) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      let searchParam = null;\n\n      if (refresh === true) {\n        _this.lastItemSK = '';\n        _this.allSales = [];\n      }\n\n      if (_this.lastItemSK !== 'end') {\n        if (_this.filterData.unit !== null && _this.filterData.unit !== \"\") {\n          searchParam = _this.filterData.category === 'saleOrder' ? encodeURIComponent(`\"${_this.filterData.unit}\"`) : `${_this.filterData.unit}`;\n        }\n\n        _this.accountService.getData(`sales-orders/paging?category=${_this.filterData.category}&unit=${searchParam}&status=${_this.filterData.status}&startDate=${_this.filterData.startDate}&endDate=${_this.filterData.endDate}&lastKey=${_this.lastItemSK}`).subscribe( /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (result) {\n            if (result.length === 0) {\n              _this.isSearch = false;\n              _this.dataMessage = Constants.NO_RECORDS_FOUND;\n            }\n\n            if (result.length > 0) {\n              _this.isSearch = false;\n              result.map(v => {\n                _this.allSales.push(v);\n              });\n\n              if (_this.allSales[_this.allSales.length - 1].sk !== undefined) {\n                _this.lastItemSK = encodeURIComponent(_this.allSales[_this.allSales.length - 1].sk);\n              } else {\n                _this.lastItemSK = 'end';\n              }\n\n              _this.loaded = true;\n            }\n          });\n\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }(), err => {\n          _this.isSearch = true;\n        });\n      }\n    })();\n  }\n\n  searchSale() {\n    if (this.filterData.category !== null || this.filterData.unit !== '' || this.filterData.status !== null || this.filterData.startDate !== '' || this.filterData.endDate !== '') {\n      if (this.filterData.startDate !== '' && this.filterData.endDate === '') {\n        this.toaster.error('Please select both start and end dates.');\n        return false;\n      } else if (this.filterData.startDate === '' && this.filterData.endDate !== '') {\n        this.toaster.error('Please select both start and end dates.');\n        return false;\n      } else if (this.filterData.startDate > this.filterData.endDate) {\n        this.toaster.error('Start date should be less then end date');\n        return false;\n      } else {\n        this.isSearch = true;\n        this.allSales = [];\n        this.lastItemSK = '';\n        this.dataMessage = Constants.FETCHING_DATA;\n        this.fetchSales();\n      }\n    }\n  }\n\n  resetFilter() {\n    this.isSearch = true;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.filterData = {\n      category: null,\n      unit: '',\n      status: null,\n      startDate: '',\n      endDate: ''\n    };\n    this.lastItemSK = '';\n    this.allSales = [];\n    this.fetchSales();\n  }\n\n  onScroll() {\n    if (this.loaded) {\n      this.fetchSales();\n    }\n\n    this.loaded = false;\n  }\n\n  sendConfirmationEmail(i, saleID) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      _this2.emailDisabled = true;\n      let result = yield _this2.accountService.getData(`sales-orders/send/confirmation-email/${saleID}`).toPromise();\n      _this2.emailDisabled = false;\n\n      if (result) {\n        _this2.allSales[i].status = 'sent';\n\n        _this2.toaster.success(\"Email sent successfully\");\n      } else {\n        _this2.toaster.error(\"Something went wrong.\");\n      }\n    })();\n  }\n\n};\n\nSalesOrderListComponent.ctorParameters = () => [{\n  type: AccountService\n}, {\n  type: ToastrService\n}, {\n  type: ApiService\n}];\n\nSalesOrderListComponent = __decorate([Component({\n  selector: 'app-sales-order-list',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], SalesOrderListComponent);\nexport { SalesOrderListComponent };","map":null,"metadata":{},"sourceType":"module"}