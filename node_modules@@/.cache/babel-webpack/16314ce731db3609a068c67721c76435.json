{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./bill-list.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./bill-list.component.css\";\nimport { Component } from \"@angular/core\";\nimport { ToastrService } from \"ngx-toastr\";\nimport Constants from \"src/app/pages/fleet/constants\";\nimport { AccountService, ApiService } from \"src/app/services\";\nlet BillListComponent = class BillListComponent {\n  constructor(apiService, accountService, toastr) {\n    this.apiService = apiService;\n    this.accountService = accountService;\n    this.toastr = toastr;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.dateMinLimit = {\n      year: 1950,\n      month: 1,\n      day: 1\n    };\n    this.date = new Date();\n    this.futureDatesLimit = {\n      year: this.date.getFullYear() + 30,\n      month: 12,\n      day: 31\n    };\n    this.payOrders = [];\n    this.vendors = {};\n    this.filter = {\n      amount: null,\n      startDate: null,\n      endDate: null\n    };\n    this.disableSearch = true;\n    this.lastItemSK = \"\";\n    this.loaded = false;\n    this.purchaseOrders = {};\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this.fetchVendor();\n\n      _this.fetchPurchaseOrders();\n\n      _this.fetchBills();\n    })();\n  }\n\n  fetchBills() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this2.lastItemSK !== \"end\") {\n        let filterAmount = null;\n\n        if (_this2.filter.amount) {\n          filterAmount = encodeURIComponent(`\"${_this2.filter.amount}\"`);\n        }\n\n        let result = yield _this2.accountService.getData(`bills/paging?amount=${filterAmount}&start=${_this2.filter.startDate}&end=${_this2.filter.endDate}&lastKey=${_this2.lastItemSK}`).toPromise();\n        _this2.disableSearch = false;\n\n        if (result.length === 0) {\n          _this2.dataMessage = Constants.NO_RECORDS_FOUND;\n        }\n\n        _this2.lastItemSK = \"end\";\n\n        if (result.length > 0 && result[result.length - 1].sk !== undefined) {\n          _this2.lastItemSK = encodeURIComponent(result[result.length - 1].sk);\n        } else {\n          _this2.lastItemSK = \"end\";\n        }\n\n        result.map(v => {\n          v.url = `/accounts/purchases/bills/details/${v.billID}`;\n          v.editUrl = `/accounts/purchases/bills/edit/${v.billID}`;\n          v.status = v.status.replace(\"_\", \" \");\n\n          _this2.payOrders.push(v);\n        });\n        _this2.loaded = true;\n      }\n    })();\n  }\n\n  fetchVendor() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this3.apiService.getData(`contacts/get/list/vendor`).toPromise();\n      _this3.vendors = result;\n    })();\n  }\n\n  fetchPurchaseOrders() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      const result = yield _this4.accountService.getData(\"purchase-orders/get/list\").toPromise();\n      _this4.purchaseOrders = result;\n    })();\n  }\n\n  voidBill(data) {\n    if (confirm(\"Are you sure you want to void?\") === true) {\n      this.accountService.deleteData(`bills/void/${data.billID}`).subscribe({\n        complete: () => {},\n        error: () => {},\n        next: result => {\n          this.dataMessage = Constants.FETCHING_DATA;\n          this.payOrders = [];\n          this.fetchBills();\n          this.toastr.success(\"Bill voided successfully\");\n        }\n      });\n    }\n  }\n\n  searchFilter() {\n    if (this.filter.amount !== null || this.filter.startDate !== null || this.filter.endDate !== null) {\n      this.payOrders = [];\n      this.lastItemSK = \"\";\n      this.disableSearch = true;\n      this.dataMessage = Constants.FETCHING_DATA;\n      this.fetchBills();\n    }\n  }\n\n  resetFilter() {\n    this.filter = {\n      amount: null,\n      startDate: null,\n      endDate: null\n    };\n    this.payOrders = [];\n    this.lastItemSK = \"\";\n    this.disableSearch = true;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.fetchBills();\n  }\n\n  onScroll() {\n    if (this.loaded) {\n      this.fetchBills();\n    }\n\n    this.loaded = false;\n  }\n\n};\n\nBillListComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: AccountService\n}, {\n  type: ToastrService\n}];\n\nBillListComponent = __decorate([Component({\n  selector: \"app-bill-list\",\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], BillListComponent);\nexport { BillListComponent };","map":null,"metadata":{},"sourceType":"module"}