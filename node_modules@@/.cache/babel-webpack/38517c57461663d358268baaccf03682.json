{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./service-detail.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./service-detail.component.css\";\nimport { Component, ViewChild } from '@angular/core';\nimport { NgxSpinnerService } from 'ngx-spinner';\nimport { ApiService, ListService } from '../../../../../services';\nimport { ActivatedRoute } from '@angular/router';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport Constants from '../../../constants';\nimport { NgbModal } from \"@ng-bootstrap/ng-bootstrap\";\nimport * as html2pdf from \"html2pdf.js\";\nlet ServiceDetailComponent = class ServiceDetailComponent {\n  constructor(spinner, apiService, route, domSanitizer, modalService, listService) {\n    var _this = this;\n\n    this.spinner = spinner;\n    this.apiService = apiService;\n    this.route = route;\n    this.domSanitizer = domSanitizer;\n    this.modalService = modalService;\n    this.listService = listService;\n    this.logurl = this.apiService.AssetUrl;\n    this.noRecordMessage = Constants.NO_RECORDS_FOUND;\n    this.logsData = {\n      unitType: '-'\n    };\n    this.allServiceTasks = [];\n    this.allServiceParts = [];\n    this.vehiclesObject = {};\n    this.vendorsObject = {};\n    this.issuesObject = [];\n    this.assetsObject = {};\n    this.photos = [];\n    this.docs = [];\n    this.users = [];\n    this.logImages = [];\n    this.logDocs = [];\n    this.showModal = false;\n    this.downloadDisabledpdf = true;\n    this.companyLogo = \"\";\n    this.companyName = \"\";\n    this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl('');\n    this.getCurrentuser = /*#__PURE__*/_asyncToGenerator(function* () {\n      // this.currentUser = (await Auth.currentSession()).getIdToken().payload;\n      // const carrierID = this.currentUser.carrierID;\n      const carrierID = localStorage.getItem('xfhCarrierId');\n      let result = yield _this.apiService.getData(`carriers/detail/${carrierID}`).toPromise();\n      _this.companyName = result.companyName;\n      _this.companyLogo = result.logo;\n      _this.tagLine = result.tagLine;\n    });\n  }\n\n  ngOnInit() {\n    this.logID = this.route.snapshot.params['logID'];\n    this.fetchProgramByID();\n    this.getCurrentuser();\n    this.fetchAllVehiclesIDs();\n    this.fetchAllVendorsIDs(); // this.fetchAllIssuesIDs();\n\n    this.fetchAllAssetsIDs();\n    this.fetchUsers();\n  }\n\n  fetchProgramByID() {\n    this.spinner.show(); // loader init\n\n    this.apiService.getData(`serviceLogs/${this.logID}`).subscribe({\n      complete: () => {},\n      error: () => {},\n      next: result => {\n        this.logsData = result.Items[0]; // console.log('this.logsData--', this.logsData)\n\n        this.fetchSelectedIssues(this.logsData.selectedIssues);\n        result = result.Items[0]; // console.log('result--', result)\n        // this.companyLogo = result.carrierDtl.logo;\n        // this.tagLine = result.carrierDtl.tagLine;\n        // this.carrierName = result.carrierDtl.carrierName;\n        // console.log('companylofog', this.companyLogo)\n        // console.log('this.tagLine', this.tagLine)\n        // console.log(' this.carrierName', this.carrierName)\n\n        this.vehicle = result.unitID;\n        this.assetID = result.unitID;\n        this.vendorID = result.vendorID;\n        this.completionDate = result.completionDate;\n        this.odometer = result.odometer;\n        this.reference = result.reference;\n        this.description = result.description;\n        this.startDate = result.timeCreated;\n        this.allServiceTasks = result.allServiceTasks.serviceTaskList;\n        this.allServiceParts = result.allServiceParts.servicePartsList;\n        this.taskSubTotal = result.allServiceTasks.subTotal;\n        this.taskDiscountAmount = result.allServiceTasks.discountAmount;\n        this.taskDiscountPercent = result.allServiceTasks.discountPercent;\n        this.taskTaxAmount = result.allServiceTasks.taxAmount;\n        this.taskTaxPercent = result.allServiceTasks.taxPercent;\n        this.taskTotal = result.allServiceTasks.total;\n        this.partsSubTotal = result.allServiceParts.subTotal;\n        this.partsQuantity = result.allServiceParts.totalQuantity;\n        this.partsDiscountAmount = result.allServiceParts.discountAmount;\n        this.partsDiscountPercent = result.allServiceParts.discountPercent;\n        this.partsTaxAmount = result.allServiceParts.taxAmount;\n        this.partsTaxPercent = result.allServiceParts.taxPercent;\n        this.partsTotal = result.allServiceParts.total;\n        this.currency = result.allServiceParts.currency;\n        this.logImages = result.uploadedPics;\n        this.logDocs = result.uploadDocument;\n        /*\r\n        if(result.uploadedPhotos !== undefined && result.uploadedPhotos.length > 0){\r\n          this.logImages = result.uploadedPhotos.map(x => ({\r\n            path: `${this.logurl}/${result.carrierID}/${x}`,\r\n            name: x,\r\n          }));\r\n        }\r\n                  if(result.uploadedDocs !== undefined && result.uploadedDocs.length > 0){\r\n          this.logDocs = result.uploadedDocs.map(x => ({path: `${this.logurl}/${result.carrierID}/${x}`, name: x}));\r\n        }\r\n        */\n\n        this.spinner.hide(); // loader init\n      }\n    });\n  }\n\n  fetchAllVehiclesIDs() {\n    this.apiService.getData('vehicles/get/list').subscribe(result => {\n      this.vehiclesObject = result;\n    });\n  }\n\n  fetchAllVendorsIDs() {\n    this.apiService.getData('contacts/get/list/vendor').subscribe(result => {\n      this.vendorsObject = result;\n    });\n  }\n\n  fetchSelectedIssues(issueIDs) {\n    if (issueIDs.length > 0) {\n      issueIDs = JSON.stringify(issueIDs);\n      this.apiService.getData('issues/fetch/selected?issueIds=' + issueIDs).subscribe(result => {\n        this.issuesObject = result; // console.log('isse0', this.issuesObject)\n      });\n    }\n  }\n\n  fetchUsers() {\n    this.apiService.getData('common/users/get/list').subscribe(result => {\n      this.users = result;\n    });\n  }\n\n  fetchAllAssetsIDs() {\n    this.apiService.getData('assets/get/list').subscribe(result => {\n      this.assetsObject = result;\n    });\n  } // delete uploaded images and documents\n\n\n  delete(type, name, index) {\n    this.apiService.deleteData(`serviceLogs/uploadDelete/${this.logID}/${type}/${name}`).subscribe(result => {\n      if (type === 'image') {\n        this.logImages.splice(index, 1);\n      } else {\n        this.logDocs.splice(index, 1);\n      }\n    });\n  }\n\n  setPDFSrc(val) {\n    let pieces = val.split(/[\\s.]+/);\n    let ext = pieces[pieces.length - 1];\n    this.pdfSrc = '';\n\n    if (ext == 'doc' || ext == 'docx' || ext == 'xlsx') {\n      this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl('https://docs.google.com/viewer?url=' + val + '&embedded=true');\n    } else {\n      this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(val);\n    }\n  }\n\n  openModal() {\n    let ngbModalOptions = {\n      keyboard: false,\n      backdrop: \"static\",\n      windowClass: \"log-order\"\n    };\n    this.logModalRef = this.modalService.open(this.logModal, ngbModalOptions);\n  }\n\n  downloadPaymentPdf() {\n    this.showModal = true;\n    let obj = {\n      showModal: this.showModal,\n      data: this.logsData\n    };\n    this.listService.triggerDownloadPaymentPdf(obj); // this.downloadDisabledpdf = true;\n\n    setTimeout(() => {\n      this.downloadDisabledpdf = false;\n    }, 15000);\n  }\n\n  downloadPdf() {\n    var data = document.getElementById(\"log_wrap\");\n    html2pdf(data, {\n      margin: [0.5, 0, 0.5, 0],\n      pagebreak: {\n        mode: 'avoid-all',\n        before: \"log_wrap\"\n      },\n      filename: \"serviceLog.pdf\",\n      image: {\n        type: \"jpeg\",\n        quality: 0.98\n      },\n      html2canvas: {\n        dpi: 300,\n        letterRendering: true,\n        allowTaint: true,\n        useCORS: true\n      },\n      jsPDF: {\n        unit: \"in\",\n        format: \"a4\",\n        orientation: \"portrait\"\n      }\n    });\n    this.logModalRef.close();\n  }\n\n};\n\nServiceDetailComponent.ctorParameters = () => [{\n  type: NgxSpinnerService\n}, {\n  type: ApiService\n}, {\n  type: ActivatedRoute\n}, {\n  type: DomSanitizer\n}, {\n  type: NgbModal\n}, {\n  type: ListService\n}];\n\nServiceDetailComponent.propDecorators = {\n  previewExpTransaction: [{\n    type: ViewChild,\n    args: [\"previewExpTransaction\", {\n      static: true\n    }]\n  }],\n  logModal: [{\n    type: ViewChild,\n    args: [\"logModal\", {\n      static: true\n    }]\n  }]\n};\nServiceDetailComponent = __decorate([Component({\n  selector: 'app-service-detail',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], ServiceDetailComponent);\nexport { ServiceDetailComponent };","map":null,"metadata":{},"sourceType":"module"}