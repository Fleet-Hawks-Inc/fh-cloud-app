{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./sales-receipts-list.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./sales-receipts-list.component.css\";\nimport { Component } from '@angular/core';\nimport { ToastrService } from 'ngx-toastr';\nimport Constants from 'src/app/pages/fleet/constants';\nimport { AccountService, ApiService } from 'src/app/services';\nlet SalesReceiptsListComponent = class SalesReceiptsListComponent {\n  constructor(accountService, toaster, apiService) {\n    this.accountService = accountService;\n    this.toaster = toaster;\n    this.apiService = apiService;\n    this.isSearch = false;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.allReceipts = [];\n    this.filterData = {\n      customerID: null,\n      startDate: '',\n      endDate: '',\n      lastItemSK: ''\n    };\n    this.lastItemSK = '';\n    this.customersObjects = {};\n    this.invoicesList = [];\n  }\n\n  ngOnInit() {\n    this.fetchReceipts();\n    this.fetchCustomersByIDs();\n    this.fetchInvoicesByID();\n  }\n  /*\r\n  * Get all customers's IDs of names from api\r\n  */\n\n\n  fetchCustomersByIDs() {\n    this.apiService.getData('contacts/get/list').subscribe(result => {\n      this.customersObjects = result;\n    });\n  }\n\n  fetchInvoicesByID() {\n    this.accountService.getData('sales-invoice/get/list').subscribe(result => {\n      this.invoicesList = result;\n    });\n  }\n\n  fetchReceipts(refresh) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (refresh === true) {\n        _this.lastItemSK = '';\n        _this.allReceipts = [];\n      }\n\n      if (_this.lastItemSK !== 'end') {\n        _this.accountService.getData(`sales-receipts/paging?customer=${_this.filterData.customerID}&startDate=${_this.filterData.startDate}&endDate=${_this.filterData.endDate}&lastKey=${_this.lastItemSK}`).subscribe( /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (result) {\n            if (result.length === 0) {\n              _this.isSearch = false;\n              _this.dataMessage = Constants.NO_RECORDS_FOUND;\n            }\n\n            if (result.length > 0) {\n              _this.isSearch = false;\n              result.map(v => {\n                _this.allReceipts.push(v);\n              });\n\n              if (_this.allReceipts[_this.allReceipts.length - 1].sk !== undefined) {\n                _this.lastItemSK = encodeURIComponent(_this.allReceipts[_this.allReceipts.length - 1].sk);\n              } else {\n                _this.lastItemSK = 'end';\n              } // this.loaded = true;\n\n            }\n          });\n\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }());\n      }\n    })();\n  }\n\n  searchSale() {\n    if (this.filterData.customerID !== '' || this.filterData.startDate !== '' || this.filterData.endDate !== '' || this.filterData.lastItemSK !== '') {\n      if (this.filterData.startDate !== '' && this.filterData.endDate === '') {\n        this.toaster.error('Please select both start and end dates.');\n        return false;\n      } else if (this.filterData.startDate === '' && this.filterData.endDate !== '') {\n        this.toaster.error('Please select both start and end dates.');\n        return false;\n      } else if (this.filterData.startDate > this.filterData.endDate) {\n        this.toaster.error('Start date should be less then end date');\n        return false;\n      } else {\n        this.isSearch = true;\n        this.allReceipts = [];\n        this.lastItemSK = '';\n        this.dataMessage = Constants.FETCHING_DATA;\n        this.fetchReceipts();\n      }\n    }\n  }\n\n  resetFilter() {\n    this.isSearch = true;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.filterData = {\n      customerID: null,\n      startDate: '',\n      endDate: '',\n      lastItemSK: ''\n    };\n    this.lastItemSK = '';\n    this.allReceipts = [];\n    this.fetchReceipts();\n  }\n\n};\n\nSalesReceiptsListComponent.ctorParameters = () => [{\n  type: AccountService\n}, {\n  type: ToastrService\n}, {\n  type: ApiService\n}];\n\nSalesReceiptsListComponent = __decorate([Component({\n  selector: 'app-sales-receipts-list',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], SalesReceiptsListComponent);\nexport { SalesReceiptsListComponent };","map":null,"metadata":{},"sourceType":"module"}