{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./bill-details.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./bill-details.component.css\";\nimport { Component } from \"@angular/core\";\nimport { ActivatedRoute } from \"@angular/router\";\nimport { AccountService } from \"src/app/services/account.service\";\nimport { ApiService } from \"src/app/services/api.service\";\nimport { DomSanitizer } from \"@angular/platform-browser\";\nimport { ToastrService } from \"ngx-toastr\";\nimport Constants from \"src/app/pages/fleet/constants\";\nlet BillDetailsComponent = class BillDetailsComponent {\n  constructor(accountService, route, apiService, domSanitizer, toaster) {\n    this.accountService = accountService;\n    this.route = route;\n    this.apiService = apiService;\n    this.domSanitizer = domSanitizer;\n    this.toaster = toaster;\n    this.noRecord = Constants.NO_RECORDS_FOUND;\n    this.orderData = {\n      attachments: [],\n      billNo: \"\",\n      txnDate: null,\n      refNo: \"\",\n      currency: \"CAD\",\n      vendorID: null,\n      detail: [{\n        comm: \"\",\n        qty: \"\",\n        qtyTyp: null,\n        rate: \"\",\n        rateTyp: null,\n        amount: 0,\n        accountID: null,\n        description: \"\",\n        rowID: \"\"\n      }],\n      charges: {\n        remarks: \"\",\n        accFee: [{\n          name: \"\",\n          amount: 0\n        }],\n        accDed: [{\n          name: \"\",\n          amount: 0\n        }],\n        taxes: [{\n          name: \"GST\",\n          tax: 0,\n          type: \"prcnt\",\n          amount: 0\n        }, {\n          name: \"PST\",\n          tax: 0,\n          type: \"prcnt\",\n          amount: 0\n        }, {\n          name: \"HST\",\n          tax: 0,\n          type: \"prcnt\",\n          amount: 0\n        }]\n      },\n      total: {\n        detailTotal: 0,\n        feeTotal: 0,\n        dedTotal: 0,\n        subTotal: 0,\n        vendorCredit: 0,\n        taxes: 0,\n        finalTotal: 0\n      },\n      status: \"open\",\n      billType: null,\n      dueDate: null,\n      paymentTerm: null,\n      purchaseID: null,\n      creditIds: [],\n      creditData: [],\n      transactionLog: []\n    };\n    this.billID = \"\";\n    this.vendorName = \"\";\n    this.puchaseOrdNo = \"\";\n    this.documentSlides = [];\n    this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(\"\");\n    this.Asseturl = this.apiService.AssetUrl;\n    this.accountsObjects = [];\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.billID = _this.route.snapshot.params[\"billID\"];\n      yield _this.fetchDetails();\n\n      _this.fetchVendor();\n\n      _this.purchaseOrderDetail();\n\n      _this.fetchVendorCredits();\n    })();\n  }\n\n  fetchDetails() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this2.accountService.getData(`bills/details/${_this2.billID}`).toPromise();\n      _this2.orderData = result[0];\n      console.log(\"this.orderData\", _this2.orderData);\n\n      if (result[0].attachments != undefined && result[0].attachments.length > 0) {\n        result[0].attachments.map(x => {\n          let obj = {\n            name: x.displayname,\n            bucketName: x.actualname,\n            path: `${_this2.Asseturl}/${result[0].pk}/${x.actualname}`\n          };\n\n          _this2.documentSlides.push(obj);\n        });\n      }\n\n      _this2.orderData.paymentTerm = _this2.orderData.paymentTerm.replace(\"_\", \" \");\n      _this2.orderData.status = _this2.orderData.status.replace(\"_\", \" \");\n    })();\n  }\n\n  purchaseOrderDetail() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this3.orderData.purchaseID) {\n        let result = yield _this3.accountService.getData(`purchase-orders/details/minor/${_this3.orderData.purchaseID}`).toPromise();\n        _this3.puchaseOrdNo = result[0].orderNo;\n      }\n    })();\n  }\n\n  fetchVendor() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this4.apiService.getData(`contacts/minor/detail/${_this4.orderData.vendorID}`).toPromise();\n\n      if (result.Items.length > 0) {\n        _this4.vendorName = result.Items[0].cName;\n      }\n    })();\n  }\n\n  fetchVendorCredits() {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this5.orderData.creditIds.length > 0) {\n        let creditIds = encodeURIComponent(JSON.stringify(_this5.orderData.creditIds));\n        let result = yield _this5.accountService.getData(`vendor-credits/get/selected?entities=${creditIds}`).toPromise();\n\n        _this5.orderData.creditData.map(v => {\n          result.map(k => {\n            if (v.creditID === k.creditID) {\n              v.creditAmount = k.totalAmt;\n              v.creditNo = k.vCrNo;\n              v.txnDate = k.txnDate;\n            }\n          });\n        });\n      }\n    })();\n  }\n\n  setPDFSrc(val) {\n    let pieces = val.split(/[\\s.]+/);\n    let ext = pieces[pieces.length - 1];\n    this.pdfSrc = \"\";\n\n    if (ext == \"doc\" || ext == \"docx\" || ext == \"xlsx\") {\n      this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(\"https://docs.google.com/viewer?url=\" + val + \"&embedded=true\");\n    } else {\n      this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(val);\n    }\n  }\n\n  deleteDocument(name, index) {\n    console.log(\"name\", name);\n    this.accountService.deleteData(`bills/uploadDelete/${this.billID}/${name}`).subscribe(result => {\n      this.documentSlides.splice(index, 1);\n      this.toaster.success(\"Attachment deleted successfully.\");\n    });\n  }\n\n};\n\nBillDetailsComponent.ctorParameters = () => [{\n  type: AccountService\n}, {\n  type: ActivatedRoute\n}, {\n  type: ApiService\n}, {\n  type: DomSanitizer\n}, {\n  type: ToastrService\n}];\n\nBillDetailsComponent = __decorate([Component({\n  selector: \"app-bill-details\",\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], BillDetailsComponent);\nexport { BillDetailsComponent };","map":null,"metadata":{},"sourceType":"module"}