{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./add-driver.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./add-driver.component.css\";\n\nconst ct = require(\"countries-and-timezones\");\n\nimport { Location } from \"@angular/common\";\nimport { HttpClient } from \"@angular/common/http\";\nimport { Component, ViewChild } from \"@angular/core\";\nimport { DomSanitizer } from \"@angular/platform-browser\";\nimport { ActivatedRoute, Router } from \"@angular/router\";\nimport { NgbCalendar, NgbDateAdapter, NgbModal } from \"@ng-bootstrap/ng-bootstrap\";\nimport { Auth } from \"aws-amplify\";\nimport { passwordStrength } from \"check-password-strength\";\nimport * as _ from \"lodash\";\nimport { NgxSpinnerService } from \"ngx-spinner\";\nimport { ToastrService } from \"ngx-toastr\";\nimport { from, Subject, throwError } from \"rxjs\";\nimport { catchError, debounceTime, distinctUntilChanged, map, switchMap } from \"rxjs/operators\";\nimport { CountryStateCityService } from \"src/app/services/country-state-city.service\";\nimport { RouteManagementServiceService } from \"src/app/services/route-management-service.service\";\nimport { ApiService, DashboardUtilityService, HereMapService, ListService } from \"../../../../services\";\nimport { ModalService } from \"../../../../services/modal.service\";\nimport Constants from \"../../constants\";\nlet AddDriverComponent = class AddDriverComponent {\n  constructor(apiService, httpClient, toastr, route, spinner, HereMap, ngbCalendar, domSanitizer, location, modalService, modalServiceOwn, dateAdapter, router, listService, countryStateCity, dashboardUtilityService, routeMgmntService) {\n    var _this = this;\n\n    this.apiService = apiService;\n    this.httpClient = httpClient;\n    this.toastr = toastr;\n    this.route = route;\n    this.spinner = spinner;\n    this.HereMap = HereMap;\n    this.ngbCalendar = ngbCalendar;\n    this.domSanitizer = domSanitizer;\n    this.location = location;\n    this.modalService = modalService;\n    this.modalServiceOwn = modalServiceOwn;\n    this.dateAdapter = dateAdapter;\n    this.router = router;\n    this.listService = listService;\n    this.countryStateCity = countryStateCity;\n    this.dashboardUtilityService = dashboardUtilityService;\n    this.routeMgmntService = routeMgmntService;\n    this.takeUntil$ = new Subject();\n    this.Asseturl = this.apiService.AssetUrl;\n    this.hideNextBtn = true;\n    this.hasBasic = false;\n    this.hasDocs = false;\n    this.hasLic = false;\n    this.hasPay = false;\n    this.hasHos = false;\n    this.hasCrossBrdr = false;\n    this.deletedUploads = [];\n    this.addressField = -1;\n    this.driverProfileSrc = \"assets/img/driver/driver.png\";\n    this.errors = {}; // form;\n\n    this.concatArrayKeys = \"\";\n    this.manualAddress = false;\n    this.allDrivers = [];\n    this.groupData = {\n      groupType: \"drivers\",\n      groupName: \"\",\n      groupMembers: \"\",\n      description: \"\"\n    };\n    this.driverAddress = {\n      address: []\n    };\n    this.isEdit = false;\n    this.driverData = {\n      employeeContractorId: \"\",\n      createdDate: \"\",\n      createdTime: \"\",\n      driverType: \"employee\",\n      entityType: Constants.DRIVER,\n      gender: \"M\",\n      DOB: null,\n      abstractDocs: [],\n      corporationType: null,\n      vendor: null,\n      corporation: \"\",\n      ownerOperator: null,\n      driverStatus: null,\n      userName: \"\",\n      firstName: null,\n      middleName: \"\",\n      lastName: null,\n      startDate: null,\n      terminationDate: null,\n      contractStart: null,\n      contractEnd: null,\n      password: null,\n      confirmPassword: null,\n      citizenship: null,\n      assignedVehicle: null,\n      groupID: null,\n      driverImage: \"\",\n      phone: \"\",\n      email: \"\",\n      address: [{\n        addressID: \"\",\n        addressType: null,\n        countryName: \"\",\n        countryCode: \"\",\n        stateCode: \"\",\n        stateName: \"\",\n        cityName: \"\",\n        zipCode: \"\",\n        address1: \"\",\n        address2: \"\",\n        geoCords: {\n          lat: \"\",\n          lng: \"\"\n        },\n        manual: false,\n        userLocation: \"\",\n        states: [],\n        cities: [],\n        isSuggest: false\n      }],\n      documentDetails: [{\n        documentType: null,\n        document: \"\",\n        issuingAuthority: \"\",\n        issuingCountry: null,\n        issuingState: null,\n        issueDate: \"\",\n        expiryDate: \"\",\n        uploadedDocs: [],\n        docStates: []\n      }],\n      crossBorderDetails: {\n        ACI_ID: \"\",\n        ACE_ID: \"\",\n        fast_ID: \"\",\n        fastExpiry: null,\n        csa: false\n      },\n      paymentOption: [],\n      payPeriod: null,\n      SIN: \"\",\n      CDL_Number: \"\",\n      licenceDetails: {\n        issuedCountry: null,\n        issuedState: null,\n        licenceExpiry: null,\n        licenceNotification: true,\n        WCB: \"\",\n        medicalCardRenewal: null,\n        healthCare: \"\",\n        vehicleType: \"\",\n        licCntryName: \"\",\n        licStateName: \"\"\n      },\n      hosDetails: {\n        hosStatus: null,\n        timezone: null,\n        type: null,\n        hosRemarks: \"\",\n        homeTerminal: null,\n        pcAllowed: false,\n        ymAllowed: false,\n        hosCycleName: null,\n        optZone: \"South (Canada)\"\n      },\n      emergencyDetails: {\n        name: \"\",\n        relationship: \"\",\n        phone: \"\"\n      }\n    };\n    this.searchTerm = new Subject();\n    this.localAbsDocs = [];\n    this.newDocuments = [];\n    this.newAddress = [];\n    /**\r\n     * Form Props\r\n     */\n\n    this.userType = \"driver\"; // default\n\n    this.userName = null;\n    this.password = \"\";\n    this.firstName = null;\n    this.lastName = null;\n    this.address = \"\";\n    this.phone = \"\";\n    this.email = \"\";\n    this.groupID = \"\";\n    this.loginEnabled = true;\n    this.driverNumber = \"\";\n    this.driverLicenseNumber = \"\";\n    this.driverLicenseType = \"\";\n    this.driverLicenseExpiry = \"\";\n    this.driverLicenseStateID = \"\";\n    this.HOSCompliance = {\n      status: \"\",\n      type: \"\",\n      cycleID: \"\"\n    };\n    this.defaultContract = {\n      perMile: \"\",\n      team: \"\",\n      hourly: \"\",\n      pickOrDrop: \"\"\n    };\n    this.fixed = {\n      amount: \"\",\n      type: \"\"\n    };\n    this.yardID = \"\";\n    this.documentTypeList = [];\n    this.driverLicenseCountry = \"\";\n    this.groups = [];\n    this.docCountries = [];\n    this.docStates = [];\n    this.states = [];\n    this.errorAbstract = false;\n    this.cities = [];\n    this.yards = [];\n    this.cycles = [];\n    this.response = \"\";\n    this.hasError = false;\n    this.hasSuccess = false;\n    this.imageTitle = \"Add\";\n    this.Error = \"\";\n    this.Success = \"\";\n    this.visibleIndex = 0;\n    this.uploadedPhotos = [];\n    this.licStates = [];\n    this.uploadedDocs = [];\n    this.abstractDocs = [];\n    this.existingPhotos = [];\n    this.existingDocs = [];\n    this.assetsImages = [];\n    this.assetsDocs = [];\n    this.absDocs = [];\n    this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(\"\");\n    this.isSubmitted = false;\n    this.showIcons = false;\n    this.profileTitle = \"Add\";\n    this.addressCountries = [];\n    this.carrierYards = [];\n    this.deletedAddress = [];\n    this.abstractValid = false;\n    this.finalPrefix = \"\";\n    this.modelID = \"\";\n    this.submitDisabled = false;\n    this.groupSubmitDisabled = false;\n    this.passwordValidation = {\n      upperCase: false,\n      lowerCase: false,\n      number: false,\n      specialCharacters: false,\n      length: false\n    };\n    this.finaltimezones = [];\n    this.nullVar = null;\n    this.uploadedPic = \"\";\n    this.showUploadedPicModal = false;\n    this.pageType = \"add\";\n    this.groupsData = [];\n    this.paymentOptions = [{\n      name: \"Pay Per Mile\",\n      value: \"ppm\"\n    }, {\n      name: \"Percentage\",\n      value: \"pp\"\n    }, {\n      name: \"Pay Per Hour\",\n      value: \"pph\"\n    }, {\n      name: \"Pay Per Delivery\",\n      value: \"ppd\"\n    }, {\n      name: \"Flat Rate\",\n      value: \"pfr\"\n    }];\n    this.paymentType = \"ppm\";\n    this.payPerMile = {\n      pType: \"ppm\",\n      loadedMiles: null,\n      currency: null,\n      emptyMiles: null,\n      emptyMilesTeam: null,\n      loadedMilesTeam: null,\n      default: false\n    };\n    this.payPerHour = {\n      pType: \"pph\",\n      rate: null,\n      currency: null,\n      waitingPay: null,\n      waitingHourAfter: null,\n      default: false\n    };\n    this.payPercentage = {\n      pType: \"pp\",\n      loadPayPercentage: null,\n      loadPayPercentageOf: null,\n      default: false\n    };\n    this.payPerDelivery = {\n      pType: \"ppd\",\n      deliveryRate: null,\n      currency: null,\n      default: false\n    };\n    this.payFlatRate = {\n      pType: \"pfr\",\n      flatRate: null,\n      currency: null,\n      default: false\n    };\n    this.getCurrentuser = /*#__PURE__*/_asyncToGenerator(function* () {\n      _this.currentUser = (yield Auth.currentSession()).getIdToken().payload;\n      _this.currentUserCarrier = localStorage.getItem('xfhCarrierId');\n      _this.carrierID = localStorage.getItem('xfhCarrierId');\n\n      if (_this.currentUser.userType === \"Cloud Admin\") {\n        let isCarrierID = localStorage.getItem(\"carrierID\");\n\n        if (isCarrierID !== undefined) {\n          _this.currentUserCarrier = isCarrierID;\n        }\n      }\n\n      _this.apiService.getData(`carriers/${_this.currentUserCarrier}`).subscribe(result => {\n        if (result.Items[0].addressDetails !== undefined) {\n          result.Items[0].addressDetails.map(e => {\n            if (e.addressType === \"yard\") {\n              _this.carrierYards.push(e);\n            }\n          });\n        }\n\n        for (let a = 0; a < _this.carrierYards.length; a++) {\n          _this.carrierYards.map( /*#__PURE__*/function () {\n            var _ref2 = _asyncToGenerator(function* (e) {\n              if (e.manual) {\n                e.countryName = yield _this.countryStateCity.GetSpecificCountryNameByCode(e.countryCode);\n                e.stateName = yield _this.countryStateCity.GetStateNameFromCode(e.stateCode, e.countryCode);\n              }\n            });\n\n            return function (_x) {\n              return _ref2.apply(this, arguments);\n            };\n          }());\n        }\n      });\n    });\n    this.selectedFileNames = new Map();\n    const date = new Date();\n    this.getcurrentDate = {\n      year: date.getFullYear(),\n      month: date.getMonth() + 1,\n      day: date.getDate()\n    };\n    this.birthDateMinLimit = {\n      year: 1950,\n      month: 1,\n      day: 1\n    };\n    this.birthDateMaxLimit = {\n      year: date.getFullYear() - 18,\n      month: 12,\n      day: 31\n    };\n    this.futureDatesLimit = {\n      year: date.getFullYear() + 30,\n      month: 12,\n      day: 31\n    };\n    this.sessionID = this.routeMgmntService.driverUpdateSessionID;\n  }\n\n  scrollError() {\n    let errorList;\n    setTimeout(() => {\n      errorList = document.getElementsByClassName(\"error\").length;\n\n      if (errorList > 0) {\n        let topPosition = $(\".error\").parent(\"div\").offset().top;\n        window.scrollTo({\n          top: topPosition - 150,\n          left: 0,\n          behavior: \"smooth\"\n        });\n      }\n    }, 1500);\n  }\n\n  onChangeHideErrors(fieldname) {\n    $('[name=\"' + fieldname + '\"]').removeClass(\"error\").next().remove(\"label\");\n  }\n\n  get today() {\n    return this.dateAdapter.toModel(this.ngbCalendar.getToday());\n  }\n\n  ngOnInit() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      _this2.listService.fetchVehicles();\n\n      _this2.driverID = _this2.route.snapshot.params[`driverID`];\n\n      if (_this2.driverID) {\n        _this2.pageTitle = \"Edit Driver\";\n        _this2.pageType = \"edit\";\n        yield _this2.fetchDriverByID();\n      } else {\n        _this2.pageTitle = \"Add Driver\";\n      } // this.fetchGroups(); // fetch groups\n\n\n      _this2.docCountries = yield _this2.dashboardUtilityService.fetchCountries(); // fetch countries\n\n      _this2.getToday(); // get today date on calender\n\n\n      _this2.searchLocation(); // search location on keyup\n\n\n      _this2.fetchDocuments();\n\n      _this2.fetchTimezones(); // to fetch timezone\n\n\n      _this2.fetchDrivers();\n\n      yield _this2.getCurrentuser();\n      let vehicleList = new Array();\n\n      _this2.getValidVehicles(vehicleList);\n\n      _this2.vehicles = vehicleList;\n\n      _this2.fetchGroupsList();\n    })();\n  }\n\n  getValidVehicles(vehicleList) {\n    let ids = [];\n    this.listService.vehicleList.forEach(element => {\n      element.forEach(element2 => {\n        if (element2.vehicleIdentification && element2.isDeleted === 1 && element2.vehicleID === this.driverData.assignedVehicle) {\n          this.driverData.assignedVehicle = null;\n        }\n\n        if (element2.vehicleIdentification && element2.isDeleted === 0 && !ids.includes(element2.vehicleID)) {\n          vehicleList.push(element2);\n          ids.push(element2.vehicleID);\n        }\n      });\n    });\n  }\n\n  getCarrierDetails(id) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      _this3.spinner.show();\n\n      _this3.apiService.getData(\"carriers/\" + id).subscribe(res => {\n        if (res.Items.length > 0) {\n          let carrierPrefix = res.Items[0].businessName;\n          let toArray = carrierPrefix.match(/\\b(\\w)/g);\n          _this3.prefixOutput = toArray.join(\"\") + \"-\";\n        }\n\n        _this3.spinner.hide();\n      });\n    })();\n  }\n\n  fetchDrivers() {\n    this.apiService.getData(\"drivers\").subscribe(res => {\n      // this.allDrivers = res.Items;\n      res.Items.forEach(element => {\n        if (element.isDeleted === 0) {\n          this.allDrivers.push(element);\n        }\n      });\n    });\n  }\n\n  fetchTimezones() {\n    const UStimezones = ct.getTimezonesForCountry(`US`);\n    UStimezones.forEach(element => {\n      const obj = {\n        name: element.name,\n        country: element.countries[0]\n      };\n      this.finaltimezones.push(obj);\n    });\n    const CAtimezones = ct.getTimezonesForCountry(`CA`);\n    CAtimezones.forEach(e => {\n      const obj = {\n        name: e.name,\n        country: e.countries[0]\n      };\n      this.finaltimezones.push(obj);\n    });\n  }\n\n  cancel() {\n    this.location.back(); // <-- go back to previous location on cancel\n  }\n\n  refreshVehicleData() {\n    this.listService.fetchVehicles();\n  }\n\n  clearUserLocation(i) {\n    this.driverData.address[i][`userLocation`] = \"\";\n    $(\"div\").removeClass(\"show-search__result\");\n  }\n\n  manAddress(event, i) {\n    if (event.target.checked) {\n      $(event.target).closest(\".address-item\").addClass(\"open\");\n      this.driverData.address[i][`userLocation`] = \"\";\n      this.driverData.address[i].zipCode = \"\";\n      this.driverData.address[i].countryCode = \"\";\n      this.driverData.address[i].stateCode = \"\";\n      this.driverData.address[i].cityName = \"\";\n      this.driverData.address[i].zipCode = \"\";\n      this.driverData.address[i].address1 = \"\";\n      this.driverData.address[i].address2 = \"\";\n    } else {\n      $(event.target).closest(\".address-item\").removeClass(\"open\");\n      this.driverData.address[i].countryCode = \"\";\n      this.driverData.address[i].countryName = \"\";\n      this.driverData.address[i].stateCode = \"\";\n      this.driverData.address[i].stateName = \"\";\n      this.driverData.address[i].cityName = \"\";\n      this.driverData.address[i].zipCode = \"\";\n      this.driverData.address[i].address1 = \"\";\n      this.driverData.address[i].address2 = \"\";\n      this.driverData.address[i].geoCords.lat = \"\";\n      this.driverData.address[i].geoCords.lng = \"\";\n      $(\"#addErr\" + i).css(\"display\", \"none\");\n    }\n  }\n\n  onChangeUnitType(str, value) {\n    if (str === \"driver_type\") {\n      if (value === \"employee\") {\n        delete this.driverData.ownerOperator;\n        delete this.driverData.corporationType;\n        delete this.driverData.vendor;\n        delete this.driverData.corporation;\n        delete this.driverData.contractStart;\n        delete this.driverData.contractEnd;\n      } else {\n        delete this.driverData.startDate;\n        delete this.driverData.terminationDate;\n      }\n\n      this.driverData.driverType = value;\n    } else {\n      this.driverData.gender = value;\n    }\n  }\n\n  addAddress() {\n    this.driverData.address.push({\n      addressID: \"\",\n      addressType: \"\",\n      countryCode: \"\",\n      countryName: \"\",\n      stateCode: \"\",\n      stateName: \"\",\n      cityName: \"\",\n      zipCode: \"\",\n      address1: \"\",\n      address2: \"\",\n      geoCords: {\n        lat: \"\",\n        lng: \"\"\n      },\n      manual: false,\n      userLocation: \"\",\n      states: [],\n      cities: [],\n      isSuggest: false\n    });\n  }\n\n  refreshGroupsData() {\n    this.fetchGroupsList();\n  }\n\n  refreshVendorData() {\n    this.listService.fetchVendors();\n  }\n\n  refreshOpData() {\n    this.listService.fetchOwnerOperators();\n  } // async fetchCountries() {\n  //   this.docCountries = await this.countryStateCity.GetAllCountries();\n  // }\n\n\n  getStates(countryCode, index) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      _this4.driverData.address[index].stateCode = \"\";\n      _this4.driverData.address[index].cityName = \"\";\n      _this4.driverData.address[index].states = yield _this4.countryStateCity.GetStatesByCountryCode([countryCode]);\n    })();\n  }\n\n  getCities(stateCode, index, countryCode) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      _this5.driverData.address[index].cityName = \"\";\n      _this5.driverData.address[index].cities = yield _this5.countryStateCity.GetCitiesByStateCodes(countryCode, stateCode);\n      _this5.driverData.address[index].countryName = yield _this5.countryStateCity.GetSpecificCountryNameByCode(countryCode);\n      _this5.driverData.address[index].stateName = yield _this5.countryStateCity.GetStateNameFromCode(stateCode, countryCode);\n    })();\n  }\n\n  getDocStates(cntryCode, index) {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      _this6.driverData.documentDetails[index].issuingState = \"\";\n      _this6.driverData.documentDetails[index].docStates = yield _this6.countryStateCity.GetStatesByCountryCode([cntryCode]);\n    })();\n  }\n\n  getLicStates(cntryCode) {\n    var _this7 = this;\n\n    return _asyncToGenerator(function* () {\n      _this7.driverData.licenceDetails.issuedState = null;\n      _this7.driverData.licenceDetails.licCntryName = yield _this7.countryStateCity.GetSpecificCountryNameByCode(cntryCode);\n      _this7.licStates = yield _this7.countryStateCity.GetStatesByCountryCode([cntryCode]);\n    })();\n  }\n\n  getLicenseStateName() {\n    var _this8 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this8.driverData.licenceDetails.issuedState && _this8.driverData.licenceDetails.issuedCountry) {\n        _this8.driverData.licenceDetails.licStateName = yield _this8.countryStateCity.GetStateNameFromCode(_this8.driverData.licenceDetails.issuedState, _this8.driverData.licenceDetails.issuedCountry);\n      }\n    })();\n  }\n\n  fetchLicStates(issuedCountry) {\n    var _this9 = this;\n\n    return _asyncToGenerator(function* () {\n      _this9.licStates = yield _this9.countryStateCity.GetStatesByCountryCode([issuedCountry]);\n    })();\n  }\n\n  fetchStates(countryCode, index) {\n    var _this10 = this;\n\n    return _asyncToGenerator(function* () {\n      let states = yield _this10.countryStateCity.GetStatesByCountryCode([countryCode]);\n      _this10.driverData.address[index].states = states;\n    })();\n  }\n\n  fetchCities(countryCode, stateCode, index) {\n    var _this11 = this;\n\n    return _asyncToGenerator(function* () {\n      _this11.driverData.address[index].cities = yield _this11.countryStateCity.GetCitiesByStateCodes(countryCode, stateCode);\n    })();\n  }\n\n  editAddress(address) {\n    for (let a = 0; a < address.length; a++) {\n      const countryCode = address[a].countryCode;\n      const stateCode = address[a].stateCode;\n\n      if (countryCode !== \"\" && countryCode !== null) {\n        this.fetchStates(countryCode, a);\n      }\n\n      if (stateCode !== \"\" && stateCode !== null) {\n        this.fetchCities(countryCode, stateCode, a);\n      }\n    }\n  }\n\n  fetchDocStates(docs) {\n    var _this12 = this;\n\n    return _asyncToGenerator(function* () {\n      for (let d = 0; d < docs.length; d++) {\n        let countryCode = _this12.driverData.documentDetails[d].issuingCountry;\n\n        if (countryCode = null && countryCode != '') {\n          _this12.driverData.documentDetails[d].docStates = yield _this12.countryStateCity.GetStatesByCountryCode([countryCode]);\n        }\n      }\n    })();\n  }\n\n  fetchDocuments() {\n    this.httpClient.get(\"assets/travelDocumentType.json\").subscribe(data => {\n      this.documentTypeList = data;\n    });\n  }\n\n  getToday() {\n    return new Date().toISOString().split(\"T\")[0];\n  }\n  /*\r\n   * Selecting files before uploading\r\n   */\n\n\n  selectDocuments(event, i) {\n    let files = [...event.target.files];\n\n    if (i != null) {\n      this.uploadedDocs[i] = [];\n      this.uploadedDocs[i] = files;\n    } else {\n      const reader = new FileReader();\n\n      reader.onload = e => {\n        this.localAbsDocs.push(e.target.result);\n      };\n\n      reader.readAsDataURL(files[0]);\n      this.abstractDocs = [];\n      this.abstractDocs = files;\n    }\n  }\n\n  selectPhoto(event, name, type) {\n    if (type === \"Add\") {\n      this.uploadedPhotos = [];\n      const files = [...event.target.files];\n      this.uploadedPhotos.push(files[0]);\n\n      for (let i = 0; i < files.length; i++) {\n        const reader = new FileReader();\n        this.showUploadedPicModal = true;\n\n        reader.onload = e => {\n          this.uploadedPic = e.target.result;\n        };\n\n        reader.readAsDataURL(files[i]);\n        this.imageTitle = \"Change\";\n      }\n    } else {\n      this.uploadedPhotos = [];\n      const files = [...event.target.files];\n      this.uploadedPhotos.push(files[0]);\n\n      for (let i = 0; i < files.length; i++) {\n        const reader = new FileReader();\n        this.showUploadedPicModal = true;\n\n        reader.onload = e => {\n          this.uploadedPic = e.target.result;\n        };\n\n        reader.readAsDataURL(files[i]);\n      }\n\n      this.deletedUploads.push(name);\n    }\n  }\n\n  removeProfile() {\n    this.driverProfileSrc = \"assets/img/driver/driver.png\";\n    this.uploadedPhotos = [];\n    this.profileTitle = \"Add\";\n  }\n\n  searchLocation() {\n    this.searchTerm.pipe(map(e => {\n      $(\".map-search__results\").hide();\n      $(e.target).closest(\"div\").addClass(\"show-search__result\");\n      return e.target.value;\n    }), debounceTime(400), distinctUntilChanged(), switchMap(term => {\n      return this.HereMap.searchEntries(term);\n    }), catchError(e => {\n      return throwError(e);\n    })).subscribe(res => {\n      this.searchResults = res;\n    });\n  }\n\n  addGroup() {\n    this.groupSubmitDisabled = true;\n    this.hideErrors();\n    this.apiService.postData(\"groups\", this.groupData).subscribe({\n      complete: () => {},\n      error: err => {\n        from(err.error).pipe(map(val => {\n          val.message = val.message.replace(/\".*\"/, \"This Field\");\n          this.errors[val.context.label] = val.message;\n        })).subscribe({\n          complete: () => {\n            this.throwErrors();\n            this.groupSubmitDisabled = false;\n          },\n          error: () => {\n            this.groupSubmitDisabled = false;\n          },\n          next: () => {}\n        });\n      },\n      next: res => {\n        this.response = res;\n        this.hasSuccess = true;\n        this.groupSubmitDisabled = false;\n        this.fetchGroupsList();\n        this.toastr.success(\"Group added successfully\");\n        $(\"#addDriverGroupModal\").modal(\"hide\");\n        this.groupData = {\n          groupType: \"drivers\",\n          groupName: \"\",\n          groupMembers: \"\",\n          description: \"\"\n        };\n      }\n    });\n  }\n\n  newGeoCode(data) {\n    var _this13 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this13.apiService.getData(`pcMiles/geocoding/${encodeURIComponent(JSON.stringify(data))}`).toPromise();\n\n      if (result.items != undefined && result.items.length > 0) {\n        return result.items[0].position;\n      }\n    })();\n  }\n\n  changeCompany(value) {\n    var _this14 = this;\n\n    return _asyncToGenerator(function* () {\n      if (value === \"company\") {\n        _this14.driverData.corporation = null;\n        _this14.driverData.ownerOperator = null;\n\n        _this14.listService.fetchVendors();\n\n        let vendorList = new Array();\n\n        _this14.getValidVendors(vendorList);\n\n        _this14.vendors = vendorList;\n      } else if (value === \"corporation\") {\n        _this14.driverData.vendor = null;\n        _this14.driverData.ownerOperator = null;\n      } else {\n        _this14.driverData.vendor = null;\n        _this14.driverData.corporation = null;\n\n        _this14.listService.fetchOwnerOperators();\n\n        let opList = new Array();\n\n        _this14.getValidOperators(opList);\n\n        _this14.ownerOperators = opList;\n      }\n    })();\n  }\n\n  getValidVendors(vendorList) {\n    let ids = [];\n    this.listService.vendorList.forEach(element => {\n      element.forEach(element2 => {\n        if (element2.isDeleted === 0 && !ids.includes(element2.contactID)) {\n          vendorList.push(element2);\n          ids.push(element2.contactID);\n        }\n\n        if (element2.isDeleted === 1 && element2.contactID === this.driverData.vendor) {\n          this.driverData.vendor = null;\n        }\n      });\n    });\n  }\n\n  getValidOperators(operatorList) {\n    let ids = [];\n    this.listService.ownerOperatorList.forEach(element => {\n      element.forEach(element2 => {\n        if (element2.isDeleted === 0 && !ids.includes(element2.contactID)) {\n          operatorList.push(element2);\n          ids.push(element2.contactID);\n        }\n\n        if (element2.isDeleted === 1 && element2.contactID === this.driverData.ownerOperator) {\n          this.driverData.ownerOperator = null;\n        }\n      });\n    });\n  }\n\n  onAddDriver() {\n    var _this15 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this15.abstractDocs.length > 0) {\n        _this15.hasError = false;\n        _this15.hasSuccess = false;\n\n        _this15.hideErrors();\n\n        switch (_this15.paymentType) {\n          case \"ppd\":\n            _this15.payPerDelivery.default = true;\n            break;\n\n          case \"pph\":\n            _this15.payPerHour.default = true;\n            break;\n\n          case \"pp\":\n            _this15.payPercentage.default = true;\n            break;\n\n          case \"ppm\":\n            _this15.payPerMile.default = true;\n            break;\n\n          case \"pfr\":\n            _this15.payFlatRate.default = true;\n            break;\n\n          default:\n            _this15.payPerMile.default = true;\n        }\n\n        _this15.driverData.paymentOption = [_this15.payPerMile, _this15.payPerDelivery, _this15.payPerHour, _this15.payPercentage, _this15.payFlatRate];\n        _this15.driverData.createdDate = _this15.driverData.createdDate;\n        _this15.driverData.createdTime = _this15.driverData.createdTime;\n        _this15.driverData[`deletedUploads`] = _this15.deletedUploads;\n\n        for (let d = 0; d < _this15.driverData.documentDetails.length; d++) {\n          const element = _this15.driverData.documentDetails[d];\n          delete element.docStates;\n        }\n\n        for (let i = 0; i < _this15.driverData.address.length; i++) {\n          const element = _this15.driverData.address[i];\n\n          if (element.manual === true) {\n            let data = {\n              address1: element.address1,\n              address2: element.address2,\n              cityName: element.cityName,\n              stateName: element.stateName,\n              countryName: element.countryName,\n              zipCode: element.zipCode\n            };\n            $(\"#addErr\" + i).css(\"display\", \"none\");\n            let result = yield _this15.newGeoCode(data);\n\n            if (result == null) {\n              $(\"#addErr\" + i).css(\"display\", \"block\");\n              return false;\n            }\n\n            if (result != undefined || result != null) {\n              element.geoCords = result;\n            }\n          } else {\n            $(\"#addErr\" + i).css(\"display\", \"none\");\n\n            if (element.isSuggest != true && element.userLocation !== \"\") {\n              $(\"#addErr\" + i).css(\"display\", \"block\");\n              return;\n            }\n          }\n\n          delete element.states;\n          delete element.cities;\n        } // create form data instance\n\n\n        const formData = new FormData(); // append photos if any\n\n        for (let i = 0; i < _this15.uploadedPhotos.length; i++) {\n          formData.append(\"uploadedPhotos\", _this15.uploadedPhotos[i]);\n        } // append docs if any\n\n\n        for (let j = 0; j < _this15.uploadedDocs.length; j++) {\n          if (_this15.uploadedDocs[j] !== undefined) {\n            for (let k = 0; k < _this15.uploadedDocs[j].length; k++) {\n              let file = _this15.uploadedDocs[j][k];\n              formData.append(`uploadedDocs-${j}`, file);\n            }\n          }\n        } // append abstact history docs if any\n\n\n        for (let k = 0; k < _this15.abstractDocs.length; k++) {\n          formData.append(\"abstractDocs\", _this15.abstractDocs[k]);\n        } // append other fields\n\n\n        formData.append(\"data\", JSON.stringify(_this15.driverData));\n        _this15.submitDisabled = true;\n\n        try {\n          _this15.apiService.postData(\"drivers\", formData, true).subscribe({\n            complete: () => {},\n            error: err => {\n              from(err.error).pipe(map(val => {\n                // val.message = val.message.replace(/\".*\"/, 'This Field');\n                _this15.errors[val.context.key] = val.message;\n\n                _this15.spinner.hide();\n              })).subscribe({\n                complete: () => {\n                  _this15.throwErrors();\n\n                  _this15.hasError = true;\n                  _this15.submitDisabled = false;\n                },\n                error: () => {\n                  _this15.submitDisabled = false;\n                },\n                next: () => {}\n              });\n            },\n            next: res => {\n              // this.response = res;\n              // this.hasSuccess = true;\n              _this15.dashboardUtilityService.refreshDrivers = true;\n              _this15.submitDisabled = false;\n\n              _this15.toastr.success(\"Driver added successfully\");\n\n              _this15.isSubmitted = true;\n\n              _this15.modalServiceOwn.triggerRedirect.next(true);\n\n              _this15.takeUntil$.next();\n\n              _this15.takeUntil$.complete();\n\n              _this15.spinner.hide();\n\n              _this15.router.navigateByUrl(`/fleet/drivers/list/${_this15.routeMgmntService.driverUpdated()}`);\n            }\n          });\n        } catch (error) {\n          _this15.submitDisabled = false;\n          return \"error found\";\n        }\n      } else {\n        _this15.errorAbstract = true;\n\n        _this15.toastr.error(\"Abstract history document is required.\");\n      }\n    })();\n  }\n\n  userAddress(i, item) {\n    var _this16 = this;\n\n    return _asyncToGenerator(function* () {\n      _this16.driverData.address[i].userLocation = item.address;\n      let result = yield _this16.getAddressDetail(item.place_id);\n\n      if (result != undefined) {\n        _this16.driverData.address[i].zipCode = result.address.Zip;\n        _this16.driverData.address[i].geoCords.lat = result.position.lat;\n        _this16.driverData.address[i].geoCords.lng = result.position.lng;\n        _this16.driverData.address[i].countryName = result.address.CountryFullName;\n        $(\"div\").removeClass(\"show-search__result\");\n        _this16.driverData.address[i].stateName = result.address.StateName;\n        _this16.driverData.address[i].cityName = result.address.City;\n        _this16.driverData.address[i].address1 = result.address.StreetAddress ? result.address.StreetAddress : \"\";\n        _this16.driverData.address[i].isSuggest = true;\n      }\n    })();\n  }\n\n  getAddressDetail(id) {\n    var _this17 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this17.apiService.getData(`pcMiles/detail/${id}`).toPromise();\n      return result;\n    })();\n  }\n\n  remove(obj, i, addressID = null) {\n    if (obj === \"address\") {\n      this.driverData.address.splice(i, 1);\n    } else {\n      this.driverData.documentDetails.splice(i, 1);\n    }\n  }\n\n  throwErrors() {\n    from(Object.keys(this.errors)).subscribe(v => {\n      if (v === \"userName\" || v === \"email\" || v === \"employeeContractorId\" || v === \"CDL_Number\" || v === \"SIN\") {\n        $('[name=\"' + v + '\"]').after('<label id=\"' + v + '-error\" class=\"error\" for=\"' + v + '\">' + this.errors[v] + \"</label>\").addClass(\"error\");\n      }\n\n      if (v === \"abstractDocs\") {\n        $('[name=\"' + v + '\"]').after('<label class=\"text-danger\"> Abstract history document is mandatory.</label>');\n      }\n\n      if (v === \"cognito\") {\n        this.toastr.error(this.errors[v]);\n      }\n    });\n  }\n\n  hideErrors() {\n    from(Object.keys(this.errors)).subscribe(v => {\n      $('[name=\"' + v + '\"]').removeClass(\"error\").next().remove(\"label\");\n    });\n    this.errors = {};\n  }\n\n  addDocument() {\n    this.driverData.documentDetails.push({\n      documentType: \"\",\n      document: \"\",\n      issuingAuthority: \"\",\n      issuingCountry: \"\",\n      issuingState: \"\",\n      issueDate: \"\",\n      expiryDate: \"\",\n      uploadedDocs: [],\n      docStates: []\n    });\n  }\n\n  deleteInput(i) {\n    this.driverData.documentDetails.splice(i, 1);\n  }\n  /**\r\n   * fetch driver data\r\n   */\n\n\n  fetchDriverByID() {\n    var _this18 = this;\n\n    return _asyncToGenerator(function* () {\n      _this18.isEdit = true;\n      let result = yield _this18.apiService.getData(`drivers/${_this18.driverID}`).toPromise();\n      result = result.Items[0];\n\n      if (result.licenceDetails.issuedCountry && result.licenceDetails.issuedCountry != '') {\n        _this18.fetchLicStates(result.licenceDetails.issuedCountry);\n      }\n\n      if (result.address !== undefined) {\n        _this18.driverData.address = result.address;\n\n        for (let a = 0; a < _this18.driverData.address.length; a++) {\n          if (_this18.driverData.address[a].manual) {\n            _this18.driverData.address[a].isSuggest = false;\n          } else {\n            _this18.driverData.address[a].isSuggest = true;\n          }\n\n          const countryCode = _this18.driverData.address[a].countryCode;\n          const stateCode = _this18.driverData.address[a].stateCode;\n\n          _this18.fetchStates(countryCode, a);\n\n          if (countryCode !== \"\" && countryCode !== null && stateCode !== \"\" && stateCode !== null) {\n            _this18.fetchCities(countryCode, stateCode, a);\n          }\n        }\n      }\n\n      if (result.corporationType === \"owner_operator\") {\n        _this18.listService.fetchOwnerOperators();\n\n        let opList = new Array();\n\n        _this18.getValidOperators(opList);\n\n        _this18.ownerOperators = opList;\n      }\n\n      if (result.corporationType === \"company\") {\n        _this18.listService.fetchVendors();\n\n        let vendorList = new Array();\n\n        _this18.getValidVendors(vendorList);\n\n        _this18.vendors = vendorList;\n      }\n\n      _this18.driverData.driverType = result.driverType;\n      _this18.driverData.employeeContractorId = result.employeeContractorId;\n      _this18.driverData.corporationType = result.corporationType;\n      _this18.driverData.vendor = result.vendor;\n      _this18.driverData.corporation = result.corporation;\n      _this18.driverData.ownerOperator = result.ownerOperator;\n      _this18.driverData.driverStatus = result.driverStatus;\n      _this18.driverData.userName = result.userName;\n      _this18.driverData.firstName = result.firstName;\n\n      if (result.middleName === undefined) {\n        _this18.driverData.middleName = \"\";\n      } else {\n        _this18.driverData.middleName = result.middleName;\n      }\n\n      _this18.driverData.lastName = result.lastName;\n      _this18.driverData.DOB = _.isEmpty(result.DOB) ? null : result.DOB;\n      _this18.driverData.startDate = _.isEmpty(result.startDate) ? null : result.startDate;\n      _this18.driverData.terminationDate = _.isEmpty(result.terminationDate) ? null : result.terminationDate;\n      _this18.driverData.contractStart = _.isEmpty(result.contractStart) ? null : result.contractStart;\n      _this18.driverData.contractEnd = _.isEmpty(result.contractEnd) ? null : result.contractEnd;\n\n      if (result.licenceDetails.licenceExpiry && result.licenceDetails.licenceExpiry != '') {\n        _this18.driverData.licenceDetails.licenceExpiry = _.isEmpty(result.licenceDetails.licenceExpiry) ? null : result.licenceDetails.licenceExpiry;\n      }\n\n      _this18.driverData.citizenship = result.citizenship;\n      _this18.driverData.assignedVehicle = result.assignedVehicle;\n      _this18.driverData.groupID = result.groupID;\n      _this18.driverData.createdDate = result.createdDate;\n      _this18.driverData.createdTime = result.createdTime;\n      _this18.driverData.driverImage = result.driverImage;\n\n      if (result.driverImage !== \"\" && result.driverImage !== undefined) {\n        _this18.driverProfileSrc = `${_this18.Asseturl}/${result.carrierID}/${result.driverImage}`;\n        _this18.imageTitle = \"Change\";\n      } else {\n        _this18.driverProfileSrc = \"\";\n        _this18.imageTitle = \"Add\";\n      }\n\n      _this18.driverData[`abstractDocs`] = [];\n\n      if (result.abstractDocs !== undefined && result.abstractDocs.length > 0) {\n        _this18.driverData[`abstractDocs`] = result.abstractDocs;\n        _this18.absDocs = result.docsAbs;\n      }\n\n      _this18.driverData.gender = result.gender;\n      _this18.driverData.DOB = result.DOB;\n      _this18.driverData.email = result.email;\n      _this18.driverData.phone = result.phone;\n\n      for (let i = 0; i < result.documentDetails.length; i++) {\n        let docmnt = [];\n\n        if (result.documentDetails[i].uploadedDocs !== undefined && result.documentDetails[i].uploadedDocs.length > 0) {\n          docmnt = result.documentDetails[i].uploadedDocs;\n        }\n\n        _this18.newDocuments.push({\n          documentType: result.documentDetails[i].documentType,\n          document: result.documentDetails[i].document,\n          issuingAuthority: result.documentDetails[i].issuingAuthority,\n          issuingCountry: result.documentDetails[i].issuingCountry,\n          issuingState: result.documentDetails[i].issuingState,\n          issueDate: result.documentDetails[i].issueDate,\n          expiryDate: result.documentDetails[i].expiryDate,\n          uploadedDocs: docmnt\n        });\n\n        if (result.documentDetails[i].uploadedDocs !== undefined && result.documentDetails[i].uploadedDocs.length > 0) {\n          _this18.assetsDocs[i] = result.docuementUpload;\n        }\n      }\n\n      _this18.driverData.documentDetails = _this18.newDocuments;\n\n      _this18.fetchDocStates(_this18.newDocuments);\n\n      if (result.crossBorderDetails) {\n        _this18.driverData.crossBorderDetails.fastExpiry = _.isEmpty(result.crossBorderDetails.fastExpiry) ? null : result.crossBorderDetails.fastExpiry;\n        _this18.driverData.crossBorderDetails.ACI_ID = result.crossBorderDetails.ACI_ID ? result.crossBorderDetails.ACI_ID : '';\n        _this18.driverData.crossBorderDetails.ACE_ID = result.crossBorderDetails.ACE_ID ? result.crossBorderDetails.ACE_ID : '';\n        _this18.driverData.crossBorderDetails.fast_ID = result.crossBorderDetails.fast_ID ? result.crossBorderDetails.fast_ID : '';\n        _this18.driverData.crossBorderDetails.fastExpiry = result.crossBorderDetails.fastExpiry ? result.crossBorderDetails.fastExpiry : null;\n        _this18.driverData.crossBorderDetails.csa = result.crossBorderDetails.csa ? result.crossBorderDetails.csa : false;\n      }\n\n      if (result.paymentOption && result.paymentOption.length > 0) {\n        result.paymentOption.forEach(element => {\n          if (element.default) {\n            _this18.paymentType = element.pType;\n          }\n\n          if (element.pType == \"pph\") {\n            _this18.payPerHour.currency = element.currency;\n            _this18.payPerHour.rate = element.rate;\n            _this18.payPerHour.waitingHourAfter = element.waitingHourAfter;\n            _this18.payPerHour.waitingPay = element.waitingPay;\n          }\n\n          if (element.pType == \"pfr\") {\n            _this18.payFlatRate.flatRate = element.flatRate;\n            _this18.payFlatRate.currency = element.currency;\n          }\n\n          if (element.pType == \"ppm\") {\n            _this18.payPerMile.loadedMiles = element.loadedMiles;\n            _this18.payPerMile.currency = element.currency;\n            _this18.payPerMile.emptyMiles = element.emptyMiles;\n            _this18.payPerMile.emptyMilesTeam = element.emptyMilesTeam;\n            _this18.payPerMile.loadedMilesTeam = element.loadedMilesTeam;\n          }\n\n          if (element.pType == \"pp\") {\n            _this18.payPercentage.loadPayPercentage = element.loadPayPercentage;\n            _this18.payPercentage.loadPayPercentageOf = element.loadPayPercentageOf;\n          }\n\n          if (element.pType == \"ppd\") {\n            _this18.payPerDelivery.currency = element.currency;\n            _this18.payPerDelivery.deliveryRate = element.deliveryRate;\n          }\n        });\n      }\n\n      _this18.driverData.SIN = result.SIN;\n      _this18.driverData.payPeriod = result.payPeriod;\n      _this18.driverData.CDL_Number = result.CDL_Number;\n      _this18.driverData.licenceDetails.issuedCountry = result.licenceDetails.issuedCountry;\n      _this18.driverData.licenceDetails.issuedState = result.licenceDetails.issuedState;\n      _this18.driverData.licenceDetails.licCntryName = result.licenceDetails.licCntryName;\n      _this18.driverData.licenceDetails.licStateName = result.licenceDetails.licStateName;\n      _this18.driverData.licenceDetails.licenceExpiry = result.licenceDetails.licenceExpiry;\n      _this18.driverData.licenceDetails.licenceNotification = result.licenceDetails.licenceNotification;\n      _this18.driverData.licenceDetails.WCB = result.licenceDetails.WCB;\n      _this18.driverData.licenceDetails.medicalCardRenewal = result.licenceDetails.medicalCardRenewal;\n      _this18.driverData.licenceDetails.healthCare = result.licenceDetails.healthCare;\n      _this18.driverData.licenceDetails.vehicleType = result.licenceDetails.vehicleType;\n\n      if (result.hosDetails) {\n        _this18.driverData.hosDetails.hosStatus = result.hosDetails.hosStatus;\n        _this18.driverData.hosDetails.type = result.hosDetails.type;\n        _this18.driverData.hosDetails.hosRemarks = result.hosDetails.hosRemarks;\n        _this18.driverData.hosDetails.hosCycleName = result.hosDetails.hosCycleName;\n        _this18.driverData.hosDetails.homeTerminal = result.hosDetails.homeTerminal.addressID;\n        _this18.driverData.hosDetails.pcAllowed = result.hosDetails.pcAllowed;\n        _this18.driverData.hosDetails.ymAllowed = result.hosDetails.ymAllowed;\n        _this18.driverData.hosDetails.timezone = result.hosDetails.timezone;\n        _this18.driverData.hosDetails.optZone = result.hosDetails.optZone;\n      }\n\n      if (result.emergencyDetails) {\n        _this18.driverData.emergencyDetails.name = result.emergencyDetails.name;\n        _this18.driverData.emergencyDetails.relationship = result.emergencyDetails.relationship;\n        _this18.driverData.emergencyDetails.phone = result.emergencyDetails.phone;\n      }\n\n      _this18.driverData[`timeCreated`] = result.timeCreated;\n    })();\n  }\n\n  onUpdateDriver() {\n    var _this19 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this19.abstractDocs.length > 0 || _this19.absDocs.length > 0) {\n        _this19.hasError = false;\n        _this19.hasSuccess = false;\n\n        _this19.hideErrors();\n\n        _this19.payPerDelivery.default = false;\n        _this19.payPerHour.default = false;\n        _this19.payPerMile.default = false;\n        _this19.payPercentage.default = false;\n        _this19.payFlatRate.default = false;\n\n        switch (_this19.paymentType) {\n          case \"ppd\":\n            _this19.payPerDelivery.default = true;\n            break;\n\n          case \"pph\":\n            _this19.payPerHour.default = true;\n            break;\n\n          case \"pp\":\n            _this19.payPercentage.default = true;\n            break;\n\n          case \"ppm\":\n            _this19.payPerMile.default = true;\n            break;\n\n          case \"pfr\":\n            _this19.payFlatRate.default = true;\n            break;\n        }\n\n        _this19.driverData.paymentOption = [_this19.payPerMile, _this19.payPerDelivery, _this19.payPerHour, _this19.payPercentage, _this19.payFlatRate];\n        _this19.driverData[`driverID`] = _this19.driverID;\n        _this19.driverData.createdDate = _this19.driverData.createdDate;\n        _this19.driverData.createdTime = _this19.driverData.createdTime;\n        _this19.driverData[`deletedUploads`] = _this19.deletedUploads;\n\n        for (let d = 0; d < _this19.driverData.documentDetails.length; d++) {\n          const element = _this19.driverData.documentDetails[d];\n          delete element.docStates;\n        }\n\n        for (let i = 0; i < _this19.driverData.address.length; i++) {\n          const element = _this19.driverData.address[i];\n          delete element.states;\n          delete element.cities;\n\n          if (element.manual === true) {\n            let data = {\n              address1: element.address1,\n              address2: element.address2,\n              cityName: element.cityName,\n              stateName: element.stateName,\n              countryName: element.countryName,\n              zipCode: element.zipCode\n            };\n            $(\"#addErr\" + i).css(\"display\", \"none\");\n            let result = yield _this19.newGeoCode(data);\n\n            if (result == null) {\n              $(\"#addErr\" + i).css(\"display\", \"block\");\n              return false;\n            }\n\n            if (result != undefined || result != null) {\n              element.geoCords = result;\n            }\n          } else {\n            $(\"#addErr\" + i).css(\"display\", \"none\");\n\n            if (element.isSuggest != true && element.userLocation !== \"\") {\n              $(\"#addErr\" + i).css(\"display\", \"block\");\n              return;\n            }\n          }\n        } // create form data instance\n\n\n        const formData = new FormData(); // append photos if any\n\n        for (let i = 0; i < _this19.uploadedPhotos.length; i++) {\n          formData.append(\"uploadedPhotos\", _this19.uploadedPhotos[i]);\n        }\n\n        for (let j = 0; j < _this19.uploadedDocs.length; j++) {\n          if (_this19.uploadedDocs[j] !== undefined) {\n            for (let k = 0; k < _this19.uploadedDocs[j].length; k++) {\n              let file = _this19.uploadedDocs[j][k];\n              formData.append(`uploadedDocs-${j}`, file);\n            }\n          }\n        } // append abstact history docs if any\n\n\n        for (let k = 0; k < _this19.abstractDocs.length; k++) {\n          formData.append(\"abstractDocs\", _this19.abstractDocs[k]);\n        } // append other fields\n\n\n        formData.append(\"data\", JSON.stringify(_this19.driverData));\n        _this19.submitDisabled = true;\n\n        try {\n          _this19.apiService.putData(\"drivers\", formData, true).subscribe({\n            complete: () => {},\n            error: err => {\n              from(err.error).pipe(map(val => {\n                // val.message = val.message.replace(/\".*\"/, 'This Field');\n                _this19.errors[val.context.label] = val.message;\n              })).subscribe({\n                complete: () => {\n                  _this19.throwErrors();\n\n                  _this19.hasError = false;\n                  _this19.submitDisabled = false; // this.toastr.error('Please see the errors');\n                },\n                error: () => {\n                  _this19.submitDisabled = false;\n                },\n                next: () => {\n                  _this19.submitDisabled = false;\n                }\n              });\n            },\n            next: res => {\n              _this19.response = res;\n              _this19.hasSuccess = true;\n              _this19.isSubmitted = true;\n              _this19.submitDisabled = false;\n              _this19.dashboardUtilityService.refreshDrivers = true;\n\n              _this19.toastr.success(\"Driver updated successfully\");\n\n              _this19.modalServiceOwn.triggerRedirect.next(true);\n\n              _this19.takeUntil$.next();\n\n              _this19.takeUntil$.complete();\n\n              _this19.cancel();\n            }\n          });\n        } catch (error) {\n          _this19.submitDisabled = false;\n        }\n      } else {\n        _this19.errorAbstract = true;\n\n        _this19.toastr.error(\"Abstract history document is required.\");\n      }\n    })();\n  }\n\n  changePaymentModeForm(value) {}\n\n  changeCurrency(currency) {// this.driverData.paymentDetails.loadedMilesUnit = currency;\n    // this.driverData.paymentDetails.emptyMilesUnit = currency;\n    // this.driverData.paymentDetails.loadedMilesTeamUnit = currency;\n    // this.driverData.paymentDetails.emptyMilesTeamUnit = currency;\n  }\n\n  concatArray(path) {\n    this.concatArrayKeys = \"\";\n\n    for (const i in path) {\n      this.concatArrayKeys += path[i] + \".\";\n    }\n\n    this.concatArrayKeys = this.concatArrayKeys.substring(0, this.concatArrayKeys.length - 1);\n    return this.concatArrayKeys;\n  }\n\n  ngOnDestroy() {\n    this.takeUntil$.next();\n    this.takeUntil$.complete();\n  }\n\n  setPDFSrc(val) {\n    let pieces = val.split(/[\\s.]+/);\n    let ext = pieces[pieces.length - 1];\n    this.pdfSrc = \"\";\n\n    if (ext == \"doc\" || ext == \"docx\" || ext == \"xlsx\") {\n      this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(\"https://docs.google.com/viewer?url=\" + val + \"&embedded=true\");\n    } else {\n      this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(val);\n    }\n  } // Show password\n\n\n  toggleFieldTextType() {\n    this.fieldTextType = !this.fieldTextType;\n  }\n\n  togglecpwdfieldTextType() {\n    this.cpwdfieldTextType = !this.cpwdfieldTextType;\n  } // delete uploaded images and documents\n\n\n  delete(type, name, index, dIndex) {\n    if (type === \"doc\") {\n      this.driverData.documentDetails[index].uploadedDocs.splice(dIndex, 1);\n      this.assetsDocs[index].splice(dIndex, 1);\n      this.deletedUploads.push(name);\n    } else if (type === \"profile\") {\n      this.driverProfileSrc = \"\";\n      this.uploadedPhotos = [];\n      this.driverData.driverImage = \"\";\n      this.deletedUploads.push(name);\n      this.imageTitle = \"Add\";\n      $(\"#driverProfileModal\").modal(\"hide\");\n    } else if (type === \"uploaded\") {\n      this.uploadedPic = \"\";\n      this.driverProfileSrc = \"\";\n      this.showUploadedPicModal = false;\n      this.uploadedPhotos = []; // this.driverData.driverImage = '';\n\n      this.deletedUploads.push(this.driverData.driverImage);\n      $(\"#driverPicUploadedModal\").modal(\"hide\");\n      this.imageTitle = \"Add\";\n    } else {\n      this.absDocs.splice(index, 1);\n      this.driverData.abstractDocs.splice(index, 1);\n      this.deletedUploads.push(name);\n    } // this.apiService.deleteData(`drivers/uploadDelete/${name}`).subscribe((result: any) => {});\n\n  }\n\n  localDelete(type, name, index, dIndex) {\n    if (type === \"doc\") {\n      this.driverData.documentDetails[index].uploadedDocs.splice(dIndex, 1);\n      this.assetsDocs[index].splice(index, 1);\n    } else {\n      this.localAbsDocs.splice(index, 1);\n      this.abstractDocs.splice(index, 1);\n    }\n  }\n\n  complianceChange(value) {\n    if (value === \"non_Exempted\") {\n      this.driverData.hosDetails.type = \"ELD\";\n    } else {\n      this.driverData.hosDetails.type = \"Log Book\";\n      this.driverData.hosDetails.hosCycleName = \"\";\n    }\n  }\n\n  closeGroupModal() {\n    this.groupData = {\n      groupType: \"drivers\",\n      groupName: \"\",\n      groupMembers: \"\",\n      description: \"\"\n    };\n    $(\"#addDriverGroupModal\").modal(\"hide\");\n  }\n\n  validatePassword(password) {\n    let passwordVerify = passwordStrength(password);\n\n    if (passwordVerify.contains.includes(\"lowercase\")) {\n      this.passwordValidation.lowerCase = true;\n    } else {\n      this.passwordValidation.lowerCase = false;\n    }\n\n    if (passwordVerify.contains.includes(\"uppercase\")) {\n      this.passwordValidation.upperCase = true;\n    } else {\n      this.passwordValidation.upperCase = false;\n    }\n\n    if (passwordVerify.contains.includes(\"symbol\")) {\n      this.passwordValidation.specialCharacters = true;\n    } else {\n      this.passwordValidation.specialCharacters = false;\n    }\n\n    if (passwordVerify.contains.includes(\"number\")) {\n      this.passwordValidation.number = true;\n    } else {\n      this.passwordValidation.number = false;\n    }\n\n    if (passwordVerify.length >= 8) {\n      this.passwordValidation.length = true;\n    } else {\n      this.passwordValidation.length = false;\n    }\n\n    if (password.includes(\".\") || password.includes(\"-\")) {\n      this.passwordValidation.specialCharacters = true;\n    }\n  }\n\n  openModal(unit) {\n    this.listService.triggerModal(unit);\n    localStorage.setItem(\"isOpen\", \"true\");\n    this.listService.changeButton(false);\n  }\n\n  validateUserName() {\n    this.hideVal();\n\n    if (this.driverData.userName !== \"\") {\n      this.driverData.userName = this.driverData.userName.trim();\n      this.apiService.getData(`drivers/validate/username?value=${this.driverData.userName}&type=${this.pageType}`).subscribe(result => {\n        if (!result) {\n          this.errors[`userName`] = \"Username already exists\";\n          this.submitDisabled = true;\n        } else {\n          this.onChangeHideErrors(\"userName\");\n          delete this.errors[`userName`];\n        }\n\n        this.throwErrors();\n      });\n    }\n  }\n\n  validateEmployeeID() {\n    this.hideVal();\n\n    if (this.driverData.employeeContractorId !== \"\") {\n      this.driverData.employeeContractorId = this.driverData.employeeContractorId.trim();\n      this.apiService.getData(`drivers/validate/employee-id?value=${this.driverData.employeeContractorId}&type=${this.pageType}`).subscribe(result => {\n        if (!result) {\n          this.errors[`employeeContractorId`] = \"Employee ID already exists\";\n          this.submitDisabled = true;\n        } else {\n          this.onChangeHideErrors(\"employeeContractorId\");\n          delete this.errors[`employeeContractorId`];\n        }\n\n        this.throwErrors();\n      });\n    }\n  }\n\n  validateCDL() {\n    this.hideVal();\n\n    if (this.driverData.CDL_Number !== \"\") {\n      this.driverData.CDL_Number = this.driverData.CDL_Number.trim();\n      this.apiService.getData(`drivers/validate/cdl?value=${this.driverData.CDL_Number}&type=${this.pageType}&drv=${this.driverID}`).subscribe(result => {\n        if (!result) {\n          this.errors[`CDL_Number`] = \"CDL already exists\";\n          this.submitDisabled = true;\n        } else {\n          this.onChangeHideErrors(\"CDL_Number\");\n          delete this.errors[`CDL_Number`];\n        }\n\n        this.throwErrors();\n      });\n    }\n  }\n\n  validateEmail() {\n    this.hideVal();\n\n    if (this.driverData.email !== \"\") {\n      this.driverData.email = this.driverData.email.trim();\n      this.apiService.getData(`drivers/validate/email?value=${this.driverData.email}&type=${this.pageType}&drv=${this.driverData.userName}`).subscribe(result => {\n        if (!result) {\n          this.errors[`email`] = \"Email already exists\";\n          this.submitDisabled = true;\n        } else {\n          this.onChangeHideErrors(\"email\");\n          delete this.errors[`email`];\n        }\n\n        this.throwErrors();\n      });\n    }\n  }\n\n  hideVal() {\n    this.onChangeHideErrors(\"employeeContractorId\");\n    this.onChangeHideErrors(\"userName\");\n    this.onChangeHideErrors(\"CDL_Number\");\n    this.onChangeHideErrors(\"email\");\n    this.submitDisabled = false;\n  }\n\n  fetchGroupsList() {\n    this.apiService.getData('groups/get/list/type?type=drivers').subscribe(result => {\n      this.groupsData = result;\n    });\n  }\n\n};\n\nAddDriverComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: HttpClient\n}, {\n  type: ToastrService\n}, {\n  type: ActivatedRoute\n}, {\n  type: NgxSpinnerService\n}, {\n  type: HereMapService\n}, {\n  type: NgbCalendar\n}, {\n  type: DomSanitizer\n}, {\n  type: Location\n}, {\n  type: NgbModal\n}, {\n  type: ModalService\n}, {\n  type: NgbDateAdapter\n}, {\n  type: Router\n}, {\n  type: ListService\n}, {\n  type: CountryStateCityService\n}, {\n  type: DashboardUtilityService\n}, {\n  type: RouteManagementServiceService\n}];\n\nAddDriverComponent.propDecorators = {\n  driverF: [{\n    type: ViewChild,\n    args: [\"driverF\"]\n  }]\n};\nAddDriverComponent = __decorate([Component({\n  selector: \"app-add-driver\",\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], AddDriverComponent);\nexport { AddDriverComponent };","map":null,"metadata":{},"sourceType":"module"}