{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { environment } from '../../environments/environment';\nimport { Auth } from 'aws-amplify';\nimport { EMPTY, from } from 'rxjs';\nimport { switchMap } from 'rxjs/internal/operators';\nlet ApiService = class ApiService {\n  constructor(http) {\n    this.http = http;\n    this.jwt = '';\n    this.carrierID = '';\n    this.BaseUrl = environment.BaseUrl;\n    this.AssetUrl = environment.AssetURL;\n    this.AccountService = environment.AccountServiceUrl;\n    this.isUserRoles = environment.isUserRoles;\n    this.httpOptionsOld = {\n      headers: new HttpHeaders({\n        'Accept': 'text/html, application/xhtml+xml, */*',\n        'Content-Type': 'application/x-www-form-urlencoded'\n      }),\n      responseType: 'text'\n    };\n    /*\r\n      * Getting CarrierId from current LoggedIn User\r\n    */\n\n    this.getCarrierID = /*#__PURE__*/_asyncToGenerator(function* () {\n      try {\n        const response = yield Auth.currentSession();\n\n        if (response) {\n          return response.idToken.payload.carrierID;\n        } else {\n          return undefined;\n        }\n      } catch (error) {\n        return undefined;\n      }\n    });\n    this.checkIfUserActive = /*#__PURE__*/_asyncToGenerator(function* () {\n      try {\n        const response = yield Auth.currentSession();\n\n        if (response) {\n          if (response.idToken.payload.isUserActive == 0) {\n            return false;\n          } else {\n            return true;\n          }\n        }\n      } catch (error) {\n        return false;\n      }\n    });\n    this.jwt = localStorage.getItem('jwt'); //\n    // from(Auth.currentSession())\n    //     .pipe(\n    //         switchMap((auth: any) => { // switchMap() is used instead of map().\n    //\n    //           const jwt = auth.accessToken.jwtToken;\n    //           // this.httpOptions = {\n    //           //   headers: new HttpHeaders({\n    //           //     'Authorization': `Bearer ${jwt}`,\n    //           //     'Content-Type': 'application/json'\n    //           //   })\n    //           // }\n    //         })\n    //     ).subscribe();\n  }\n\n  getJwt(url, data) {\n    const headers = {\n      headers: new HttpHeaders({\n        'Content-Type': 'application/json'\n      })\n    };\n    return this.http.post(this.BaseUrl + url, data, this.httpOptions);\n  }\n\n  postData(url, data, formData = false) {\n    let headers;\n    let selectedCarrier = localStorage.getItem('xfhCarrierId') != null ? localStorage.getItem('xfhCarrierId') : '';\n\n    if (formData) {\n      headers = {\n        headers: new HttpHeaders({\n          'x-fleethawks-carrier-id': selectedCarrier\n        })\n      };\n    } else {\n      headers = {\n        headers: new HttpHeaders({\n          'Content-Type': 'application/json',\n          'x-fleethawks-carrier-id': selectedCarrier\n        })\n      };\n    }\n\n    return this.http.post(this.BaseUrl + url, data, headers);\n  }\n\n  putData(url, data, formData = false) {\n    let headers;\n    let selectedCarrier = localStorage.getItem('xfhCarrierId') != null ? localStorage.getItem('xfhCarrierId') : '';\n\n    if (formData) {\n      headers = {\n        headers: new HttpHeaders({\n          'x-fleethawks-carrier-id': selectedCarrier\n        })\n      };\n    } else {\n      headers = {\n        headers: new HttpHeaders({\n          'Content-Type': 'application/json',\n          'x-fleethawks-carrier-id': selectedCarrier\n        })\n      };\n    }\n\n    return this.http.put(this.BaseUrl + url, data, headers);\n  }\n\n  getData(url) {\n    // const headers =  {headers: new  HttpHeaders({ 'Content-Type': 'application/json',\n    //   'x-auth-token': this.jwt})\n    // };\n    let isCarrier = localStorage.getItem('carrierID') != null ? localStorage.getItem('carrierID') : '';\n    let selectedCarrier = localStorage.getItem('xfhCarrierId') != null ? localStorage.getItem('xfhCarrierId') : '';\n    const headers = {\n      headers: new HttpHeaders({\n        'Content-Type': 'application/json',\n        'fh-carrier-id': isCarrier,\n        'x-fleethawks-carrier-id': selectedCarrier\n      })\n    };\n    return this.http.get(this.BaseUrl + url, headers);\n  }\n\n  deleteData(url) {\n    // this.getHeaders();\n    // const headers =  {headers: new  HttpHeaders({ 'Content-Type': 'application/json',\n    //   'x-auth-token': this.jwt})\n    // };\n    let selectedCarrier = localStorage.getItem('xfhCarrierId') != null ? localStorage.getItem('xfhCarrierId') : '';\n    const headers = {\n      headers: new HttpHeaders({\n        'Content-Type': 'application/json',\n        'x-fleethawks-carrier-id': selectedCarrier\n      })\n    };\n    return this.http.delete(this.BaseUrl + url, headers);\n  }\n\n  getHeaders() {\n    from(Auth.currentSession()).pipe(switchMap(auth => {\n      const jwt = auth.accessToken.jwtToken;\n      this.httpOptions = {\n        headers: new HttpHeaders({\n          'Authorization': `Bearer ${jwt}`,\n          'Content-Type': 'application/json'\n        })\n      };\n      return EMPTY;\n    })).subscribe();\n  }\n\n  checkAccess() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this.isUserRoles) {\n        const user = (yield Auth.currentSession()).getIdToken().payload;\n        console.log(user.userRoles);\n        user.userRoles = user.userRoles.split(',');\n\n        if (user.userRoles.includes(\"orgAdmin\") || user.userRoles.includes(\"role_view_admin\") || user.userRoles.includes(\"role_super_admin\")) {\n          localStorage.setItem(\"isDispatchEnabled\", \"true\");\n          localStorage.setItem(\"isComplianceEnabled\", \"false\");\n          localStorage.setItem(\"isSafetyEnabled\", \"true\");\n          localStorage.setItem(\"isAccountsEnabled\", \"true\");\n          localStorage.setItem(\"isManageEnabled\", \"true\");\n          localStorage.setItem(\"isAddressBook\", \"true\");\n          return;\n        }\n\n        localStorage.setItem(\"isAddressBook\", \"false\");\n\n        if (user.userRoles.includes(\"role_safety\")) {\n          localStorage.setItem(\"isComplianceEnabled\", \"false\");\n          localStorage.setItem(\"isSafetyEnabled\", \"true\");\n        }\n\n        if (user.userRoles.includes(\"role_dispatch\")) {\n          localStorage.setItem(\"isDispatchEnabled\", \"true\");\n        }\n\n        if (user.userRoles.includes(\"role_accounts\")) {\n          localStorage.setItem(\"isAccountsEnabled\", \"true\");\n        }\n\n        if (user.userRoles.includes(\"role_address_book\")) {\n          localStorage.setItem(\"isAddressBook\", \"true\");\n        }\n      } else {\n        localStorage.setItem(\"isDispatchEnabled\", \"true\");\n        localStorage.setItem(\"isComplianceEnabled\", \"false\");\n        localStorage.setItem(\"isSafetyEnabled\", \"true\");\n        localStorage.setItem(\"isAccountsEnabled\", \"true\");\n        localStorage.setItem(\"isManageEnabled\", \"true\");\n        localStorage.setItem(\"isAddressBook\", \"true\");\n      } // switch(true){\n      //   case user.userRoles.includes(\"role_safety\"):\n      //     environment.isSafetyEnabled= true;\n      //     environment.isComplianceEnabled=true;\n      //     break;\n      //   case user.userRoles.includes(\"role_dispatch\"):\n      //     environment.isDispatchEnabled= true;\n      //     break;\n      //   case user.userRoles.includes(\"role_accounts\"):\n      //     environment.isAccountsEnabled=true;\n      //     break;\n      //       }\n\n    })();\n  }\n\n  getDatatablePostData(url, data) {\n    // this.getHeaders();\n    const headers = {\n      headers: new HttpHeaders({\n        'Content-Type': 'application/json'\n      })\n    }; // const headers =  {headers: new  HttpHeaders({ 'Content-Type': 'application/json',\n    //   'x-auth-token': this.jwt})\n    // };\n\n    return this.http.post(this.BaseUrl + url, data, headers);\n  }\n\n  getCarrierUserName() {\n    return localStorage.getItem('currentLoggedUserName');\n  }\n\n};\n\nApiService.ctorParameters = () => [{\n  type: HttpClient\n}];\n\nApiService = __decorate([Injectable({\n  providedIn: 'root'\n})], ApiService);\nexport { ApiService };","map":null,"metadata":{},"sourceType":"module"}