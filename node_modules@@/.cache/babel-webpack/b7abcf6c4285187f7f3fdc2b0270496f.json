{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./driver-setting.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./driver-setting.component.css\";\nimport { Component } from '@angular/core';\nimport { ToastrService } from 'ngx-toastr';\nimport { ApiService } from '../../../../services';\nimport Constants from '../../constants';\nimport * as _ from 'lodash';\nlet DriverSettingComponent = class DriverSettingComponent {\n  constructor(apiService, toastr) {\n    this.apiService = apiService;\n    this.toastr = toastr;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.driverID = '';\n    this.driverName = '';\n    this.lastEvaluatedKey = '';\n    this.loaded = false;\n    this.suggestedDrivers = [];\n    this.driverType = null;\n    this.drivers = [];\n    this.getSuggestions = _.debounce(function (value) {\n      this.driverID = '';\n      value = value.toLowerCase();\n\n      if (value !== '') {\n        this.apiService.getData(`drivers/get/deleted/drivers/suggestions/${value}`).subscribe(result => {\n          result.map(v => {\n            if (v.lastName === undefined) {\n              v.lastName = '';\n            }\n\n            return v;\n          });\n          this.suggestedDrivers = result;\n        });\n      } else {\n        this.suggestedDrivers = [];\n      }\n    }, 800);\n  }\n\n  ngOnInit() {\n    this.initDataTable();\n  }\n\n  setDriver(driverID, firstName = \"\", lastName = \"\", middleName = \"\") {\n    if (middleName !== \"\") {\n      this.driverName = `${firstName} ${middleName} ${lastName}`; // this.driverID = driverID;\n\n      this.driverID = `${firstName} ${middleName} ${lastName}`;\n    } else {\n      this.driverName = `${firstName} ${lastName}`;\n      this.driverID = `${firstName} ${lastName}`;\n    }\n\n    this.suggestedDrivers = [];\n  }\n\n  initDataTable() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this.lastEvaluatedKey !== 'end') {\n        const result = yield _this.apiService.getData(`drivers/deleted/fetch/records?driver=${_this.driverID}&lastKey=${_this.lastEvaluatedKey}&type=${_this.driverType}`).toPromise();\n\n        if (result.Items.length === 0) {\n          _this.dataMessage = Constants.NO_RECORDS_FOUND;\n        }\n\n        result.Items.map(v => {\n          v.url = `/fleet/drivers/detail/${v.driverID}`;\n        });\n        _this.suggestedDrivers = [];\n\n        if (result.Items.length > 0) {\n          if (result.LastEvaluatedKey !== undefined) {\n            _this.lastEvaluatedKey = encodeURIComponent(result.Items[result.Items.length - 1].driverSK);\n          } else {\n            _this.lastEvaluatedKey = 'end';\n          }\n\n          _this.drivers = _this.drivers.concat(result.Items);\n          _this.loaded = true;\n        }\n      }\n    })();\n  }\n\n  onScroll() {\n    if (this.loaded) {\n      this.initDataTable();\n    }\n\n    this.loaded = false;\n  }\n\n  refreshData() {\n    this.drivers = [];\n    this.driverID = '';\n    this.driverName = '';\n    this.driverType = null;\n    this.lastEvaluatedKey = '';\n    this.dataMessage = Constants.FETCHING_DATA;\n  }\n\n  searchFilter() {\n    if (this.driverName !== '' || this.driverType !== null) {\n      this.driverName = this.driverName.toLowerCase();\n\n      if (this.driverID == '') {\n        this.driverID = this.driverName;\n      }\n\n      this.drivers = [];\n      this.dataMessage = Constants.FETCHING_DATA;\n      this.lastEvaluatedKey = '';\n      this.suggestedDrivers = [];\n      this.initDataTable();\n    } else {\n      return false;\n    }\n  }\n\n  resetFilter() {\n    if (this.driverName !== '' || this.driverType !== null || this.lastEvaluatedKey !== '') {\n      this.driverID = '';\n      this.driverName = '';\n      this.driverType = null;\n      this.drivers = [];\n      this.lastEvaluatedKey = '';\n      this.dataMessage = Constants.FETCHING_DATA;\n      this.initDataTable();\n    } else {\n      return false;\n    }\n  }\n\n  restoreDriver(eventData) {\n    if (confirm('Are you sure you want to restore?') === true) {\n      this.apiService.deleteData(`drivers/restore/driver/${eventData.driverID}/${eventData.firstName}/${eventData.lastName}/${eventData.userName}`).subscribe(result => {\n        this.drivers = [];\n        this.dataMessage = Constants.FETCHING_DATA;\n        this.lastEvaluatedKey = '';\n        this.initDataTable();\n        this.toastr.success('Driver is restored!');\n      });\n    }\n  }\n\n};\n\nDriverSettingComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: ToastrService\n}];\n\nDriverSettingComponent = __decorate([Component({\n  selector: 'app-driver-setting',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], DriverSettingComponent);\nexport { DriverSettingComponent };","map":null,"metadata":{},"sourceType":"module"}