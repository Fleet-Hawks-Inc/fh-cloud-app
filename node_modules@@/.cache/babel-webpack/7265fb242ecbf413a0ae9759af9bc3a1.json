{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./purchase-orders-list.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./purchase-orders-list.component.css\";\nimport { Component } from \"@angular/core\";\nimport { ToastrService } from \"ngx-toastr\";\nimport Constants from \"src/app/pages/fleet/constants\";\nimport { AccountService, ApiService, DashboardUtilityService } from \"src/app/services\";\nlet PurchaseOrdersListComponent = class PurchaseOrdersListComponent {\n  constructor(apiService, accountService, toastr, dashboardUtilityService) {\n    this.apiService = apiService;\n    this.accountService = accountService;\n    this.toastr = toastr;\n    this.dashboardUtilityService = dashboardUtilityService;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.dateMinLimit = {\n      year: 1950,\n      month: 1,\n      day: 1\n    };\n    this.date = new Date();\n    this.futureDatesLimit = {\n      year: this.date.getFullYear() + 30,\n      month: 12,\n      day: 31\n    };\n    this.payOrders = [];\n    this.filter = {\n      category: null,\n      unit: '',\n      status: null,\n      startDate: '',\n      endDate: ''\n    };\n    this.disableSearch = true;\n    this.lastItemSK = \"\";\n    this.loaded = false;\n    this.emailDisabled = false;\n    this.vendors = {};\n    this.allStatus = [{\n      name: 'Open',\n      value: 'open'\n    }, {\n      name: 'Sent',\n      value: 'sent'\n    }, {\n      name: 'Closed',\n      value: 'closed'\n    }, {\n      name: 'Cancelled',\n      value: 'cancelled'\n    }];\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this.fetchVendor();\n      yield _this.fetchPurchases();\n    })();\n  }\n\n  fetchVendor() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this2.apiService.getData(`contacts/get/list/vendor`).toPromise();\n      _this2.vendors = result;\n    })();\n  }\n\n  resetUnit(value) {\n    if (value === 'vendor') {\n      this.filter.unit = null;\n    } else {\n      this.filter.unit = '';\n    }\n  }\n\n  fetchPurchases() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this3.lastItemSK !== \"end\") {\n        let category = null;\n        let unit = null;\n\n        if (_this3.filter.category) {\n          category = `${_this3.filter.category}`;\n        }\n\n        if (_this3.filter.unit) {\n          unit = encodeURIComponent(`\"${_this3.filter.unit}\"`);\n        }\n\n        let result = yield _this3.accountService.getData(`purchase-orders/paging?category=${category}&unit=${unit}&status=${_this3.filter.status}&start=${_this3.filter.startDate}&end=${_this3.filter.endDate}&lastKey=${_this3.lastItemSK}`).toPromise();\n        _this3.disableSearch = false;\n\n        if (result.length === 0) {\n          _this3.dataMessage = Constants.NO_RECORDS_FOUND;\n        }\n\n        _this3.lastItemSK = \"end\";\n\n        if (result.length > 0 && result[result.length - 1].sk !== undefined) {\n          _this3.lastItemSK = encodeURIComponent(result[result.length - 1].sk);\n        } else {\n          _this3.lastItemSK = \"end\";\n        }\n\n        result.map(v => {\n          v.url = `/accounts/purchases/orders/detail/${v.purchaseID}`;\n          v.editUrl = `/accounts/purchases/orders/edit/${v.purchaseID}`;\n\n          _this3.payOrders.push(v);\n        });\n        _this3.loaded = true;\n      }\n    })();\n  }\n\n  deleteOrder(data) {\n    if (confirm(\"Are you sure you want to delete?\") === true) {\n      this.accountService.deleteData(`purchase-orders/delete/${data.purchaseID}`).subscribe({\n        complete: () => {},\n        error: () => {},\n        next: result => {\n          this.dataMessage = Constants.FETCHING_DATA;\n          this.lastItemSK = \"\";\n          this.payOrders = [];\n          this.fetchPurchases();\n          this.toastr.success(\"Purchase order deleted successfully\");\n        }\n      });\n    }\n  }\n\n  searchFilter() {\n    if (this.filter.category !== null || this.filter.unit !== '' || this.filter.status !== null || this.filter.startDate !== '' || this.filter.endDate !== '') {\n      if (this.filter.startDate !== '' && this.filter.endDate === '') {\n        this.toastr.error('Please select both start and end dates.');\n        return false;\n      } else if (this.filter.startDate === '' && this.filter.endDate !== '') {\n        this.toastr.error('Please select both start and end dates.');\n        return false;\n      } else if (this.filter.startDate > this.filter.endDate) {\n        this.toastr.error('Start date should be less then end date');\n        return false;\n      } else {\n        this.payOrders = [];\n        this.lastItemSK = \"\";\n        this.disableSearch = true;\n        this.dataMessage = Constants.FETCHING_DATA;\n        this.fetchPurchases();\n      }\n    }\n  }\n\n  resetFilter() {\n    this.filter = {\n      category: null,\n      unit: '',\n      status: null,\n      startDate: '',\n      endDate: ''\n    };\n    this.payOrders = [];\n    this.lastItemSK = \"\";\n    this.disableSearch = true;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.fetchPurchases();\n  }\n\n  onScroll() {\n    if (this.loaded) {\n      this.fetchPurchases();\n    }\n\n    this.loaded = false;\n  }\n\n  sendConfirmationEmail(i, purchaseID) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      _this4.emailDisabled = true;\n      let result = yield _this4.accountService.getData(`purchase-orders/send/confirmation-email/${purchaseID}`).toPromise();\n      _this4.emailDisabled = false;\n\n      if (result) {\n        _this4.toastr.success(\"Email sent successfully\");\n\n        _this4.payOrders[i].status = 'sent';\n      } else {\n        _this4.toastr.error(\"Something went wrong.\");\n      }\n    })();\n  }\n\n};\n\nPurchaseOrdersListComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: AccountService\n}, {\n  type: ToastrService\n}, {\n  type: DashboardUtilityService\n}];\n\nPurchaseOrdersListComponent = __decorate([Component({\n  selector: \"app-purchase-orders-list\",\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], PurchaseOrdersListComponent);\nexport { PurchaseOrdersListComponent };","map":null,"metadata":{},"sourceType":"module"}