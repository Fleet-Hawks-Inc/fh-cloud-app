{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./vehicle-list.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./vehicle-list.component.css\";\nimport { HttpClient } from '@angular/common/http';\nimport { Component, Input, ViewChild } from '@angular/core';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { NgbModal } from '@ng-bootstrap/ng-bootstrap';\nimport { NgSelectComponent } from \"@ng-select/ng-select\";\nimport { ActivatedRoute, Router } from '@angular/router';\nimport * as _ from 'lodash';\nimport { NgxSpinnerService } from 'ngx-spinner';\nimport { ToastrService } from 'ngx-toastr';\nimport { environment } from '../../../../../environments/environment';\nimport { ApiService, HereMapService } from '../../../../services';\nimport { OnboardDefaultService } from '../../../../services/onboard-default.service';\nimport Constants from '../../constants';\nlet VehicleListComponent = class VehicleListComponent {\n  constructor(apiService, httpClient, hereMap, toastr, spinner, onboard, _sanitizer, modalService, route, router) {\n    var _this = this;\n\n    this.apiService = apiService;\n    this.httpClient = httpClient;\n    this.hereMap = hereMap;\n    this.toastr = toastr;\n    this.spinner = spinner;\n    this.onboard = onboard;\n    this._sanitizer = _sanitizer;\n    this.modalService = modalService;\n    this.route = route;\n    this.router = router;\n    this.documentsTypesObects = {};\n    this.mapView = false;\n    this.listView = true;\n    this.visible = true;\n    this.loadMsg = Constants.NO_LOAD_DATA;\n    this.isSearch = false;\n    this.get = _.get;\n    this.environment = environment.isFeatureEnabled;\n    this.dataMessage = Constants.FETCHING_DATA;\n    this.title = 'Vehicle List';\n    this.vehicles = [];\n    this.suggestedVehicles = [];\n    this.vehicleID = '';\n    this.currentStatus = null;\n    this.vehicleIdentification = '';\n    this.allOptions = {};\n    this.groupsList = {};\n    this.vehicleModelList = {};\n    this.vehicleManufacturersList = {};\n    this.serviceProgramsList = {};\n    this.driversList = {};\n    this.vendorsList = {};\n    this.currentView = 'list';\n    this.totalRecords = 20;\n    this.pageLength = 10;\n    this.lastEvaluatedKey = '';\n    this.hideShow = {\n      vin: true,\n      vehicleName: true,\n      vehicleType: true,\n      make: true,\n      model: true,\n      lastLocation: true,\n      trip: false,\n      plateNo: true,\n      fuelType: true,\n      status: true,\n      group: false,\n      ownership: true,\n      driver: true,\n      serviceProgram: false,\n      serviceDate: false,\n      insuranceVendor: false,\n      insuranceAmount: false,\n      engineSummary: false,\n      primaryMeter: false,\n      fuelUnit: false,\n      startDate: true,\n      year: true,\n      annualSafety: true,\n      teamDriver: true\n    };\n    this.vehicleNext = false;\n    this.vehiclePrev = true;\n    this.vehicleDraw = 0;\n    this.vehiclePrevEvauatedKeys = [''];\n    this.vehicleStartPoint = 1;\n    this.vehicleEndPoint = this.pageLength;\n    this.vehicleTypeObects = {};\n    this.lastItemSK = '';\n    this.loaded = false; // columns of data table\n\n    this.dataColumns = [{\n      field: 'vehicleIdentification',\n      header: 'Name/Number',\n      type: \"text\"\n    }, {\n      field: 'VIN',\n      header: 'VIN',\n      type: \"text\"\n    }, {\n      field: 'lifeCycle.startDate',\n      header: 'Start Date',\n      type: \"text\"\n    }, {\n      field: 'manufacturerID',\n      header: 'Make',\n      type: \"text\"\n    }, {\n      field: 'modelID',\n      header: 'Model',\n      type: \"text\"\n    }, {\n      field: 'year',\n      header: 'Year',\n      type: \"text\"\n    }, {\n      field: 'annualSafetyDate',\n      header: 'Annual Safety Date',\n      type: \"text\"\n    }, {\n      field: 'ownership',\n      header: 'Ownership',\n      type: \"text\"\n    }, {\n      field: 'driverList.driverID',\n      header: 'Driver Assigned',\n      type: 'text'\n    }, {\n      field: 'driverList.teamDriverID',\n      header: 'Team Driver Assigned',\n      type: 'text'\n    }, {\n      field: 'plateNumber',\n      header: 'Plate Number',\n      type: \"text\"\n    }, {\n      field: 'dashCamSerNo',\n      header: 'DashCam',\n      type: \"text\"\n    }, {\n      field: 'currentStatus',\n      header: 'Status',\n      type: 'text'\n    }];\n    this.getSuggestions = _.debounce(function (value) {\n      value = value.toLowerCase();\n\n      if (value != '') {\n        this.loadMsg = Constants.LOAD_DATA;\n        this.apiService.getData(`vehicles/suggestion/${value}`).subscribe(result => {\n          if (result.length === 0) {\n            this.suggestedVehicles = [];\n            this.loadMsg = Constants.NO_LOAD_FOUND;\n          }\n\n          if (result.length > 0) {\n            this.suggestedVehicles = result;\n          } else {\n            this.suggestedVehicles = [];\n          }\n        });\n      } else {\n        this.suggestedVehicles = [];\n      }\n    }, 800);\n\n    this.onScroll = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (event) {\n        if (_this.loaded) {\n          _this.initDataTable();\n        }\n\n        _this.loaded = false;\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  }\n\n  ngOnInit() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      _this2.onboard.checkInspectionForms();\n\n      _this2.setToggleOptions();\n\n      _this2.setVehiclesOptions();\n\n      _this2.fetchGroups(); // this.fetchVehicleModelList();\n      // this.fetchVehicleManufacturerList();\n\n\n      _this2.fetchDriversList();\n\n      _this2.fetchServiceProgramsList();\n\n      _this2.fetchVendorList();\n\n      yield _this2.initDataTable();\n      $(document).ready(() => {\n        setTimeout(() => {\n          $('#DataTables_Table_0_wrapper .dt-buttons').addClass('custom-dt-buttons').prependTo('.page-buttons');\n        }, 1800);\n      });\n\n      _this2.httpClient.get('assets/vehicleType.json').subscribe(data => {\n        _this2.vehicleTypeObects = data.reduce((a, b) => {\n          return a[b['code']] = b['name'], a;\n        }, {});\n      });\n    })();\n  }\n\n  setVehiclesOptions() {\n    this.vehStatus = [{\n      'name': 'Active',\n      'value': 'active'\n    }, {\n      'name': 'Inactive',\n      'value': 'inActive'\n    }, {\n      'name': 'Out of Service',\n      'value': 'outOfService'\n    }, {\n      'name': 'Sold',\n      'value': 'sold'\n    }];\n  }\n\n  setToggleOptions() {\n    this.selectedColumns = this.dataColumns;\n  }\n\n  get selectedColumns() {\n    return this._selectedColumns;\n  }\n\n  set selectedColumns(val) {\n    //restore original order\n    this._selectedColumns = this.dataColumns.filter(col => val.includes(col));\n  }\n\n  setVehicle(vehicleIdentification) {\n    if (vehicleIdentification != undefined && vehicleIdentification != '') {\n      this.vehicleIdentification = vehicleIdentification;\n    }\n\n    this.loadMsg = Constants.NO_LOAD_DATA;\n  }\n\n  changeVehicleID() {\n    this.vehicleID = '';\n  }\n\n  fetchGroups() {\n    this.apiService.getData('groups/get/list').subscribe(result => {\n      this.groupsList = result;\n    });\n  }\n\n  fetchVehicleModelList() {\n    this.apiService.getData('vehicleModels/get/list').subscribe(result => {\n      this.vehicleModelList = result;\n    });\n  } // fetchVehicleManufacturerList() {\n  //   this.apiService.getData('manufacturers/get/list').subscribe((result: any) => {\n  //     this.vehicleManufacturersList = result;\n  //   });\n  // }\n\n\n  fetchDriversList() {\n    this.apiService.getData('drivers/get/list').subscribe(result => {\n      this.driversList = result;\n    });\n  }\n\n  fetchServiceProgramsList() {\n    this.apiService.getData('servicePrograms/get/list').subscribe(result => {\n      this.serviceProgramsList = result;\n    });\n  }\n\n  fetchVendorList() {\n    this.apiService.getData('contacts/get/list/vendor').subscribe(result => {\n      this.vendorsList = result;\n    });\n  }\n  /**\r\n   * change the view of summary\r\n   */\n\n\n  changeView() {\n    if (this.currentView == 'list') {\n      this.currentView = 'map';\n      setTimeout(() => {\n        this.hereMap.mapInit();\n      }, 500);\n    } else {\n      this.currentView = 'list';\n    }\n  }\n  /**\r\n   * export excel\r\n   */\n\n\n  export() {\n    $('.buttons-excel').trigger('click');\n  }\n\n  initDataTable() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (_this3.lastEvaluatedKey !== 'end') {\n        let result = yield _this3.apiService.getData('vehicles/fetch/records?vehicle=' + _this3.vehicleID + '&status=' + _this3.currentStatus + '&lastKey=' + _this3.lastEvaluatedKey).toPromise();\n\n        if (result.Items.length === 0) {\n          _this3.dataMessage = Constants.NO_RECORDS_FOUND;\n          _this3.loaded = true;\n        }\n\n        result.Items.map(v => {\n          v.url = `/fleet/vehicles/detail/${v.vehicleID}`;\n        });\n        _this3.suggestedVehicles = [];\n\n        if (result.LastEvaluatedKey !== undefined) {\n          _this3.lastEvaluatedKey = encodeURIComponent(result.Items[result.Items.length - 1].vehicleSK);\n        } else {\n          _this3.lastEvaluatedKey = 'end';\n        }\n\n        _this3.vehicles = _this3.vehicles.concat(result.Items);\n        _this3.loaded = true;\n        _this3.isSearch = false;\n        yield _this3.getDashCamConnection(_this3.vehicles);\n        yield _this3.getDashCamStatus(_this3.vehicles);\n      }\n    })();\n  }\n  /**\r\n   * Get device status dashCam Connection\r\n   * @param vehicleList all the vehicles\r\n   */\n\n\n  getDashCamConnection(vehicleList) {\n    return _asyncToGenerator(function* () {\n      if (vehicleList && vehicleList.length > 0) {\n        for (const data of vehicleList) {\n          if (data.deviceInfo) {\n            data['isDashCam'] = true;\n          }\n        }\n      }\n    })();\n  }\n  /**\r\n   * Get device status from DashCam\r\n   * @param vehicleList all the vehicles\r\n   */\n\n\n  getDashCamStatus(vehicleList) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      if (vehicleList && vehicleList.length > 0) {\n        for (const data of vehicleList) {\n          if (data.deviceInfo) {\n            const deviceId = data.deviceInfo[0].deviceSrNo.split('#')[1];\n            const response = yield _this4.apiService.getData(`vehicles/dashCam/status/${deviceId}`).toPromise();\n\n            if (response && response.isOnline !== undefined) {\n              data['isDashOnline'] = response.isOnline;\n            }\n          }\n        }\n      }\n    })();\n  }\n\n  searchFilter() {\n    if (this.vehicleIdentification !== '' || this.currentStatus !== null) {\n      this.vehicleIdentification = this.vehicleIdentification.toLowerCase();\n\n      if (this.vehicleID == '') {\n        this.vehicleID = this.vehicleIdentification;\n      }\n\n      this.isSearch = true;\n      this.vehicles = [];\n      this.dataMessage = Constants.FETCHING_DATA;\n      this.lastEvaluatedKey = '';\n      this.initDataTable();\n    } else {\n      return false;\n    }\n  }\n\n  clearInput() {\n    this.suggestedVehicles = null;\n  }\n\n  clearSuggestions() {\n    this.vehicleIdentification = null;\n  }\n\n  resetFilter() {\n    if (this.vehicleIdentification !== '' || this.currentStatus !== null) {\n      this.isSearch = true;\n      this.vehicleID = '';\n      this.vehicleIdentification = '';\n      this.currentStatus = null;\n      this.vehicles = [];\n      this.loaded = false;\n      this.lastEvaluatedKey = '';\n      this.suggestedVehicles = null;\n      this.initDataTable();\n      this.dataMessage = Constants.FETCHING_DATA;\n    } else {\n      return false;\n    }\n  }\n\n  deleteVehicle(eventData) {\n    if (confirm('Are you sure you want to delete?') === true) {\n      // let record = {\n      //   date: eventData.createdDate,\n      //   time: eventData.createdTime,\n      //   eventID: eventData.vehicleID,\n      //   status: eventData.currentStatus\n      // }\n      this.apiService.deleteData(`vehicles/delete/${eventData.vehicleID}/${eventData.vehicleIdentification}`).subscribe(result => {\n        this.vehicles = [];\n        this.vehicleDraw = 0;\n        this.dataMessage = Constants.FETCHING_DATA;\n        this.lastEvaluatedKey = ''; // this.fetchVehiclesCount();\n\n        this.initDataTable();\n        this.toastr.success('Vehicle Deleted Successfully!');\n      });\n    }\n  }\n\n  hideShowColumn() {\n    //for headers\n    if (this.hideShow.vin == false) {\n      $('.col1').css('display', 'none');\n    } else {\n      $('.col1').css('display', '');\n    }\n\n    if (this.hideShow.vehicleName == false) {\n      $('.col2').css('display', 'none');\n    } else {\n      $('.col2').css('display', '');\n    }\n\n    if (this.hideShow.vehicleType == false) {\n      $('.col3').css('display', 'none');\n    } else {\n      $('.col3').css('display', '');\n    }\n\n    if (this.hideShow.make == false) {\n      $('.col4').css('display', 'none');\n    } else {\n      $('.col4').css('display', '');\n    }\n\n    if (this.hideShow.model == false) {\n      $('.col5').css('display', 'none');\n    } else {\n      $('.col5').removeClass('extra');\n      $('.col5').css('display', '');\n      $('.col5').css('min-width', '120px');\n    }\n\n    if (this.hideShow.lastLocation == false) {\n      $('.col6').css('display', 'none');\n    } else {\n      $('.col6').css('display', '');\n    }\n\n    if (this.hideShow.trip == false) {\n      $('.col7').css('display', 'none');\n    } else {\n      $('.col7').removeClass('extra');\n      $('.col7').css('display', '');\n      $('.col7').css('min-width', '200px');\n    }\n\n    if (this.hideShow.plateNo == false) {\n      $('.col8').css('display', 'none');\n    } else {\n      $('.col8').css('display', '');\n    }\n\n    if (this.hideShow.fuelType == false) {\n      $('.col9').css('display', 'none');\n    } else {\n      $('.col9').css('display', '');\n    }\n\n    if (this.hideShow.status == false) {\n      $('.col10').css('display', 'none');\n    } else {\n      $('.col10').css('display', '');\n    }\n\n    if (this.hideShow.group == false) {\n      $('.col11').css('display', 'none');\n    } else {\n      $('.col11').removeClass('extra');\n      $('.col11').css('display', '');\n      $('.col11').css('min-width', '200px');\n    }\n\n    if (this.hideShow.ownership == false) {\n      $('.col12').css('display', 'none');\n    } else {\n      $('.col12').removeClass('extra');\n      $('.col12').css('display', '');\n      $('.col12').css('min-width', '200px');\n    } //extra columns\n\n\n    if (this.hideShow.driver == false) {\n      $('.col13').css('display', 'none');\n    } else {\n      $('.col13').removeClass('extra');\n      $('.col13').css('display', '');\n      $('.col13').css('min-width', '200px');\n    }\n\n    if (this.hideShow.serviceProgram == false) {\n      $('.col14').css('display', 'none');\n    } else {\n      $('.col14').removeClass('extra');\n      $('.col14').css('display', '');\n      $('.col14').css('min-width', '200px');\n    }\n\n    if (this.hideShow.serviceDate == false) {\n      $('.col15').css('display', 'none');\n    } else {\n      $('.col15').removeClass('extra');\n      $('.col15').css('display', '');\n      $('.col15').css('min-width', '200px');\n    }\n\n    if (this.hideShow.insuranceVendor == false) {\n      $('.col16').css('display', 'none');\n    } else {\n      $('.col16').removeClass('extra');\n      $('.col16').css('display', '');\n      $('.col16').css('min-width', '200px');\n    }\n\n    if (this.hideShow.insuranceAmount == false) {\n      $('.col17').css('display', 'none');\n    } else {\n      $('.col17').removeClass('extra');\n      $('.col17').css('display', '');\n      $('.col17').css('min-width', '200px');\n    }\n\n    if (this.hideShow.engineSummary == false) {\n      $('.col18').css('display', 'none');\n    } else {\n      $('.col18').removeClass('extra');\n      $('.col18').css('display', '');\n      $('.col18').css('min-width', '200px');\n    }\n\n    if (this.hideShow.primaryMeter == false) {\n      $('.col19').css('display', 'none');\n    } else {\n      $('.col19').removeClass('extra');\n      $('.col19').css('display', '');\n      $('.col19').css('min-width', '200px');\n    }\n\n    if (this.hideShow.fuelUnit == false) {\n      $('.col20').css('display', 'none');\n    } else {\n      $('.col20').removeClass('extra');\n      $('.col20').css('display', '');\n      $('.col20').css('min-width', '200px');\n    }\n  }\n\n  refreshData() {\n    this.vehicleID = '';\n    this.suggestedVehicles = [];\n    this.vehicleIdentification = '';\n    this.currentStatus = null;\n    this.vehicles = [];\n    this.lastEvaluatedKey = '';\n    this.loaded = false;\n    this.initDataTable();\n    this.dataMessage = Constants.FETCHING_DATA;\n  }\n  /**\r\n   * Open Live View popup.\r\n   * @param content\r\n   */\n\n\n  openLiveView(content, vehicle, deviceInfo) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      let deviceId = undefined;\n\n      if (deviceInfo && deviceInfo.length > 0) {\n        deviceId = deviceInfo[0].deviceSrNo.split('#')[1];\n        const response = yield _this5.apiService.getData(`vehicles/dashCam/liveFeed/${deviceId}`).toPromise();\n        _this5.url = _this5._sanitizer.bypassSecurityTrustResourceUrl(response.feedUrl);\n        _this5.liveStreamVehicle = `(${vehicle})`;\n\n        _this5.modalService.open(content, {\n          ariaLabelledBy: 'modal-dash-cam'\n        }).result.then(result => {}, reason => {});\n\n        _this5.liveModalTimeout = setTimeout(() => {\n          _this5.modalService.dismissAll();\n        }, 60000);\n      } else {\n        _this5.toastr.error('Connection to DashCam failed.');\n      }\n    })();\n  }\n  /**\r\n   * Clears the setTimeout if required. Currently it is not viewed\r\n   */\n\n\n  clearVideoTimeout() {\n    clearTimeout(this.liveModalTimeout);\n  }\n  /**\r\n  * Clears the table filters\r\n  * @param table Table\r\n  */\n\n\n  clear(table) {\n    table.clear();\n  }\n\n};\n\nVehicleListComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: HttpClient\n}, {\n  type: HereMapService\n}, {\n  type: ToastrService\n}, {\n  type: NgxSpinnerService\n}, {\n  type: OnboardDefaultService\n}, {\n  type: DomSanitizer\n}, {\n  type: NgbModal\n}, {\n  type: ActivatedRoute\n}, {\n  type: Router\n}];\n\nVehicleListComponent.propDecorators = {\n  table: [{\n    type: ViewChild,\n    args: ['dt']\n  }],\n  ngSelectComponent: [{\n    type: ViewChild,\n    args: [NgSelectComponent]\n  }],\n  selectedColumns: [{\n    type: Input\n  }]\n};\nVehicleListComponent = __decorate([Component({\n  selector: 'app-vehicle-list',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], VehicleListComponent);\nexport { VehicleListComponent };","map":null,"metadata":{},"sourceType":"module"}