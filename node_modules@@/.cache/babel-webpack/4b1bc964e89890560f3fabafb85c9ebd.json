{"ast":null,"code":"import { __awaiter, __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./order-detail.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./order-detail.component.css\";\nimport { Component, ViewChild } from \"@angular/core\";\nimport { AccountService, ApiService, ListService } from \"../../../../services\";\nimport { ActivatedRoute } from \"@angular/router\";\nimport { DomSanitizer } from \"@angular/platform-browser\";\nimport { environment } from \"src/environments/environment\";\nimport { ToastrService } from \"ngx-toastr\";\nimport * as html2pdf from \"html2pdf.js\";\nimport { from } from \"rxjs\";\nimport { map } from \"rxjs/operators\";\nimport { NgbModal } from \"@ng-bootstrap/ng-bootstrap\";\nimport { PdfViewerComponent } from \"ng2-pdf-viewer\";\nimport * as moment from \"moment\";\nimport Constants from \"src/app/pages/fleet/constants\";\nimport { Location } from \"@angular/common\";\nimport { Auth } from \"aws-amplify\";\nlet OrderDetailComponent = class OrderDetailComponent {\n  constructor(apiService, accountService, modalService, domSanitizer, route, toastr, listService, location) {\n    this.apiService = apiService;\n    this.accountService = accountService;\n    this.modalService = modalService;\n    this.domSanitizer = domSanitizer;\n    this.route = route;\n    this.toastr = toastr;\n    this.listService = listService;\n    this.location = location;\n    this.environment = environment.isFeatureEnabled;\n    this.noLogsMsg = Constants.NO_RECORDS_FOUND;\n    this.carrierEmail = \"\";\n    this.isCopy = false;\n    this.docs = [];\n    this.attachments = [];\n    this.tripDocs = [];\n    this.localPhotos = [];\n    this.uploadedDocs = [];\n    this.selectedItem = \"\";\n    this.consineeData = [];\n    this.shipperData = [];\n    this.Asseturl = this.apiService.AssetUrl;\n    this.shipperReceiversInfos = [];\n    this.totalTax = 0;\n    this.shippersObjects = {};\n    this.receiversObjects = {};\n    this.customersObjects = {};\n    this.totalPickups = 0;\n    this.totalDrops = 0;\n    this.templateList = [\"assets/img/invoice.png\", \"assets/img/invoice.png\"];\n    this.orderDocs = [];\n    this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(\"\");\n    this.pdFile = \"https://vadimdez.github.io/ng2-pdf-viewer/assets/pdf-test.pdf\";\n    this.pageVariable = 1;\n    /**\r\n     * Form props\r\n     */\n\n    this.customerID = \"\";\n    this.orderNumber = \"\";\n    this.orderMode = \"\";\n    this.showInvBtn = false;\n    this.customerName = \"\";\n    this.customerAddress = \"\";\n    this.cityAndState = \"\";\n    this.customerStateName = \"\";\n    this.customerCountryName = \"\";\n    this.customerPhone = \"\";\n    this.customerEmail = \"\";\n    this.customerfax = \"\";\n    this.customerPo = \"\";\n    this.reference = \"\";\n    this.cusConfirmation = \"\"; // creation = '';\n\n    this.createdDate = \"\";\n    this.createdTime = \"\";\n    this.additionalContactName = \"\";\n    this.additionalPhone = \"\";\n    this.additionalEmail = \"\";\n    this.additionalDetails = {\n      sealType: \"\",\n      sealNo: \"\",\n      loadType: {\n        hazMat: false,\n        oversize: false,\n        reefer: false,\n        tanker: false\n      },\n      refeerTemp: {\n        maxTemprature: \"\",\n        maxTempratureUnit: \"\",\n        minTemprature: \"\",\n        minTempratureUnit: \"\"\n      },\n      trailerType: \"\",\n      uploadedDocs: []\n    };\n    this.charges = {\n      freightFee: {\n        amount: 0,\n        currency: \"\",\n        type: \"\"\n      },\n      fuelSurcharge: {\n        amount: 0,\n        currency: \"\",\n        type: \"\"\n      },\n      accessorialFeeInfo: {\n        accessorialFee: [],\n        total: 0\n      },\n      accessorialDeductionInfo: {\n        accessorialDeduction: [],\n        total: 0\n      }\n    };\n    this.discount = {\n      amount: 0,\n      unit: \"\"\n    };\n    this.milesInfo = {\n      calculateBy: \"\",\n      totalMiles: \"\"\n    };\n    this.taxesInfo = [];\n    this.taxesTotal = 0;\n    this.totalCharges = 0;\n    this.advances = 0;\n    this.balance = 0;\n    this.assetTypes = {};\n    this.milesArr = [];\n    this.allPhotos = [];\n    this.carrierID = \"\";\n    this.stateCode = \"\";\n    this.zeroRated = false;\n    this.isInvoice = false;\n    this.vehicles = [];\n    this.assets = [];\n    this.isInvoiced = false;\n    this.isModalShow = false;\n    this.isShow = false;\n    this.generateBtnDisabled = false;\n    this.errors = {};\n    this.response = \"\";\n    this.hasError = false;\n    this.hasSuccess = false;\n    this.Error = \"\";\n    this.Success = \"\";\n    this.invGenStatus = false;\n    this.orderStatus = \"\";\n    this.emailData = {\n      emails: []\n    };\n    this.subject = \"\";\n    this.hideEdit = false;\n    this.isGenerate = true;\n    this.emailDocs = [];\n    this.invDocs = [];\n    this.isEmail = false;\n    this.slideConfig = {\n      slidesToShow: 1,\n      slidesToScroll: 1\n    };\n    this.brokerage = {\n      carrierID: \"\",\n      instructions: \"\",\n      amount: \"\",\n      brokerageAmount: \"\",\n      currency: \"\",\n      orderNo: \"\",\n      miles: \"\",\n      today: moment().format(\"YYYY-MM-DD\")\n    };\n    this.carrierData = {\n      name: \"\",\n      email: \"\",\n      address: \"\",\n      phone: \"\"\n    };\n    this.showModal = false;\n    this.showBolModal = false;\n    this.userEmails = [];\n    this.orderInvData = {\n      additionalContact: null,\n      carrierData: {\n        address: \"\",\n        companyName: \"\",\n        phone: \"\",\n        email: \"\",\n        fax: \"\",\n        carrierID: \"\",\n        termsInfo: {\n          logo: \"\",\n          tagLine: \"\",\n          terms: ''\n        }\n      },\n      charges: {\n        accessorialDeductionInfo: {\n          accessorialDeduction: []\n        },\n        accessorialFeeInfo: {\n          accessorialFee: []\n        },\n        freightFee: {\n          amount: 0,\n          currency: \"\",\n          type: \"\"\n        },\n        fuelSurcharge: {\n          amount: 0,\n          currency: \"\",\n          type: \"\"\n        },\n        cusAddressID: \"\",\n        customerID: \"\"\n      },\n      data: [],\n      finalAmount: 0,\n      phone: \"\",\n      subTotal: 0,\n      taxesAmt: 0\n    };\n    this.companyLogoSrc = \"\";\n    this.orderLogs = [];\n    this.recallStatus = false;\n    this.isFlag = true;\n    this.showBtns = false;\n    this.brokerageDisabled = false;\n\n    this.getCurrentUser = () => __awaiter(this, void 0, void 0, function* () {\n      let currentUser = (yield Auth.currentSession()).getIdToken().payload;\n      this.carrierEmail = currentUser.email;\n    });\n\n    this.today = new Date();\n  }\n\n  ngOnInit() {\n    this.orderID = this.route.snapshot.params[\"orderID\"];\n    this.fetchOrder();\n    this.fetchInvoiceData();\n    this.fetchOrderLogs();\n    this.getCurrentUser();\n  }\n  /**\r\n   * fetch order data\r\n   */\n\n\n  fetchOrder() {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.docs = [];\n      this.apiService.getData(`orders/detail/${this.orderID}`).subscribe(result => __awaiter(this, void 0, void 0, function* () {\n        this.newOrderData = result;\n        result = result.Items[0];\n\n        if (result.brkCarrID) {\n          this.brokerage.carrierID = result.brkCarrID;\n        }\n\n        if (result.brkIns) {\n          this.brokerage.instructions = result.brkIns;\n        }\n\n        if (result.brkAmount) {\n          this.brokerage.brokerageAmount = result.brkAmount;\n        }\n\n        if (result.recall) {\n          this.recallStatus = true;\n        }\n\n        this.brokerage.orderNo = result.orderNumber;\n        this.brokerage.miles = result.milesInfo.totalMiles;\n        this.brokerage.currency = result.charges.freightFee.currency;\n\n        if (result.stateTaxID != undefined && result.stateTaxID != \"\") {\n          this.stateCode = result.stateCode;\n        }\n\n        if (result.tripData) {\n          this.tripData = result.tripData;\n        }\n\n        this.zeroRated = result.zeroRated;\n        this.carrierID = result.carrierID;\n        this.customerID = result.customerID;\n\n        if (result.invoiceGenerate || result.orderStatus === \"created\" || result.orderStatus === \"confirmed\") {\n          this.hideEdit = true;\n          this.isGenerate = false;\n        }\n\n        if (result.orderStatus === 'delivered' || result.recall) {\n          this.hideEdit = false;\n        }\n\n        this.orderStatus = result.orderStatus;\n        this.cusAddressID = result.cusAddressID;\n        this.customerAddress = result.customerAddress;\n        this.customerName = result.customerName;\n        this.cityAndState = result.cityAndState;\n        this.customerCountryName = result.customerCountryName;\n        this.customerPhone = result.customerPhone;\n        this.customerEmail = result.customerEmail;\n        this.showInvBtn = true;\n        this.reference = result.reference;\n        this.cusConfirmation = result.cusConfirmation == 'NA' ? '' : result.cusConfirmation;\n        this.createdDate = result.createdDate;\n        this.createdTime = result.timeCreated;\n\n        if (result.additionalContact != null && result.additionalContact.label != undefined) {\n          this.additionalContactName = result.additionalContact.label;\n        } else {\n          this.additionalContactName = result.additionalContact;\n        }\n\n        this.additionalPhone = result.phone;\n        this.additionalEmail = result.email;\n        this.isInvoiced = result.invoiceGenerate;\n        this.shipperReceiversInfos = result.shippersReceiversInfo;\n\n        for (let u = 0; u < this.shipperReceiversInfos.length; u++) {\n          const element = this.shipperReceiversInfos[u];\n          this.additionalDetails.sealType = result.additionalDetails.sealType ? result.additionalDetails.sealType.replace(\"_\", \" \") : \"-\";\n          this.additionalDetails.sealNo = result.additionalDetails.sealNo;\n          this.additionalDetails.loadType = result.additionalDetails.loadType;\n          this.additionalDetails.refeerTemp = result.additionalDetails.refeerTemp;\n          this.additionalDetails.trailerType = result.additionalDetails.trailerType ? result.additionalDetails.trailerType.replace(\"_\", \" \") : \"-\";\n          this.additionalDetails.uploadedDocs = result.additionalDetails.uploadedDocs;\n          this.charges = result.charges;\n          this.discount = result.discount;\n          this.milesInfo = result.milesInfo;\n          this.taxesInfo = result.taxesInfo;\n          this.orderNumber = result.orderNumber;\n          this.orderMode = result.orderMode;\n          this.subject = `Invoice: ${this.orderMode} - ${this.orderNumber}`;\n          this.milesArr = [];\n        }\n\n        for (let i = 0; i < this.taxesInfo.length; i++) {\n          if (this.taxesInfo[i].amount) {\n            this.taxesTotal = this.taxesTotal + this.taxesInfo[i].amount;\n          }\n        }\n\n        this.milesArr = result.shippersReceiversInfo;\n        let freightFee = isNaN(this.charges.freightFee.amount) ? 0 : this.charges.freightFee.amount;\n        let fuelSurcharge = isNaN(this.charges.fuelSurcharge.amount) ? 0 : this.charges.fuelSurcharge.amount;\n        let accessorialFeeInfo = isNaN(this.charges.accessorialFeeInfo.total) ? 0 : this.charges.accessorialFeeInfo.total;\n        let accessorialDeductionInfo = isNaN(this.charges.accessorialDeductionInfo.total) ? 0 : this.charges.accessorialDeductionInfo.total;\n        let totalAmount = parseFloat(freightFee) + parseFloat(fuelSurcharge) + parseFloat(accessorialFeeInfo) - parseFloat(accessorialDeductionInfo);\n        this.taxableAmount = totalAmount * parseInt(this.taxesTotal) / 100;\n\n        if (!this.zeroRated) {\n          this.totalCharges = totalAmount + this.taxableAmount;\n        } else {\n          this.totalCharges = totalAmount;\n        } // this.advances = result.advance;\n        // this.balance = this.totalCharges - this.advances;\n\n\n        this.balance = this.totalCharges;\n\n        if (result.attachments != undefined && result.attachments.length > 0) {\n          this.attachments = result.attachments.map(x => ({\n            docPath: `${x}`,\n            name: x,\n            ext: x.split(\".\")[1]\n          }));\n        }\n\n        if (result.tripDocs != undefined && result.tripDocs.length > 0) {\n          this.tripDocs = result.tripDocs.map(x => ({\n            imgPath: `${x.urlPath}`,\n            docPath: `${x.urlPath}`,\n            displayName: x.displayName,\n            name: x.storedName,\n            ext: x.storedName.split(\".\")[1]\n          }));\n        }\n\n        if (result.uploadedDocs !== undefined && result.uploadedDocs.length > 0) {\n          result.uploadedDocs.forEach(x => {\n            if (x.storedName.split(\".\")[1] === \"jpg\" || x.storedName.split(\".\")[1] === \"png\" || x.storedName.split(\".\")[1] === \"jpeg\") {\n              const obj = {\n                imgPath: `${x.urlPath}`,\n                docPath: `${x.urlPath}`,\n                displayName: x.displayName,\n                name: x.storedName,\n                ext: x.storedName.split(\".\")[1]\n              };\n              this.docs.push(obj);\n            } else {\n              const obj = {\n                imgPath: \"assets/img/icon-pdf.png\",\n                docPath: `${x.urlPath}`,\n                displayName: x.displayName,\n                name: x.storedName,\n                ext: x.storedName.split(\".\")[1]\n              };\n              this.docs.push(obj);\n            }\n          });\n        }\n\n        if (result.customerEmail && result.customerEmail != '') {\n          this.emailData.emails.push({\n            label: result.customerEmail\n          });\n        } //this.emailDocs = [...this.docs, ...this.attachments, ...this.tripDocs];\n\n      }), err => {});\n    });\n  }\n\n  openEmailInv() {\n    return __awaiter(this, void 0, void 0, function* () {\n      let ngbModalOptions = {\n        keyboard: false,\n        backdrop: \"static\",\n        windowClass: \"order-send__email\"\n      };\n      this.emailCopyRef = this.modalService.open(this.emailInvoiceModal, ngbModalOptions);\n    });\n  }\n\n  sendEmailInv() {\n    return __awaiter(this, void 0, void 0, function* () {\n      let newDocs = [];\n\n      for (const item of this.emailDocs) {\n        newDocs.push({\n          filename: item.displayName,\n          path: item.docPath\n        });\n      }\n\n      const data = {\n        docs: newDocs,\n        emails: this.userEmails,\n        subject: this.subject,\n        sendCopy: this.isCopy\n      };\n      let result = yield this.apiService.getData(`orders/emailInvoice/${this.orderID}?data=${encodeURIComponent(JSON.stringify(data))}`).toPromise();\n\n      if (result) {\n        // this.emailRef.close();\n        this.emailCopyRef.close();\n        this.toastr.success(\"Email send successfully!\");\n        this.isEmail = false;\n        this.userEmails = [];\n\n        if (this.emailData.emails.length > 0) {\n          this.emailData.emails = [];\n          this.emailData.emails.push({\n            label: this.customerEmail\n          });\n        }\n\n        this.subject = `Invoice: ${this.orderMode} - ${this.orderNumber}`;\n      } else {\n        this.isEmail = false;\n      }\n    });\n  }\n\n  showInv() {\n    let ngbModalOptions = {\n      keyboard: true,\n      windowClass: \"preview--invoice\"\n    };\n    this.previewRef = this.modalService.open(this.previewInvoiceModal, ngbModalOptions);\n  }\n\n  addEmails() {\n    this.isFlag = true;\n    this.isEmail = true;\n\n    if (this.emailData.emails.length === 0) {\n      this.toastr.error(\"Please enter at least one email\");\n      this.isEmail = false;\n      return;\n    }\n\n    console.log('this.emailData', this.emailData);\n    const re = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    this.emailData.emails.forEach(elem => {\n      let result = re.test(String(elem.label).toLowerCase());\n\n      if (!result) {\n        this.toastr.error(\"Please enter valid email(s)\");\n        this.isFlag = false;\n        this.isEmail = false;\n        return;\n      } else {\n        if (!this.userEmails.includes(elem.label)) {\n          this.userEmails.push(elem.label);\n        }\n      }\n    });\n\n    if (this.subject == \"\") {\n      this.toastr.error(\"Please enter subject\");\n      this.isEmail = false;\n      return;\n    }\n\n    if (this.isFlag) {\n      this.sendEmailInv();\n    }\n  }\n\n  sendEmailOnly() {\n    this.isEmail = true;\n    this.sendEmailInv();\n  }\n\n  generate() {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.isShow = true;\n      this.previewRef.close();\n      var data = document.getElementById(\"print_wrap\");\n      html2pdf(data, {\n        margin: [0.5, 0.3, 0.5, 0.3],\n        pagebreak: {\n          mode: 'avoid-all',\n          before: \"print_wrap\"\n        },\n        filename: \"invoice.pdf\",\n        image: {\n          type: \"jpeg\",\n          quality: 0.98\n        },\n        html2canvas: {\n          dpi: 300,\n          letterRendering: true,\n          allowTaint: true,\n          useCORS: true\n        },\n        jsPDF: {\n          unit: \"in\",\n          format: \"a4\",\n          orientation: \"portrait\"\n        }\n      });\n    });\n  }\n\n  cancel() {\n    this.location.back();\n  }\n\n  generatePDF() {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.isShow = true;\n      yield this.saveInvoice();\n      var data = document.getElementById(\"print_wrap\");\n      html2pdf(data, {\n        margin: [0.5, 0.3, 0.5, 0.3],\n        pagebreak: {\n          mode: 'avoid-all',\n          before: \"print_wrap\"\n        },\n        filename: \"invoice.pdf\",\n        image: {\n          type: \"jpeg\",\n          quality: 0.98\n        },\n        html2canvas: {\n          dpi: 300,\n          letterRendering: true,\n          allowTaint: true,\n          useCORS: true\n        },\n        jsPDF: {\n          unit: \"in\",\n          format: \"a4\",\n          orientation: \"portrait\"\n        }\n      }); // await this.saveInvoice();\n      // await this.invoiceGenerated();\n      // await this.fetchOrder();\n\n      this.previewRef.close();\n    });\n  }\n\n  pageRendered(event) {\n    this.pdfComponent.pdfViewer.currentScaleValue = \"page-fit\";\n  }\n\n  saveInvoice() {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.generateBtnDisabled = true;\n      this.invoiceData[`transactionLog`] = [];\n      this.invoiceData[`invNo`] = this.orderNumber;\n      this.invoiceData[`invType`] = \"orderInvoice\";\n      this.invoiceData[`invStatus`] = \"open\";\n      this.invoiceData[`amountReceived`] = 0;\n      this.invoiceData[`amountPaid`] = 0;\n      this.invoiceData[`fullPayment`] = false;\n      this.invoiceData[`balance`] = this.totalCharges;\n      this.invoiceData[`txnDate`] = new Date().toISOString().slice(0, 10);\n      this.invoiceData[`orderID`] = this.orderID;\n      this.invoiceData[`zeroRated`] = this.zeroRated;\n      this.invoiceData[`currency`] = this.brokerage.currency;\n      this.accountService.postData(`order-invoice`, this.invoiceData).subscribe({\n        complete: () => {},\n        error: err => {\n          from(err.error).pipe(map(val => {\n            val.message = val.message.replace(/\".*\"/, \"This Field\");\n            this.errors[val.context.key] = val.message;\n          })).subscribe({\n            complete: () => {\n              this.generateBtnDisabled = false; // this.throwErrors();\n            },\n            error: () => {\n              this.generateBtnDisabled = false;\n            },\n            next: () => {}\n          });\n        },\n        next: res => {\n          this.isInvoiced = true;\n          this.generateBtnDisabled = false;\n          this.toastr.success(\"Invoice Added Successfully.\");\n          $(\"#previewInvoiceModal\").modal(\"hide\");\n        }\n      });\n    });\n  } // async invoiceGenerated() {\n  //   this.invGenStatus = true;\n  //   let result = await this.apiService\n  //     .getData(\n  //       `orders/invoiceStatus/${this.orderID}/${this.orderNumber}/${this.invGenStatus}`\n  //     )\n  //     .toPromise();\n  //   this.isInvoice = result.Attributes.invoiceGenerate;\n  // }\n\n\n  previewModal() {\n    $(\"#templateSelectionModal\").modal(\"hide\");\n    setTimeout(function () {\n      $(\"#previewInvoiceModal\").modal(\"show\");\n    }, 500);\n  } // delete uploaded images and documents\n\n\n  delete(type, name, index) {\n    return __awaiter(this, void 0, void 0, function* () {\n      // let record = {\n      //   eventID: this.orderID,\n      //   type: type,\n      //   name: name,\n      //   date: this.createdDate,\n      //   time: this.createdTime\n      // }\n      if (confirm(\"Are you sure you want to delete?\") === true) {\n        yield this.apiService.deleteData(`orders/uploadDelete/${this.orderID}/${name}/${type}`).toPromise();\n\n        if (type == \"attachment\") {\n          this.attachments.splice(index, 1);\n        } else {\n          this.docs.splice(index, 1);\n        }\n\n        this.toastr.success(\"Document deleted successfully\");\n      }\n    });\n  }\n\n  setPDFSrc(val) {\n    let pieces = val.split(/[\\s.]+/);\n    let ext = pieces[pieces.length - 1];\n    this.pdfSrc = \"\";\n\n    if (ext == \"doc\" || ext == \"docx\" || ext == \"xlsx\") {\n      this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(\"https://docs.google.com/viewer?url=\" + val + \"&embedded=true\");\n    } else {\n      this.pdfSrc = this.domSanitizer.bypassSecurityTrustResourceUrl(val);\n    }\n  }\n  /*\r\n   * Selecting files before uploading\r\n   */\n\n\n  selectDocuments(event) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let files = [];\n      this.uploadedDocs = [];\n      files = [...event.target.files];\n      let totalCount = this.docs.length + files.length;\n\n      if (totalCount > 4) {\n        this.uploadedDocs = [];\n        $(\"#bolUpload\").val(\"\");\n        this.toastr.error(\"Only 4 documents can be uploaded\");\n        return false;\n      } else {\n        for (let i = 0; i < files.length; i++) {\n          const element = files[i];\n          let name = element.name.split(\".\");\n          let ext = name[name.length - 1];\n\n          if (ext != \"jpg\" && ext != \"jpeg\" && ext != \"png\" && ext != \"pdf\") {\n            $(\"#bolUpload\").val(\"\");\n            this.toastr.error(\"Only image and pdf files are allowed\");\n            return false;\n          }\n        }\n\n        for (let i = 0; i < files.length; i++) {\n          this.uploadedDocs.push(files[i]);\n        } // create form data instance\n\n\n        const formData = new FormData(); // append photos if any\n\n        for (let i = 0; i < this.uploadedDocs.length; i++) {\n          formData.append(\"uploadedDocs\", this.uploadedDocs[i]);\n        }\n\n        let result = yield this.apiService.postData(`orders/uploadDocs/${this.orderID}`, formData, true).toPromise();\n        this.invDocs = [];\n        this.uploadedDocs = [];\n\n        if (result.length > 0) {\n          result.forEach(x => {\n            let obj = {};\n\n            if (x.storedName.split(\".\")[1] === \"jpg\" || x.storedName.split(\".\")[1] === \"png\" || x.storedName.split(\".\")[1] === \"jpeg\") {\n              obj = {\n                imgPath: `${x.urlPath}`,\n                docPath: `${x.urlPath}`,\n                displayName: x.displayName,\n                name: x.storedName,\n                ext: x.storedName.split(\".\")[1]\n              };\n            } else {\n              obj = {\n                imgPath: \"assets/img/icon-pdf.png\",\n                docPath: `${x.urlPath}`,\n                displayName: x.displayName,\n                name: x.storedName,\n                ext: x.storedName.split(\".\")[1]\n              };\n            }\n\n            this.invDocs.push(obj);\n          });\n        }\n\n        this.toastr.success(\"BOL/POD uploaded successfully\");\n        this.uploadBol.nativeElement.value = \"\";\n        yield this.fetchOrder();\n      }\n    });\n  }\n\n  setSrcValue() {}\n\n  caretClickShipper(i, j) {\n    if ($(\"#shipperArea-\" + i + \"-\" + j).children(\"i\").hasClass(\"fa-caret-right\")) {\n      $(\"#shipperArea-\" + i + \"-\" + j).children(\"i\").removeClass(\"fa-caret-right\");\n      $(\"#shipperArea-\" + i + \"-\" + j).children(\"i\").addClass(\"fa-caret-down\");\n    } else {\n      $(\"#shipperArea-\" + i + \"-\" + j).children(\"i\").addClass(\"fa-caret-right\");\n      $(\"#shipperArea-\" + i + \"-\" + j).children(\"i\").removeClass(\"fa-caret-down\");\n    }\n  }\n\n  caretClickReceiver(i, j) {\n    if ($(\"#receiverArea-\" + i + \"-\" + j).children(\"i\").hasClass(\"fa-caret-right\")) {\n      $(\"#receiverArea-\" + i + \"-\" + j).children(\"i\").removeClass(\"fa-caret-right\");\n      $(\"#receiverArea-\" + i + \"-\" + j).children(\"i\").addClass(\"fa-caret-down\");\n    } else {\n      $(\"#receiverArea-\" + i + \"-\" + j).children(\"i\").addClass(\"fa-caret-right\");\n      $(\"#receiverArea-\" + i + \"-\" + j).children(\"i\").removeClass(\"fa-caret-down\");\n    }\n  }\n\n  fetchInvoiceData() {\n    this.apiService.getData(`orders/invoice/${this.orderID}`).subscribe(result => {\n      this.invoiceData = result[0];\n      this.orderInvData = result[0];\n      this.isInvoice = true;\n\n      if (this.orderInvData.carrierData.termsInfo.logo && this.orderInvData.carrierData.termsInfo.logo != \"\") {\n        this.companyLogoSrc = `${this.orderInvData.carrierData.termsInfo.logo}`;\n      }\n\n      if (this.invoiceData.assets != undefined) {\n        this.assets = this.invoiceData.assets;\n      }\n\n      if (this.invoiceData.vehicles != undefined) {\n        this.vehicles = this.invoiceData.vehicles;\n      }\n\n      if (result[0].uploadedDocs !== undefined && result[0].uploadedDocs.length > 0) {\n        result[0].uploadedDocs.forEach(x => {\n          let obj = {};\n\n          if (x.storedName.split(\".\")[1] === \"jpg\" || x.storedName.split(\".\")[1] === \"png\" || x.storedName.split(\".\")[1] === \"jpeg\") {\n            obj = {\n              imgPath: `${x.urlPath}`,\n              docPath: `${x.urlPath}`,\n              displayName: x.displayName,\n              name: x.storedName,\n              ext: x.storedName.split(\".\")[1]\n            };\n          } else {\n            obj = {\n              imgPath: \"assets/img/icon-pdf.png\",\n              docPath: `${x.urlPath}`,\n              displayName: x.displayName,\n              name: x.storedName,\n              ext: x.storedName.split(\".\")[1]\n            };\n          }\n\n          this.invDocs.push(obj);\n        });\n      }\n\n      this.showBtns = true;\n    });\n  }\n\n  downloadBrokeragePdf() {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this.fetchCarrierDetails();\n      this.showModal = true;\n      let data = {\n        carrierData: this.carrierData,\n        brokerage: this.brokerage,\n        orderData: this.orderInvData,\n        showModal: this.showModal,\n        companyLogo: this.companyLogoSrc,\n        carrierEmail: this.carrierEmail,\n        orderID: this.orderID,\n        type: \"detail\"\n      };\n      this.listService.triggerBrokeragePdf(data);\n    });\n  }\n\n  fetchCarrierDetails() {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.brokerageDisabled = true;\n      let result = yield this.apiService.getData(`contacts/detail/${this.brokerage.carrierID}`).toPromise();\n      result = result.Items[0];\n      this.carrierData.name = result.cName;\n      this.carrierData.email = result.workEmail;\n      this.carrierData.phone = result.workPhone;\n\n      if (result.adrs[0].manual) {\n        if (result.adrs[0].add1 !== \"\") {\n          this.carrierData.address = `${result.adrs[0].add1} ${result.adrs[0].add2} ${result.adrs[0].ctyName}, ${result.adrs[0].sName}, ${result.adrs[0].cName}`;\n        }\n      } else {\n        this.carrierData.address = result.adrs[0].userLoc;\n      }\n\n      this.brokerageDisabled = false;\n    });\n  }\n\n  downloadBolPdf() {\n    return __awaiter(this, void 0, void 0, function* () {\n      yield this.fetchBOLDetails();\n      this.showBolModal = true;\n      let data = {\n        carrierData: this.carrierData,\n        orderData: this.orderInvData,\n        showModal: this.showBolModal,\n        companyLogo: this.companyLogoSrc\n      };\n      this.listService.triggerBolPdf(data);\n    });\n  }\n\n  fetchOrderLogs() {\n    this.apiService.getData(`auditLogs/details/${this.orderID}`).subscribe(res => {\n      this.orderLogs = res.Items;\n\n      if (this.orderLogs.length > 0) {\n        this.orderLogs.map(k => {\n          k.dateAndTime = `${k.createdDate} ${k.createdTime}`;\n\n          if (k.eventParams.userName !== undefined) {\n            const newString = k.eventParams.userName.split(\"_\");\n            k.userFirstName = newString[0];\n            k.userLastName = newString[1];\n          }\n\n          if (k.eventParams.number !== undefined) {\n            k.entityNumber = k.eventParams.number;\n          }\n\n          if (k.eventParams.name !== undefined) {\n            if (k.eventParams.name.includes(\"_\")) {\n              const newString = k.eventParams.name.split(\"_\");\n              k.firstName = newString[0];\n              k.lastName = newString[1];\n            }\n          }\n        });\n        this.orderLogs.sort((a, b) => {\n          return new Date(b.dateAndTime).valueOf() - new Date(a.dateAndTime).valueOf();\n        });\n      }\n    });\n  }\n\n  fetchBOLDetails() {\n    return __awaiter(this, void 0, void 0, function* () {\n      let result = yield this.apiService.getData(`orders/get/bol/data/${this.orderID}`).toPromise();\n      result = result.Items[0];\n    });\n  }\n\n  sendEmailCopy(value) {\n    if (value) {\n      this.isCopy = true;\n    } else {\n      this.isCopy = false;\n    }\n  }\n\n};\n\nOrderDetailComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: AccountService\n}, {\n  type: NgbModal\n}, {\n  type: DomSanitizer\n}, {\n  type: ActivatedRoute\n}, {\n  type: ToastrService\n}, {\n  type: ListService\n}, {\n  type: Location\n}];\n\nOrderDetailComponent.propDecorators = {\n  previewInvoiceModal: [{\n    type: ViewChild,\n    args: [\"previewInvoiceModal\", {\n      static: true\n    }]\n  }],\n  emailInvoiceModal: [{\n    type: ViewChild,\n    args: [\"emailInvoiceModal\", {\n      static: true\n    }]\n  }],\n  emailInvoice: [{\n    type: ViewChild,\n    args: [\"emailInvoice\", {\n      static: true\n    }]\n  }],\n  uploadBol: [{\n    type: ViewChild,\n    args: [\"uploadBol\", {\n      static: true\n    }]\n  }],\n  pdfComponent: [{\n    type: ViewChild,\n    args: [PdfViewerComponent, {\n      static: false\n    }]\n  }]\n};\nOrderDetailComponent = __decorate([Component({\n  selector: \"app-order-detail\",\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], OrderDetailComponent);\nexport { OrderDetailComponent };","map":null,"metadata":{},"sourceType":"module"}