{"ast":null,"code":"import _asyncToGenerator from \"C:/FH/fh-cloud-app/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./total-miles.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./total-miles.component.css\";\nimport { Component } from '@angular/core';\nimport { map, debounceTime, distinctUntilChanged, catchError, switchMap } from 'rxjs/operators';\nimport { Subject, throwError } from 'rxjs';\nimport { HereMapService, ApiService } from '../../../../services';\nlet TotalMilesComponent = class TotalMilesComponent {\n  constructor(apiService, hereMap) {\n    this.apiService = apiService;\n    this.hereMap = hereMap;\n    this.searchTerm = new Subject();\n    this.newCoords = [];\n    this.routeData = {\n      totalMiles: 0,\n      miles: 0,\n      location: [{\n        totalMiles: 0,\n        miles: 0,\n        sourceAddress: '',\n        destAddress: '',\n        sourceLat: '',\n        sourceLng: '',\n        destLat: '',\n        destLng: ''\n      }],\n      stops: [],\n      data: []\n    };\n  }\n\n  ngOnInit() {\n    this.searchLocation();\n  }\n\n  searchLocation() {\n    this.searchTerm.pipe(map(e => {\n      $('.map-search__results').hide();\n      $(e.target).closest('div').addClass('show-search__result');\n      return e.target.value;\n    }), debounceTime(400), distinctUntilChanged(), switchMap(term => {\n      return this.hereMap.searchEntries(term);\n    }), catchError(e => {\n      return throwError(e);\n    })).subscribe(res => {\n      this.searchResults = res;\n    });\n  }\n\n  getCoords(data) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.newCoords = [];\n\n      for (let i = 0; i < data.length; i++) {\n        const element = data[i];\n\n        _this.newCoords.push(`${element.lat},${element.lng}`);\n      }\n\n      yield _this.getMiles(_this.routeData.location);\n    })();\n  }\n\n  getAddressDetail(id) {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      let result = yield _this2.apiService.getData(`pcMiles/detail/${id}`).toPromise();\n      return result;\n    })();\n  }\n\n  reinitMap() {\n    if (this.routeData.stops.length > 1) {\n      this.getCoords(this.routeData.stops);\n    }\n  }\n\n  getMiles(index) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      let coords = [];\n\n      if (_this3.routeData.location[index]) {\n        if (_this3.routeData.location[index]['sourceAddress'] != '' && _this3.routeData.location[index]['destAddress'] != '') {\n          coords.push(`${_this3.routeData.location[index]['sourceLng']},${_this3.routeData.location[index]['sourceLat']}`);\n          coords.push(`${_this3.routeData.location[index]['destLng']},${_this3.routeData.location[index]['destLat']}`);\n        }\n      }\n\n      let stops = coords.join(\";\");\n\n      _this3.apiService.getData('trips/calculate/pc/miles?type=mileReport&stops=' + stops).subscribe(result => {\n        _this3.routeData.location[index].miles = result;\n\n        _this3.calculateMiles();\n      });\n    })();\n  }\n\n  assignLocation(elem, data, index = '') {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      let item = {\n        name: '',\n        lat: '',\n        lng: ''\n      };\n      let coords = [];\n      let result = yield _this4.getAddressDetail(data.place_id);\n\n      if (result != undefined) {\n        item = {\n          name: data.address,\n          lat: result.position.lat,\n          lng: result.position.lng\n        };\n\n        if (elem === 'source') {\n          _this4.routeData.location[index]['sourceAddress'] = `${data.address}`;\n          _this4.routeData.location[index]['sourceLat'] = `${result.position.lat}`;\n          _this4.routeData.location[index]['sourceLng'] = `${result.position.lng}`;\n        } else if (elem === 'destination') {\n          _this4.routeData.location[index]['destAddress'] = `${data.address}`;\n          _this4.routeData.location[index]['destLat'] = `${result.position.lat}`;\n          _this4.routeData.location[index]['destLng'] = `${result.position.lng}`;\n        }\n\n        _this4.searchResults = false;\n\n        _this4.reinitMap();\n\n        $('div').removeClass('show-search__result');\n\n        if (_this4.routeData.location[index]) {\n          if (_this4.routeData.location[index]['sourceAddress'] != '' && _this4.routeData.location[index]['destAddress'] != '') {\n            coords.push(`${_this4.routeData.location[index]['sourceLat']},${_this4.routeData.location[index]['sourceLng']}`);\n            coords.push(`${_this4.routeData.location[index]['destLat']},${_this4.routeData.location[index]['destLng']}`);\n          }\n        }\n\n        if (coords.length > 1) {\n          _this4.getMiles(index);\n        }\n      }\n    })();\n  }\n\n  clearAddress(index) {\n    this.routeData.location[index].sourceAddress = '';\n    this.routeData.location[index].miles = '';\n    this.routeData.location[index].destAddress = '';\n    this.calculateMiles();\n  }\n\n  addAddress(data) {\n    data.location.push({\n      sourceAddress: '',\n      destAddress: '',\n      miles: ''\n    });\n  }\n\n  removeAddress(index) {\n    this.routeData.location.splice(index, 1);\n    this.calculateMiles();\n  }\n\n  calculateMiles() {\n    this.routeData.location.totalMiles = 0;\n\n    for (const element of this.routeData.location) {\n      if (element.miles) {\n        this.routeData.location.totalMiles += Number(element.miles);\n      }\n    }\n  }\n\n};\n\nTotalMilesComponent.ctorParameters = () => [{\n  type: ApiService\n}, {\n  type: HereMapService\n}];\n\nTotalMilesComponent = __decorate([Component({\n  selector: 'app-total-miles',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], TotalMilesComponent);\nexport { TotalMilesComponent };","map":null,"metadata":{},"sourceType":"module"}