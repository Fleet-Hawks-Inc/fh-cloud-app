{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"!C:\\\\FH\\\\fh-cloud-app\\\\node_modules\\\\@ngtools\\\\webpack\\\\src\\\\loaders\\\\direct-resource.js!./pdf-automation.component.html\";\nimport __NG_CLI_RESOURCE__1 from \"./pdf-automation.component.css\";\nimport { HttpClient } from '@angular/common/http';\nimport { Component, ViewChild } from '@angular/core';\nimport { PdfAutomationService } from './pdf-automation.service';\nlet PdfAutomationComponent = class PdfAutomationComponent {\n  constructor(service, http) {\n    // $(() => {\n    //   // const canvas = document.getElementById('src');\n    this.service = service;\n    this.http = http;\n    this.modalBody = '';\n    this.$rect = {};\n    this.$text = {};\n    this.$ctx = {};\n    this.$srcContext = {};\n    this.$canvas = {};\n    this.$sitePersonel = {};\n    this.$cursorVT = {};\n    this.$cursorHL = {};\n    this.$val = [];\n    this.$head = [];\n    this.$annotateinfo = {};\n    this.$rectn = [];\n    this.$res = [];\n    this.$pdfjson = {};\n    this.$data = {};\n    this.i = 0;\n    this.$rct = [];\n    this.postData = {\n      \"u1\": \"1000\",\n      \"u2\": \"1100\"\n    };\n    this.$obj = {\n      \"documentId\": \"RANDOM VALUE\",\n      \"typeofDocument\": \"Order\",\n      \"nameofDocument\": \"LighSpeed\",\n      \"carrierId\": \"carrierId\",\n      \"createDate\": \"\",\n      \"createdTime\": \"\",\n      \"rct\": []\n    };\n    this.$jsonfile = {};\n    this.url = 'http://localhost:3000/api/v1/pdfautomation';\n    this.pageTitle = 'Pdf Annotation';\n    this.drag = false;\n    this.selectOpt = ''; //   const canvas = this.pdfcanvas.nativeElement;\n    //   this.$canvas = canvas;\n    //   const savebtn = document.getElementById('fire');\n    //   const pdffile = document.getElementById('pdffile');\n    //   const el = document.getElementById('myFile');\n    //   const uf = document.getElementById('uploadedfile');\n    //   let text;\n    //   this.$text = text;\n    //   const ctx = canvas.getContext('2d');\n    //   this.$ctx = ctx;\n    //   const rect = {};\n    //   this.$rect = rect;\n    //   let drag = false;\n    //   const imageObj = null;\n    //   let renderTask;\n    //   const delay = ms => new Promise(res => setTimeout(res, ms));\n    //   const srcContext = canvas.getContext('2d');\n    //   this.$srcContext = srcContext;\n    //   this.$cursorVT = document.querySelector('.vt')\n    //   this.$cursorHL = document.querySelector('.hl')\n    //   interface HTMLInputEvent extends Event {\n    //     target: HTMLInputElement & EventTarget;\n    //   }\n    //   el.onchange = (e?: HTMLInputEvent) => {\n    //     const canvas = this.pdfcanvas.nativeElement;\n    //     this.$canvas = canvas;\n    //     const savebtn = document.getElementById('fire');\n    //     const pdffile = document.getElementById('pdffile');\n    //     const el = document.getElementById('myFile');\n    //     const uf = document.getElementById('uploadedfile');\n    //     let text;\n    //     this.$text = text;\n    //     const ctx = canvas.getContext('2d');\n    //     this.$ctx = ctx;\n    //     const rect = {};\n    //     this.$rect = rect;\n    //     let drag = false;\n    //     const imageObj = null;\n    //     let renderTask;\n    //     const delay = ms => new Promise(res => setTimeout(res, ms));\n    //     const srcContext = canvas.getContext('2d');\n    //     this.$srcContext = srcContext;\n    //     this.$cursorVT = document.querySelector('.vt')\n    //     this.$cursorHL = document.querySelector('.hl')\n    //     let files: any = e.target.files[0];\n    //     const contentType = files.type;\n    //     const bucket = new S3(\n    //       {\n    //         accessKeyId: 'AKIARUNMEEHU3LCMJJIK',\n    //         secretAccessKey: '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',\n    //         region: 'us-east-2'\n    //       }\n    //     );\n    //     const params = {\n    //       Bucket: 'pdfautomation-bucket',\n    //       Key: files.name,\n    //       Body: files,\n    //       ACL: 'public-read',\n    //       ContentType: contentType\n    //     };\n    //     bucket.upload(params, function (err, data) {\n    //       if (err) {\n    //         return false;\n    //       }\n    //       return true;\n    //     });\n    //     //for upload progress   \n    //     /*bucket.upload(params).on('httpUploadProgress', function (evt) {\n    //           }).send(function (err, data) {\n    //               if (err) {\n    //                   return false;\n    //               }\n    //               return true;\n    //           });*/\n    //     for (var i = 0, f; f = files[i]; i++) {\n    //       var reader = new FileReader();\n    //       if (!f.type.match('image.*')) {\n    //         continue;\n    //       }\n    //       reader.onload = (function (theFile) {\n    //         return function (evt) {\n    //           var span = document.createElement('span');\n    //           span.innerHTML = ['<img class=\"thumb\" src=\"', evt.target.result,\n    //             '\" title=\"', escape(theFile.name), '\"/>'].join('');\n    //           document.getElementById('list').insertBefore(span, null);\n    //         };\n    //       })(f);\n    //       reader.readAsDataURL(f);\n    //     }\n    //     // (async () => {\n    //     //   await delay(2000);\n    //     const url = \"https://pdfautomation-bucket.s3.us-east-2.amazonaws.com/\" + files.name;\n    //     // Loaded via <script> tag, create shortcut to access PDF.js exports.\n    //     const pdfjsLib = window['pdfjs-dist/build/pdf'];\n    //     // The workerSrc property shall be specified.\n    //     pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';\n    //     const loadingTask = pdfjsLib.getDocument(url);\n    //     loadingTask.promise.then((pdf) => {\n    //       // Fetch the first page\n    //       const pageNumber = 1;\n    //       pdf.getPage(pageNumber).then(function (page) {\n    //         const scale = 2;\n    //         const viewport = page.getViewport({ scale: scale });\n    //         // Prepare canvas using PDF page dimensions\n    //         // const canvasShadowed = document.getElementById('src');\n    //         // const canvasShadowed = this.canva.nativeElement;\n    //         const canvasShadowed = canvas;\n    //         const context = canvasShadowed.getContext('2d');\n    //         canvasShadowed.height = viewport.height;\n    //         canvasShadowed.width = viewport.width;\n    //         // Render PDF page into canvas context\n    //         const renderContext = {\n    //           canvasContext: context,\n    //           viewport\n    //         };\n    //         renderTask = page.render(renderContext);\n    //         renderTask.promise.then(() => {\n    //         });\n    //       });\n    //     }, (reason) => {\n    //       // PDF loading error\n    //     });\n    //     // var ocrJson = {\n    //     //     // todo: other parameters. b&w, resizing strategy etc\n    //     //     'version': '1.0.0',\n    //     //     'schema': 'My OCR Meta JSON',\n    //     //     'rectangles': [\n    //     //         { 'left': 70, 'top': 95, 'width': 130, 'height': 15, 'label': 'PatientName' },\n    //     //         { 'left': 70, 'top': 110, 'width': 230, 'height': 15, 'label': 'Address' },\n    //     //         { 'left': 140, 'top': 135, 'width': 150, 'height': 15, 'label': 'DOS' },\n    //     //     ],\n    //     // };\n    //   }\n    //   uf.onchange = (e?: HTMLInputEvent) => {\n    //     let files: any = e.target.files[0];\n    //     const contentType = files.type;\n    //     const bucket = new S3(\n    //       {\n    //         accessKeyId: 'AKIARUNMEEHU3LCMJJIK',\n    //         secretAccessKey: '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',\n    //         region: 'us-east-2'\n    //       }\n    //     );\n    //     const params = {\n    //       Bucket: 'pdfautomation-bucket',\n    //       Key: files.name,\n    //       Body: files,\n    //       ACL: 'public-read',\n    //       ContentType: contentType\n    //     };\n    //     bucket.upload(params, function (err, data) {\n    //       if (err) {\n    //         return false;\n    //       }\n    //       return true;\n    //     });\n    //     //for upload progress   \n    //     /*bucket.upload(params).on('httpUploadProgress', function (evt) {\n    //           }).send(function (err, data) {\n    //               if (err) {\n    //                   return false;\n    //               }\n    //               return true;\n    //           });*/\n    //     for (var i = 0, f; f = files[i]; i++) {\n    //       var reader = new FileReader();\n    //       //   if (!f.type.match('image.*')) {\n    //       //     continue;\n    //       //   }\n    //       //   reader.onload = (function (theFile) {\n    //       //     return function (evt) {\n    //       //       var span = document.createElement('span');\n    //       //       span.innerHTML = ['<img class=\"thumb\" src=\"', evt.target.result,\n    //       //         '\" title=\"', escape(theFile.name), '\"/>'].join('');\n    //       //       document.getElementById('list').insertBefore(span, null);\n    //       //     };\n    //       //   })(f);\n    //       //   reader.readAsDataURL(f);\n    //       // }\n    //       // (async () => {\n    //       //   await delay(2000);\n    //       const url = \"https://pdfautomation-bucket.s3.us-east-2.amazonaws.com/\" + files.name;\n    //       // Loaded via <script> tag, create shortcut to access PDF.js exports.\n    //       const pdfjsLib = window['pdfjs-dist/build/pdf'];\n    //       // // The workerSrc property shall be specified.\n    //       // pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';\n    //       const loadingTask = pdfjsLib.getDocument(url);\n    //       loadingTask.promise.then((pdf) => {\n    //         const pageNumber = 1;\n    //         pdf.getPage(pageNumber).then(function (page) {\n    //           const scale = 2;\n    //           const viewport = page.getViewport({ scale: scale });\n    //           const canvasShadowed = canvas;\n    //           const context = canvasShadowed.getContext('2d');\n    //           canvasShadowed.height = viewport.height;\n    //           canvasShadowed.width = viewport.width;\n    //           const renderContext = {\n    //             canvasContext: context,\n    //             viewport\n    //           };\n    //           renderTask = page.render(renderContext);\n    //           renderTask.promise.then(() => {\n    //           });\n    //         });\n    //       }, (reason) => {\n    //         // PDF loading error\n    //       });\n    //       (async () => {\n    //         await delay(2000);\n    //         this.http.get(this.url + \"/78fe60b0-6c37-11eb-9a16-fd33a4993a22\").subscribe((data: any) => {\n    //           const rectangles = [];\n    //           for (let i = 0; i < data.Items[0].rct.length; i++) {\n    //             let a = {\n    //               left: data.Items[0].rct[i][1],\n    //               top: data.Items[0].rct[i][2],\n    //               width: data.Items[0].rct[i][3],\n    //               height: data.Items[0].rct[i][4],\n    //             }\n    //             rectangles.push(a)\n    //           }\n    //           // const rectangles = [\n    //           //   {\n    //           //     left:data.Items[0].rct[0][1],\n    //           //     top: data.Items[0].rct[0][2],\n    //           //     width:data.Items[0].rct[0][3],\n    //           //     height: data.Items[0].rct[0][4],\n    //           //   },\n    //           //   {\n    //           //     left: 462,\n    //           //     top: 29,\n    //           //     width: 299,\n    //           //     height: 80,\n    //           //   },\n    //           // ];\n    //           const worker = new Tesseract.TesseractWorker();\n    //           for (let i = 0; i < rectangles.length; i++) {\n    //             const cropImgCanvas = this.cropImage(this.$canvas, rectangles[i]);//img\n    //             if (cropImgCanvas) {\n    //             }\n    //             else {\n    //             }\n    //             // just renderint to visualize - no need for actual crop\n    //             this.$srcContext.rect(rectangles[i].left, rectangles[i].top, rectangles[i].width, rectangles[i].height);\n    //             this.$srcContext.strokeStyle = '#FF0000';\n    //             this.$srcContext.stroke();\n    //             worker.recognize(cropImgCanvas)\n    //               .progress(progress => {\n    //               }).then(result => {\n    //                 const para = document.createElement('P');\n    //                 const h = document.createElement('h3');\n    //                 // h.innerHTML = document.getElementById('select').value;\n    //                 h.innerHTML = data.Items[0].rct[i][0];\n    //                 para.innerHTML = result.text;\n    //                 this.$val.push(result.text);\n    //                 this.$head.push(data.Items[0].rct[i][0]);\n    //                 this.$pdfjson[data.Items[0].rct[i][0]] = result.text;\n    //                 JSON.stringify(this.$pdfjson);\n    //                 document.getElementById('myDIV').appendChild(h);\n    //                 document.getElementById('myDIV').appendChild(para);\n    //               });\n    //           }\n    //         });\n    //       })();\n    //     }\n    //     async function init() {\n    //       // var drag = false;\n    //       // var canvas = document.getElementById('src');\n    //       // const worker = new Tesseract.TesseractWorker();\n    //       // var srcContext = document.getElementById('src').getContext('2d');\n    //       // var destContext = document.getElementById('dest').getContext('2d');\n    //       // let img = await loadImage('1.jpg');\n    //       // srcContext.drawImage(img, 0, 0);\n    //     }\n    //     document.body.onload = init;\n    //   });\n  }\n\n  selectfile(value) {}\n\n  cropImage(sourceImage, rect) {\n    if (!sourceImage) {} else {}\n\n    this.$rect = rect; // parameterize them\n\n    const left = rect.left;\n    const top = rect.top;\n    const width = rect.width;\n    const height = rect.height;\n    const cropCanvas = document.createElement('canvas');\n    cropCanvas.width = width;\n    cropCanvas.height = height;\n    const context = cropCanvas.getContext('2d');\n    context.drawImage(sourceImage, left, top, width, height, 0, 0, width, height);\n    return cropCanvas;\n  }\n\n  mymousedown(e) {\n    this.$rect.startX = e.pageX - this.$canvas.offsetLeft - 280;\n    this.$rect.startY = e.pageY - this.$canvas.offsetTop - 195;\n    this.drag = true;\n  }\n\n  mymouseup(e) {\n    this.drag = false;\n    this.$ctx.strokeRect(this.$rect.startX, this.$rect.startY, this.$rect.w, this.$rect.h); //var canvas = document.getElementById('src');\n\n    const worker = new Tesseract.TesseractWorker(); // const worker = Tesseract;\n    // const srcContext = document.getElementById('src').getContext('2d');\n    // let img = await loadImage('1.jpg');\n    // srcContext.drawImage(img, 0, 0);\n\n    const rct = {\n      left: this.$rect.startX,\n      top: this.$rect.startY,\n      width: this.$rect.w,\n      height: this.$rect.h\n    };\n    const cropImgCanvas = this.cropImage(this.$canvas, rct); //img\n\n    if (cropImgCanvas) {} else {} // just renderint to visualize - no need for actual crop\n\n\n    this.$srcContext.rect(rct.left, rct.top, rct.width, rct.height);\n    this.$srcContext.strokeStyle = '#FF0000';\n    this.$srcContext.stroke(); // todo: pass the rect info and promise them all?\n\n    worker.recognize(cropImgCanvas).progress(progress => {}).then(result => {\n      // document.getElementById('text').value = result.text;\n      // text = result.text\n      const objects = [{\n        \"typeofDocument\": \"Order\",\n        \"nameOfDocument\": \"LightSpeed\",\n        \"carrierId\": \"carrierId\"\n      }];\n      this.$sitePersonel.objects = objects;\n      this.$xmin = rct.left;\n      this.$ymin = rct.top;\n      this.$xmax = rct.width;\n      this.$ymax = rct.height;\n      let i = 0;\n      var object = {\n        annotateInfo: [result.text, this.$xmin, this.$ymin, this.$xmax, this.$ymax]\n      };\n      i = i + 1;\n      this.$text = result.text;\n      this.$sitePersonel.objects.push(object); // document.getElementById('input').value = text;\n\n      this.modalBody = this.$text;\n      const value = JSON.stringify(this.$sitePersonel);\n      document.getElementById('json').innerHTML = value;\n    });\n    this.modalBody = this.$text; // document.getElementById('input').value = text;\n\n    $('#exampleModal').modal('show');\n  }\n\n  mybutton() {\n    let rct = \"rct\" + this.i;\n    var newData = [this.selectOpt, this.$xmin, this.$ymin, this.$xmax, this.$ymax];\n    this.$obj.rct.push(newData);\n    this.$jsonfile = {\n      \"documentId\": \"RANDOM VALUE\",\n      \"typeofDocument\": \"Order\",\n      \"nameofDocument\": \"LighSpeed\",\n      \"carrierId\": \"carrierId\",\n      \"value\": this.selectOpt,\n      \"createDate\": \"\",\n      \"createdTime\": \"\"\n    }; // let rct = \"rct\" + this.i;\n    // this.$rectn.push(rct);\n    // this.$res.push(this.$xmin,\n    //   this.$xmax,\n    //   this.$ymin,\n    //   this.$ymax)\n    // this.$annotateinfo[rct] =1;\n    // // this.$xmin,\n    // // this.$xmax,\n    // // this.$ymin,\n    // // this.$ymax;\n    // this.i++;\n\n    JSON.stringify(this.$jsonfile);\n    const para = document.createElement('P');\n    const h = document.createElement('h3'); // h.innerHTML = document.getElementById('select').value;\n\n    h.innerHTML = this.selectOpt;\n    var inputValue = document.getElementById(\"input\").value;\n    para.innerHTML = inputValue;\n    this.$val.push(inputValue);\n    this.$head.push(this.selectOpt);\n    this.$pdfjson[this.selectOpt] = inputValue;\n    JSON.stringify(this.$pdfjson);\n    this.service.dataSubscribe.next(JSON.stringify(this.$pdfjson));\n    document.getElementById('myDIV').appendChild(h);\n    document.getElementById('myDIV').appendChild(para);\n  }\n\n  myclick(e) {\n    this.service.dataSubscribe.next(JSON.stringify(this.$pdfjson));\n    this.http.post(this.url, this.$obj).subscribe(data => {}); // this.http.get(this.url + \"/fgfd\").subscribe((data : any) => {\n    // });\n\n    this.service.missionAnnouncedSource.next(this.$pdfjson);\n  }\n\n  mymouseout(e) {}\n\n  mymousemove(e) {\n    this.$cursorVT.setAttribute('style', `left: ${e.clientX}px;`);\n    this.$cursorHL.setAttribute('style', `top: ${e.clientY}px;`);\n\n    if (this.drag) {\n      this.$rect.w = e.pageX - this.$canvas.offsetLeft - this.$rect.startX - 280;\n      this.$rect.h = e.pageY - this.$canvas.offsetTop - this.$rect.startY - 195;\n      this.$ctx.strokeStyle = 'red'; //  this.$ctx.strokeRect( this.$rect.startX,  this.$rect.startY,  this.$rect.w,  this.$rect.h);\n      // this.$ctx.fillStyle = \"green\";\n      // this.$ctx.globalAlpha = 0.01;  // [0, 1]\n      // this.$ctx.fillRect(this.$rect.startX, this.$rect.startY, this.$rect.w, this.$rect.h);\n    }\n  }\n\n  ngOnInit() {}\n\n};\n\nPdfAutomationComponent.ctorParameters = () => [{\n  type: PdfAutomationService\n}, {\n  type: HttpClient\n}];\n\nPdfAutomationComponent.propDecorators = {\n  pdfcanvas: [{\n    type: ViewChild,\n    args: ['pdfcanvas', {\n      static: true\n    }]\n  }]\n};\nPdfAutomationComponent = __decorate([Component({\n  selector: 'app-pdfautomation',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], PdfAutomationComponent);\nexport { PdfAutomationComponent };","map":null,"metadata":{},"sourceType":"module"}