<section class="body">
  <div class="inner-wrapper">
    <section role="main" class="content-body pt-0 pr-0 pl-1">
      <header class="page-header pr19 pl11">
        <div class="row" style="padding-top: 10px">
          <div class="col-md-2 col-lg-2 pr-0">
            <ng-select
              [(ngModel)]="entityID"
              name="entityID"
              style="width: 100%"
              class="text-capitalize"
              placeholder="Search by contact"
            >
              <ng-option
                *ngFor="let driver of drivers"
                value="{{ driver.driverID }}"
              >
                {{ driver.firstName }}
              </ng-option>
              <ng-option
                *ngFor="let emp of employees"
                value="{{ emp.entityID }}"
              >
                {{ emp.firstName }} {{ emp.lastName }}
              </ng-option>
            </ng-select>
          </div>

          <div class="col-md-2 col-lg-2 pl-2 pr-0">
            <ng-select
              [(ngModel)]="searchServiceTask"
              name="searchServiceTask"
              style="width: 100% !important"
              placeholder="Contact Renewal Type"
            >
              <ng-option
                *ngFor="let data of tasks | keyvalue"
                value="{{ data.key }}"
              >
                {{ data.value }}
              </ng-option>
            </ng-select>
          </div>
          <div class="col-md-2 col-lg-2 pl-2 pr-0">
            <ng-select
              [(ngModel)]="filterStatus"
              name="filterStatus"
              style="width: 100%"
              placeholder="Select Reminder Status"
            >
              <optgroup label="Select Reminder Status">
                <ng-option value="all">ALL</ng-option>
                <ng-option value="overdue">OVERDUE</ng-option>
                <ng-option value="dueSoon">DUE SOON</ng-option>
              </optgroup>
            </ng-select>
          </div>

          <div class="col-md-2 col-lg-2 pl-2">
            <button
              type="button"
              (click)="searchData()"
              class="btn btn-sm btn-success mr-2"
            >
              Search
            </button>
            <button
              class="btn btn-sm btn-success"
              type="button"
              (click)="resetData()"
            >
              Reset
            </button>
          </div>

          <div class="col-md-4 col-lg-4 text-right pr-1">
            <div class="btn-group flex-wrap ml-2">
              <button
                type="button"
                class="btn btn-success btn-sm dropdown-toggle"
                data-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="fas fa-upload"></i> Export<span class="caret"></span>
              </button>
              <div
                class="dropdown-menu"
                role="menu"
                x-placement="bottom-start"
                style="
                  position: absolute;
                  will-change: transform;
                  top: 0px;
                  left: 0px;
                  transform: translate3d(0px, 38px, 0px);
                "
              >
                <a class="dropdown-item text-1" (click)="csvData()">CSV</a>
              </div>
            </div>
          </div>
        </div>
      </header>


       <div class="">
          <div class="m-2 text-dark">
            <div class="form-group row pt-3">
               <div class="col-3 mb-3">
                  <div class="bg-white p-3">
                     <div>
                <h4 class="m-0 text-4 font-weight-bold">Total Contacts</h4>
                <h3 class="mt-1 mb-0 font-weight-bold">{{ count.total }}</h3>
                    </div>
                 </div>
                 </div>
                  <div class="col-4 mb-3">
                    <div class="bg-white p-3">
                      <div>
                <h4 class="m-0 text-4">Total Overdue Service</h4>
                <h3 class="mt-1 mb-0 font-weight-bold">{{ count.overdue }}</h3>
                      </div>
                      </div>
                    </div>
                     <div class="col-4 mb-3">
                        <div class="bg-white p-3">
                          <div>
                <h4 class="m-0 text-4">Total Due Soon</h4>
                <h3 class="mt-1 mb-0 font-weight-bold">{{ count.dueSoon }}</h3>
                            </div>
                          </div>
                   </div>
              </div>
            </div>
         </div>
         
                        <section class="m-2">
        <div class="row mb-3">
          <div class="col-lg-12">
             <div class="bg-white p-3 text-dark">
           <div class="form-group row pt-2">
          <div class="col-lg-12" style="height: calc(90vh - 149px); overflow-y: scroll;">
           
              <p-table #dt 
              [value]="empData" 
              [resizableColumns]="true" 
              columnResizeMode="expand" scrollDirection="both"
                [columns]="selectedColumns" [loading]="!loaded"
                styleClass=" p-datatable-sm p-datatable-gridlines p-datatable-striped" 
                [loading]="!loaded" scrollHeight="100%"  responsiveLayout="scroll" >


                <ng-template pTemplate="caption">
                  <div class="p-d-flex d-flex justify-content-between align-items-center">
                    <div>
                      <h3 class="m-0"> Contact Renewals Reports </h3>
                    </div>
                    <div class="text-right">
                      <span>Showing {{empData.length}} entries</span> &nbsp;
                      <button type="button" pButton (click)="refreshData()" pTooltip="Refresh"
                        class="p-button-outlined mr-2" icon="fas fa-sync"></button>
                      <button pButton pRipple pTooltip="Clear Filter" class="p-button-outlined mr-2" (click)="clear(dt)"
                        icon="pi pi-filter-slash"></button>

                    </div>
                  </div>
                </ng-template>

                <ng-template pTemplate="header" let-columns>
                  <tr>

                   
                    <th *ngFor="let column of dataColumns" [pSortableColumn]="column.field" pResizableColumn
                     [ngStyle]="{'width': column.width}">
                      <span>
                        <div class="flex justify-content-center align-items-center" alignFrozen="right" pFrozenColumn
                          [frozen]="true">
                          {{column.header}}
                          <p-sortIcon [field]="column.field">
                          </p-sortIcon>
                          <p-columnFilter [type]="column.type" [field]="column.field" matchMode="contains"
                            [showMatchModes]="false" [showOperator]="false" [showAddButton]="false" display="menu">
                          </p-columnFilter>
                        </div>
                      </span>

                    

                </ng-template>
                 <ng-template
                      pTemplate="body"
                      let-renewals
                      let-columns="columns"
                      let-rowIndex="rowIndex"
                    >
                      <tr>
                        <td
                          *ngFor="let dataColumns of columns"
                          style="width: 10%; height: 50px; cursor: pointer"
                        >
                          <div [ngSwitch]="dataColumns.field">
                            <span
                              class="font-weight-bold line-height-lg text-capitalize"
                              *ngSwitchCase="'entityID'"
                            >
                              <span class="text-capitalize">
                                {{ mergedList[renewals.entityID] }}
                              </span>
                            </span>
                              <span *ngSwitchCase="'status'">
                              <span
                                class="text-warning font-weight-bold font-size-12 text-uppercase"
                                *ngIf="renewals.status === 'dueSoon'"
                                >{{ renewals.status }}<br
                              /></span>
                               <span
                                class="text-danger font-weight-bold font-size-12 text-uppercase"
                                *ngIf="renewals.status === 'overdue'"
                                >{{ renewals.status }}<br
                              /></span>
                                <span
                                class="font-weight-bold text-capitalize"
                                title="Task"
                                >{{ tasks[renewals.tasks.taskID] }}</span
                              >
                            </span>
                             <span *ngSwitchCase="'tasks.timeUnit'">
                              Every {{ renewals.tasks.time }}
                              {{ renewals.tasks.timeUnit }}(s)
                            </span>
                            
                            <span  *ngSwitchCase="'tasks.dueDate'">
                               {{ renewals.tasks.dueDate | date: "yyyy/MM/dd" }}
                            </span>
                          
                            <span *ngSwitchDefault>
                              {{ get(renewals, dataColumns.field) }}</span
                            >
                          </div>
                        </td>
                      </tr>
                    </ng-template>

                <!-- Empty Template -->
                <ng-template pTemplate="emptymessage" let-columns>
                  <div class="col-lg-12 mt-3 text-center">
                  <span> {{dataMessage}} </span>  
                    <br /><br/>
                  </div>
                </ng-template>
                <!-- Summary Section with Load More button -->

                <ng-template pTemplate="summary" let-columns>
                  <div class="col-lg-12 mt-3 text-center " *ngIf="lastItemSK !=='end' && empData.length !==0 ">
                    <button type="button " (click)="onScroll($event) " class="btn btn-success btn-sm text-light ">Load
                      More..</button>

                    <br /><br>
                  </div>
                  <div class="col-lg-12 mt-3 text-center" *ngIf="lastItemSK ==='end'">
                    Total Records: {{empData.length}}</div>
                </ng-template>

               
            </p-table>
         
        </div>
  </div>
  </div>
  </div>
  </div>
</section> 
         
      <!--<div class="m-2">-->
      <!--  <div class="row text-dark">-->
        
          
      <!--    <div class="col">-->
      <!--      <div class="card">-->
      <!--        <div class="col-lg-12 pl-0 pr-0">-->
      <!--          <div-->
      <!--            infiniteScroll-->
      <!--            [infiniteScrollDistance]="1"-->
      <!--            [infiniteScrollUpDistance]="1"-->
      <!--            [infiniteScrollThrottle]="5"-->
      <!--            (scrolled)="onScroll()"-->
      <!--          >-->
      <!--            <div class="card-body bor-radius0px p-3">-->
      <!--              <section class="reports_div">-->
      <!--                <table class="table table-bordered table-striped">-->
      <!--                  <thead>-->
      <!--                    <tr class="">-->
      <!--                      <th>Contact</th>-->
      <!--                      <th>Contact Renewal Type</th>-->
      <!--                      <th>Send Reminder</th>-->
      <!--                      <th>Expiration Date</th>-->
      <!--                      <th>Subscribers</th>-->
      <!--                    </tr>-->
      <!--                  </thead>-->
      <!--                  <tbody>-->
      <!--                    <tr *ngIf="empData.length == 0" class="text-center">-->
      <!--                      <td colspan="6">{{ dataMessage }}</td>-->
      <!--                    </tr>-->
      <!--                    <tr *ngFor="let item of empData">-->
      <!--                      <td>-->
      <!--                        <span class="text-capitalize">-->
      <!--                          {{ mergedList[item.entityID] }}-->
      <!--                        </span>-->
      <!--                      </td>-->
      <!--                      <td>-->
      <!--                        <span-->
      <!--                          class="text-warning font-weight-bold font-size-12 text-uppercase"-->
      <!--                          *ngIf="item.status === 'dueSoon'"-->
      <!--                          >{{ item.status }}<br-->
      <!--                        /></span>-->
      <!--                        <span-->
      <!--                          class="text-danger font-weight-bold font-size-12 text-uppercase"-->
      <!--                          *ngIf="item.status === 'overdue'"-->
      <!--                          >{{ item.status }}<br-->
      <!--                        /></span>-->
      <!--                        <span-->
      <!--                          class="font-weight-bold text-capitalize"-->
      <!--                          title="Task"-->
      <!--                          >{{ tasks[item.tasks.taskID] }}</span-->
      <!--                        >-->
      <!--                      </td>-->
      <!--                      <td>-->
      <!--                        Every {{ item.tasks.time }}-->
      <!--                        {{ item.tasks.timeUnit }}(s)-->
      <!--                      </td>-->
      <!--                      <td>-->
      <!--                        {{ item.tasks.dueDate | date: "yyyy/MM/dd" }}-->
      <!--                      </td>-->
      <!--                      <td>{{ item.subscribers }}</td>-->
      <!--                    </tr>-->
      <!--                  </tbody>-->
      <!--                </table>-->
      <!--              </section>-->
      <!--            </div>-->
      <!--            <div-->
      <!--              class="col-lg-12 mt-3 text-center"-->
      <!--              *ngIf="lastItemSK !== 'end' && empData.length !== 0"-->
      <!--            >-->
      <!--              <button-->
      <!--                type="button"-->
      <!--                class="btn btn-success btn-sm text-light"-->
      <!--                (click)="onScroll()"-->
      <!--              >-->
      <!--                Load More..-->
      <!--              </button>-->
      <!--            </div>-->
      <!--          </div>-->
      <!--        </div>-->
      <!--      </div>-->
      <!--    </div>-->
      <!--  </div>-->
      <!--</div>-->
    </section>
  </div>
</section>
