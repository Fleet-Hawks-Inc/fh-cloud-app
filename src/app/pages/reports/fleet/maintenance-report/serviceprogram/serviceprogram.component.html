<section class="body">
  <div class="inner-wrapper">
    <section role="main" class="content-body pl-1 pt-0 pr-0">
      <header class="page-header pr19 pl11">
        <form class="form-horizontal" method="get">
          <div class="row" style="padding-top: 10px">
            <div class="col-md-2 col-lg-2 pr-0">
              <ng-select
                data-plugin-selectTwo
                class="form-control populate"
                [(ngModel)]="vehicle"
                name="vehicle"
                placeholder="Select Vehicle"
              >
                <ng-option
                  *ngFor="let item of vehicles | keyvalue"
                  value="{{ item.key }}"
                  >{{ item.value }}</ng-option
                >
              </ng-select>
            </div>

            <!-- Set spacing issue -->
            <div class="col-md-2 col-lg-2 pl-2 pr-0">
              <ng-select
                data-plugin-selectTwo
                class="form-control populate"
                [(ngModel)]="programName"
                name="programName"
                placeholder="Select Program Name"
              >
                <ng-option
                  *ngFor="let item of serviceProgramList"
                  value="{{ item.programID }}"
                  >{{ item.programName }}
                </ng-option>
              </ng-select>
            </div>

            <div class="col-md-2 col-lg-2 pl-2">
              <button
                type="submit"
                [disabled]="disableSearch"
                (click)="searchFilter()"
                class="btn btn-sm btn-success mr-2"
              >
                Search
              </button>
              <button
                type="button"
                [disabled]="disableSearch"
                (click)="resetFilter()"
                class="btn btn-sm btn-success"
              >
                Reset
              </button>
            </div>

            <div class="col-md-6 col-lg-6 text-right pr-1">
              <div class="btn-group flex-wrap ml-4">
                <button
                  type="button"
                  class="btn btn-success btn-sm dropdown-toggle"
                  data-toggle="dropdown"
                  aria-expanded="false"
                >
                  <i class="fas fa-upload"></i> Export<span
                    class="caret"
                  ></span>
                </button>
                <div
                  class="dropdown-menu"
                  role="menu"
                  x-placement="bottom-start"
                  style="
                    position: absolute;
                    will-change: transform;
                    top: 0px;
                    left: 0px;
                    transform: translate3d(0px, 38px, 0px);
                  "
                >
                  <a class="dropdown-item text-1" (click)="csv()">CSV</a>
                </div>
              </div>
            </div>
          </div>
        </form>
      </header>
   
              <section class="m-2">
        <div class="row mb-3">
          <div class="col-lg-12">
             <div class="bg-white p-3 text-dark">
           <div class="form-group row pt-2">
          <div class="col-lg-12" style="height: calc(100vh - 149px); overflow-y: scroll;">
           
              <p-table #dt 
              [value]="serviceProgramList" 
              [resizableColumns]="true" 
              columnResizeMode="expand" scrollDirection="both"
                [columns]="selectedColumns" [loading]="!loaded"
                styleClass=" p-datatable-sm p-datatable-gridlines p-datatable-striped" 
                [loading]="!loaded" scrollHeight="100%"  responsiveLayout="scroll" >


                <ng-template pTemplate="caption">
                  <div class="p-d-flex d-flex justify-content-between align-items-center">
                    <div>
                      <h3 class="m-0"> Service Program Report </h3>
                    </div>
                    <div class="text-right">
                      <span>Showing {{serviceProgramList.length}} entries</span> &nbsp;
                      <button type="button" pButton (click)="refreshData()" pTooltip="Refresh"
                        class="p-button-outlined mr-2" icon="fas fa-sync"></button>

                     

                      <button pButton pRipple pTooltip="Clear Filter" class="p-button-outlined mr-2" (click)="clear(dt)"
                        icon="pi pi-filter-slash"></button>

                    </div>
                  </div>
                </ng-template>

                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th *ngFor="let column of dataColumns" [pSortableColumn]="column.field" pResizableColumn
                     [ngStyle]="{'width': column.width}">
                      <span>
                        <div class="flex justify-content-center align-items-center" alignFrozen="right" pFrozenColumn
                          [frozen]="true">
                          {{column.header}}
                          <p-sortIcon [field]="column.field">
                          </p-sortIcon>
                          <p-columnFilter [type]="column.type" [field]="column.field" matchMode="contains"
                            [showMatchModes]="false" [showOperator]="false" [showAddButton]="false" display="menu">
                          </p-columnFilter>
                        </div>
                      </span>
                </ng-template>
                <ng-template pTemplate="body" let-log let-columns="columns" let-rowIndex="rowIndex"
                  >
                  <tr style="width: 10%; height: 40px;cursor: pointer;">
                     
                            <td [ngStyle]="{'width': find(columns,{field:'vehicles'}).width}" >
                             <span
                                *ngFor="
                                  let vehicle of log.vehicles;
                                  let i = index
                                "
                              >
                                {{ vehicles[vehicle]
                                }}{{
                                  i !== log.vehicles.length - 1 ? "," : "" 
                                }}
                              </span>
                            </td>
                            
                            <td [ngStyle]="{'width': find(columns,{field:'programName'}).width}">
                               <span >
                                  <span>{{ log.programName }}</span>
                            
                              </span>
                            </td>
                            
                            <td [ngStyle]="{'width': find(columns,{field:'description'}).width}">
                               <span >
                              {{ log.description ? log.description : "-" }}
                            </span>
                            </td>
                  </tr>

                </ng-template>

                <!-- Empty Template -->
                <ng-template pTemplate="emptymessage" let-columns>
                  <div class="col-lg-12 mt-3 text-center">
                  <span> {{dataMessage}} </span>  
                    <br /><br/>
                  </div>
                </ng-template>
                <!-- Summary Section with Load More button -->

                <ng-template pTemplate="summary" let-columns>
                  <div class="col-lg-12 mt-3 text-center " *ngIf="lastItemSK !=='end' && serviceProgramList.length !==0 ">
                    <button type="button " (click)="onScroll($event) " class="btn btn-success btn-sm text-light ">Load
                      More..</button>

                    <br /><br>
                  </div>
                  <div class="col-lg-12 mt-3 text-center" *ngIf="lastItemSK ==='end'">
                    Total Records: {{serviceProgramList.length}}</div>
                </ng-template>

               
            </p-table>
         
        </div>
  </div>
  </div>
  </div>
  </div>
</section>
    </section>
  </div>
</section>
