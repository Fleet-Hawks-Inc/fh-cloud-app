<section class="body">
    <div class="inner-wrapper">
        <section role="main" class="content-body pl-1 pt-0 pr-0">
            <header class="page-header pr19 pl11">
                <div class="row" style="padding-top:10px;">
                        <div class="col-md-2 col-lg-2 pr-3">
                            <ng-select [(ngModel)]="vehicleID" name="vehicleID" style="width: 100% !important;"
                                placeholder="Search By vehicle">
                                <ng-option *ngFor="let data of vehicleList | keyvalue" value="{{ data.key }}"> {{
                                    data.value }}</ng-option>
                            </ng-select>
                        </div>

                    <div class="col-md-2 col-lg-2 pl-0">
                        <ng-select [(ngModel)]="searchServiceTask" name="searchServiceTask"
                            style="width: 100% !important;" placeholder="Search task">
                            <optgroup label="Select Service Task">
                                <ng-option *ngFor="let data of tasksList | keyvalue" value="{{ data.key }}">
                                    {{ data.value }}
                                </ng-option>
                            </optgroup>
                        </ng-select>
                    </div>

                    <div class="col-md-2 col-lg-2 pl-0 pr-0">
                        <ng-select [(ngModel)]="filterStatus" name="filterStatus" style="width: 100%;"
                            placeholder="Select Reminder Status">
                            <optgroup label="Select Reminder Status">
                                <ng-option value="all">ALL</ng-option>
                                <ng-option value="overdue">OVERDUE</ng-option>
                                <ng-option value="dueSoon">DUE SOON</ng-option>
                            </optgroup>
                        </ng-select>
                    </div>
                    <div class="col-md-2 col-lg-2">
                        <button type="submit" (click)=" searchData()"
                            class="btn btn-sm btn-success mr-3">Search</button>
                        <button type="button" (click)="resetData()" class="btn btn-sm btn-success">Reset</button>
                    </div>

                    <div class="col-md-4 col-lg-4 text-right pr-1 page-buttons">
                        <div class="btn-group flex-wrap mr-2" *ngIf=!environment>
                            <button type="button" class="btn btn-success btn-sm dropdown-toggle" data-toggle="dropdown"
                                aria-expanded="false">Actions<span class="caret"></span></button>
                            <div class="dropdown-menu" role="menu" x-placement="bottom-start"
                                style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 38px, 0px);">
                                <a class="dropdown-item text-1" href="">Import</a>
                                <a class="dropdown-item text-1" href="">Export</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <section class="m-2">
                <div class="row mb-3">
                    <div class="col-lg-12">
                            <div class="bg-white p-3 text-dark">
                                <div class="form-group row">
                                    <div class="col-lg-12">
                                        <div class="wtopnav">
                                            <ul class="nav nav-tabs top-tabs pl-0 mb-3">
                                                <li class="nav-item"><a class="nav-link active"
                                                        routerLink="/fleet/reminders/service-reminder/list">Service
                                                        Reminders </a></li>
                                                <li class="nav-item"><a class="nav-link"
                                                        routerLink="/fleet/reminders/vehicle-renewals/list">Vehicle
                                                        Renewals
                                                    </a></li>
                                                <li class="nav-item"><a class="nav-link"
                                                        routerLink="/fleet/reminders/contact-renewals/list">Contact
                                                        Renewals
                                                    </a></li>
                                            </ul>
                                        </div>
                                    </div>
                                  <div class="col-lg-12" style="height: calc(100vh - 149px); overflow-y: scroll;">
                                    <p-table #dt [value]="remindersData" [resizableColumns]="true" columnResizeMode="expand" scrollDirection="both" [columns]="selectedColumns" [loading]="!loaded" styleClass="p-datatable-sm p-datatable-gridlines p-datatable-striped" [scrollable]="true"
                                        scrollHeight="100%">
                                        <ng-template pTemplate="caption">
                                            <div class="p-d-flex d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h3 class="m-0"> Service Reminders </h3>
                                                </div>
                                                <div class="text-right">
                                                    <span>Showing {{remindersData.length}} entries </span> &nbsp;
                                                    <button type="button" pButton (click)="refreshData()" pTooltip="Refresh" class="p-button-outlined mr-2" icon="fas fa-sync"></button>
                                                    <button type="button" pButton pTooltip="Add" routerLink="/fleet/reminders/service-reminder/add" class="p-button-outlined mr-2" icon="pi pi-plus"></button>
                                                    <button pButton pRipple pTooltip="Clear Filter" class="p-button-outlined mr-2" icon="pi pi-filter-slash" (click)="clear(dt)"></button>
                                                    <!--<button type="button" pButton pRipple class="p-button-outlined mr-2" icon="fas fa-regular fa-file-excel" (click)="dt.exportCSV()" pTooltip="Excel"></button>-->
                                                    <p-multiSelect [options]="dataColumns" [(ngModel)]="selectedColumns" optionLabel="header" selectedItemsLabel="{0} columns selected" [style]="{minWidth: '200px'}" placeholder="Choose Columns">
                                                    </p-multiSelect>
                                                </div>
                                            </div>
                                        </ng-template>
                                        <ng-template pTemplate="header" let-columns>
                                            <tr>
                                                <th *ngFor="let dataColumns of columns" [pSortableColumn]="dataColumns.field" pResizableColumn [ngStyle]="{'width':dataColumns.width}">
                                                    <div [ngSwitch]="dataColumns.field">
                                                        <span *ngSwitchDefault>
                                                            <div class="flex justify-content-center align-items-center"
                                                                alignFrozen="right" pFrozenColumn [frozen]="true">
                                                                {{dataColumns.header}}
                                                                <p-sortIcon [field]="dataColumns.field"></p-sortIcon>
                                                                <p-columnFilter [type]="dataColumns.type"
                                                                    [field]="dataColumns.field" matchMode="contains"
                                                                    [showMatchModes]="false" [showOperator]="false"
                                                                    [showAddButton]="false" display="menu">
                                                                </p-columnFilter>
                                                            </div>
                                                        </span>
                            </div>
                            </th>
                            <th style="width:130px" alignFrozen="right" pFrozenColumn [frozen]="true">Actions</th>
                            </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-vehicle let-columns="columns" let-rowIndex="rowIndex">
                                <tr>
                                    <td *ngFor="let dataColumns of columns" [ngStyle]="{'width': dataColumns.width}" style="cursor: pointer;">
                                        <div [ngSwitch]="dataColumns.field">
                                        <span *ngSwitchCase="'vehicleIdentification'">
                                            {{vehicleList[vehicle.entityID]}}
                                        </span>
                                        <span *ngSwitchCase="'serviceTask'">
                                            <span
                                            class="text-warning font-weight-bold font-size-12 text-uppercase"
                                            *ngIf="vehicle.status === 'dueSoon'">{{vehicle.status}}<br></span>
                                            <span
                                            class="text-danger font-weight-bold font-size-12 text-uppercase"
                                            *ngIf="vehicle.status === 'overdue'">{{vehicle.status}}<br></span>
                                            <span class="font-weight-bold"
                                            title="Service Task">{{tasksList[vehicle.tasks.taskID]}}</span>
                                            <br>
                                            <span class="font-size-12">
                                            <span *ngIf="vehicle.tasks.remindByUnit == 'time'">Every
                                            {{vehicle.tasks.time}} {{vehicle.tasks.timeUnit}}(s)
                                            </span>
                                            <span
                                            *ngIf="vehicle.tasks.remindByUnit == 'odometer'">Every
                                            {{vehicle.tasks.odometer}} miles</span>
                                            </span>                                      
                                        </span>
                                        <span *ngSwitchCase="'nextDue'">
                                            <span *ngIf="vehicle.tasks.remindByUnit == 'time'">
                                            <span *ngIf="vehicle.nextDueDays > 0">{{vehicle.nextDueDays}}
                                            Day(s) from now</span>
                                            <span *ngIf="vehicle.nextDueDays === 0">Today</span>
                                            <span *ngIf="vehicle.nextDueDays < 0">{{vehicle.nextDueDays |
                                            absoluteValue}} Days ago</span>
                                            </span>
                                            <br>
                                            <span *ngIf="vehicle.tasks.remindByUnit == 'odometer'">
                                            {{vehicle.nextDueMiles}} miles from now
                                            </span>
                                        </span>        
                                            <span *ngSwitchDefault>{{get(vehicle,dataColumns.field)}}</span>
                                        </div>

                                    </td>
                                    <td style=" text-align: center; width: 130px;" pFrozenColumn alignFrozen="right" [frozen]="true">
                                        <button id="btnEdit" pButton pTooltip="Enter Service" (click)="resolveReminder(vehicle.reminderIdentification)" type="button" icon="pi pi-plus" class="p-button-rounded p-button-text"></button>
                                        <button id="btnEdit" pButton pTooltip="Send Notifications" (click)="sendEmailNotification(vehicle)" type="button" icon="pi pi-envelope" class="p-button-rounded p-button-text"></button>
                                        <button id="btnEdit" pButton pTooltip="Edit" routerLink="/fleet/reminders/service-reminder/edit/{{vehicle.reminderID}}" type="button" icon="fas fa-user-pen" class="p-button-rounded p-button-text"></button>
                                        <button id="btnDelete" (click)="deleteReminder(vehicle)" pButton pTooltip="Delete" type="button" icon="fas fa-user-slash" class="p-button-rounded p-button-danger p-button-text"></button>
                                    </td>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="emptymessage" let-columns>
                                <div class="col-lg-12 mt-3 text-center">
                                    {{dataMessage}}
                                    <br /><br>
                                </div>
                            </ng-template>
                            <ng-template pTemplate="summary" let-columns>
                                <div class="col-lg-12 mt-3 text-center " *ngIf="lastEvaluatedKey !=='end' && remindersData.length !==0 ">
                                    <button type="button " (click)="onScroll($event) " class="btn btn-success btn-sm text-light ">Load
                                                    More..</button>
                                    <br /><br>
                                </div>
                                <div class="col-lg-12 mt-3 text-center" *ngIf="lastEvaluatedKey ==='end'">
                                    Total Records: {{remindersData.length}}</div>
                            </ng-template>
                            </p-table>
                        </div>
                                </div>
                            </div>
                    </div>
                </div>
            </section>
         
        </section>
    </div>
</section>