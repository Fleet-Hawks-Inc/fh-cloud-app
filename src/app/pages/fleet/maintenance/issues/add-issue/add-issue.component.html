<section class="body">
    <!-- start: header -->
    <app-header></app-header>
    <!-- end: header -->

    <div class="inner-wrapper">
        <!-- start: sidebar -->
        <app-sidebar></app-sidebar>
        <!-- end: sidebar -->

        <section role="main" class="content-body pl-0 pr-0 pt-0">
            <header class="page-header pr-5">
                <div class="row pr-1 mr-1" style="padding-top:10px;">
                    <div class="col-md-4 col-lg-4">
                        <h4 class="text-4 font-weight-bold mt-0 mb-0 text-dark">{{title}}</h4>
                    </div>
                    <div class="col-md-8 col-lg-8 text-right pr-1">
                        <a routerLink="/fleet/maintenance/issues/list" class="btn btn-default btn-sm"><i class="fas fa-list"></i> Issues
                            List</a>
                    </div>
                </div>
            </header>
            <div class="row">
                <div class="col pr-0">
                    <div class="card-body text-dark">
                        <form id="issueForm" class="form-horizontal form-bordered" method="get" name="issueForm" >
                            <div class=" row">
                                <div class="col-lg-12">
                                    <label
                                        class="control-label font-weight-bold font-bold text-lg-right text-dark text-4 font-weight-bold pt-2">Issue
                                        Details</label>
                                </div>
                                <div class="col-lg-5 offset-lg-1">
                                    <div class="row">
                                        <div class="col-lg-12">
                                           <div class="row">
                                              <div class="col-lg-3">
                                                 <label class="control-label font-weight-bold text-lg-right"
                                                    >Unit Type:</label>
                                              </div>
                                              <div class="col-lg-6">
                                                <div class="btn-group-toggle" data-toggle="buttons">
                                                  <label class="btn btn-outline btn-fleet mr-2" [class.active]="unitType === 'vehicle'" style="width:110px;" (click) = "onChangeUnitType('vehicle')">
                                                    <input type="radio" name="unitType" [(ngModel)]="unitType"
                                                       checked hidden value="vehicle" > Vehicle </label>
                                                  <label class="btn btn-outline btn-fleet mr-2 " style="width:110px;" [class.active]="unitType === 'asset'" (click) = "onChangeUnitType('asset')">
                                                    <input type="radio" name="unitType" [(ngModel)]="unitType"
                                                         hidden value="asset" > Asset </label>
                                                </div>
                                              </div>
                                           </div>
                                        </div>
                                     </div>
                                     <div class="row pt-2">
                                        <div class="col-lg-10" *ngIf="unitType ==='vehicle'">
                                            <label
                                                class="control-label font-weight-bold font-bold text-lg-right pt-2">Vehicle</label>
                                            <ng-select placeholder="Select Vehicle" name="unitID" [(ngModel)]="unitID">                                               
                                                <ng-option *ngFor="let vehicle of vehicles" value="{{vehicle.vehicleID}}">{{vehicle.vehicleIdentification}}</ng-option>                                                
                                            </ng-select>
                                        </div>
                                        <div class="col-lg-10" *ngIf="unitType ==='asset'">
                                            <label
                                                class="control-label font-weight-bold font-bold text-lg-right pt-2">Asset</label>
                                            <ng-select placeholder="Select Asset" name="unitID" [(ngModel)]="unitID">
                                                
                                                <ng-option *ngFor="let asset of assets" value="{{asset.assetID}}">{{asset.assetIdentification}}</ng-option>
                                                
                                            </ng-select>
                                        </div>
                                    </div>
                                    <div class="row pt-2">
                                        <div class="col-lg-10">
                                         <label class="control-label font-weight-bold font-bold text-lg-right pt-2">Issue Name</label>
                                         <input type="text"  class="form-control" id="issueName" name="issueName" [(ngModel)]="issueName" placeholder="Enter issue name eg. brake issue">
                                       </div>
                                    </div>
                                    <div class="row pt-2">
                                        <div class="col-lg-10">
                                            <label
                                                class="control-label font-weight-bold font-bold text-lg-right pt-2">Reported
                                                Date</label>

                                                <input class="form-control"  placeholder="dd-mm-yyyy"
                                                 [(ngModel)]="reportedDate" name="reportedDate" (click)="d.toggle()" ngbDatepicker #d="ngbDatepicker">

                                        </div>
                                    </div>
                                    <div class="row pt-2">
                                        <div class="col-lg-10">
                                            <label
                                                class="control-label font-weight-bold font-bold text-lg-right pt-2">Description&nbsp; <span
												class="text-1 optional-label-color">(optional)</span></label>
                                            <textarea [(ngModel)]="description" name="description" class="form-control" rows="3" placeholder="Enter description of the issue"></textarea>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-lg-5 offset-lg-1">
                                    <div class="row pt-2">
                                        <div class="col-lg-10">
                                            <label
                                                class="control-label font-weight-bold font-bold text-lg-right pt-2">Odometer(miles)</label>
                                            <input [(ngModel)]="odometer" name="odometer" type="number" class="form-control" placeholder="Enter odometer miles at which issue is reported. eg. 10000">
                                        </div>
                                    </div>
                                    <div class="row pt-2">
                                        <div class="col-lg-10">
                                            <label
                                                class="control-label font-weight-bold font-bold text-lg-right pt-2">Reported
                                                By</label>
                                            <ng-select [(ngModel)]="reportedBy" name="reportedBy" placeholder="Select Contact">
                                              
                                                    <ng-option *ngFor="let contact of contacts" value="{{contact.contactID}}">{{contact.firstName}}</ng-option>
                                                   
                                            </ng-select>
                                        </div>
                                    </div>
                                    <div class="row pt-2">
                                        <div class="col-lg-10">
                                            <label
                                                class="control-label font-weight-bold font-bold text-lg-right pt-2">Assigned To</label>
                                            <ng-select [(ngModel)]="assignedTo" name="assignedTo" placeholder="Assign the issue">                                               
                                                    <ng-option value="Operator">Operator</ng-option>
                                                    <ng-option value="Technician">Technician</ng-option>                                            
                                            </ng-select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-12">
                                    <label
                                        class="control-label font-weight-bold font-bold text-lg-right text-dark text-4  pt-2">Additional
                                        Details</label>
                                </div>
                                <div class="col-lg-5 offset-lg-1">
                                    <div class="row">
                                        <div class="col-lg-10">
                                            <label
                                                class="control-label font-weight-bold font-bold text-lg-right">Attach
                                                Photo</label>
                                                <input (change)="selectDocuments($event, 'uploadedPhotos')" name="uploadedPhotos" type="file" multiple class="form-control border-0 p-0">
                                            </div>
                                        <div class="col-lg-2  mar-top-37">                                    
                                       </div>
                                    </div>
                                    <div class="row mt-2" *ngIf = 'issueImages?.length'>
                                        <div class="col-lg-5" *ngFor="let photo of issueImages;let i= index">
                                           <div class="vehicle-photo-box">
                                              <img src="{{photo.path}}" width="100%" class="img-fluid"
                                                 style="height: 180px; object-fit: cover;">
                                              <hr class="m-3">
                                              <div class="row">
                                                 <div class="col-lg-8">Image {{i+1}}</div>
                                                 <div class="col-lg-4 text-right">
                                                    <i class="fas fa-times text-danger"  (click)="delete('image',photo.name)"></i>
                                                   
                                                 </div>
                                              </div>
                                           </div>
                                        </div>
                                     </div>
                                </div>
                                <div class="col-lg-5 offset-lg-1">
                                    <div class="row">
                                        <div class="col-lg-10">
                                            <label
                                                class="control-label font-weight-bold font-bold text-lg-right">Attach
                                                Document</label>
                                                <input (change)="selectDocuments($event, 'uploadedDocs')" name="uploadedDocs" type="file" multiple class="form-control border-0 p-0">
                                        </div>
                                        <div class="col-lg-2  mar-top-37">
                                            <!-- <a href="" class="btn btn-sm btn-success"><i class="fas fa-plus"></i></a> -->
                                        </div>

                                    </div>
                                    <div class="row mt-2" *ngIf="issueDocs?.length">
                                        <div class="col-lg-10">
                                           <div class="vehicle-common-box p-3">
                                              <div class="row">
                                                 <div class="col-lg-6"><label
                                                       class="control-label font-weight-bold text-3">Document(s)</label></div>
                                                 <div class="col-lg-6 text-right">
                                                 </div>
                                              </div>
                                              <hr class="solid mt-2">
                                              <div class="row mb-1" *ngFor="let doc of issueDocs;let d= index">
                                                 <div class="col-lg-9" ><a href="{{doc.path}}" targer="_blank">Document {{d+1}}</a> </div> 
                                                 <div class="col-lg-3 text-right">
                                                     <i class="far fa-file text-dak mr-1" (click)="setPDFSrc(doc.path)" data-toggle="modal" data-target="#viewDocModal"></i>
                                                    <a href="javascript:;"  (click)="delete('doc',doc.name)" class="modal-with-form"><i
                                                          class="fas fa-times text-danger"></i></a>
                                                 </div>
                                              </div>
                                           </div>
                                        </div>
                                     </div>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-lg-11 text-right pr-0">
                                    <button type="button" (click)="cancel()" class="btn btn-default mr-1" >Cancel</button>
                                  <button type="button" *ngIf="!issueID" (click)="addIssue()" class="btn btn-success">Save</button>
                                  <button type="button" *ngIf="issueID" (click)="updateIssue()" class="btn btn-success">Update</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        </section>
    </div>
</section>
  <!-- VIEW DOCUMENT MODAL -->
  <div class="modal fade" id="viewDocModal" tabindex="-1" role="dialog" aria-labelledby="viewDocModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="viewDocModalLabel">View Document</h5>
          <button type="button" (click)="setSrcValue()" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">                          
             <div class="form-row">
                <div class="form-group col-md-12">
                   <div>
                      <iframe [src]='pdfSrc'
                      frameborder="0" width="100%" height="400px"> </iframe>

                   </div>
                </div>
             </div>
         
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" (click)="setSrcValue()" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
