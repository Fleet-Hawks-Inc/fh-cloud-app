<section class="body">
  <!-- start: header -->
  <app-header></app-header>
  <!-- end: header -->

  <div class="inner-wrapper">
    <!-- start: sidebar -->
    <app-sidebar></app-sidebar>
    <!-- end: sidebar -->

    <section role="main" class="content-body pt-0 pr-0 pl-0">
      <header class="page-header pr-5">
        <div class="row pr-1 mr-1" style="padding-top:10px;">
          <div class="col-md-2 col-lg-2">
            <div class="input-group input-group-sm mb-3">
              <input
                autocomplete="off"
                type="text"
                name="unitName"
                [(ngModel)]="unitName"
                class="form-control"
                (input)="getSuggestions($event.target.value)"
                placeholder="Search Issues by Unit"
              />
            </div>
            <div
              *ngFor="let suggestedUnit of suggestedUnits"
              style="cursor: pointer"
              (click)="setUnit(suggestedUnit.unitID, suggestedUnit.unitName)"
            >
              {{ suggestedUnit.unitName }}
            </div>
          </div>
          <div class="col-md-2 col-lg-2">
            <div class="input-group input-group-sm mb-3">
              <input type="text" name="issueName" [(ngModel)]="issueName" class="form-control"
                placeholder="Search Issue by Name" />
            </div>
          </div>
          <div class="col-md-1 col-lg-1">
            <button type="submit" (click)="fetchIssues()" class="btn btn-sm btn-success">
              Search
            </button>
          </div>
          <div class="col-md-7 col-lg-7 text-right pr-1 page-buttons">
            <div class="btn-group flex-wrap mr-2">
              <button type="button" class="btn btn-success btn-sm dropdown-toggle" data-toggle="dropdown"
                aria-expanded="false">
                Actions<span class="caret"></span>
              </button>
              <div class="dropdown-menu" role="menu" x-placement="bottom-start" style="
                  position: absolute;
                  will-change: transform;
                  top: 0px;
                  left: 0px;
                  transform: translate3d(0px, 38px, 0px);
                ">
                <a class="dropdown-item text-1" href="">Import</a>
                <a class="dropdown-item text-1" href="">Export</a>
              </div>
            </div>
            <a [routerLink]="['/fleet', 'maintenance', 'issues', 'add']" class="btn btn-success btn-sm"  style="color: white"><i class="fas fa-plus"></i> Add Issue</a>
          </div>
        </div>
      </header>
      <div class="row">
        <div class="col pr-0">
          <section class="card">
            <div class="card-body">
              <table class="table table-responsive-lg table-bordered table-striped mb-0" datatable [dtOptions]="dtOptions">
                <thead>
                  <tr>
                    <th>Unit Type</th>
                    <th>Vehicle/Assets</th>
                    <th>Issue</th>
                    <th>Reported On</th>
                    <th>Reported By</th>
                    <th>Assigned To</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let issue of issues" style="cursor: pointer;">
                    <td routerLink="/fleet/maintenance/issues/detail/{{
                        issue.issueID
                      }}">
                      {{ issue.unitType }}
                    </td>
                    <td routerLink="/fleet/maintenance/issues/detail/{{
                        issue.issueID
                      }}">
                      <span *ngIf= "issue.unitType === 'asset'">{{assetList[issue.unitID]}}</span>
                      <span *ngIf= "issue.unitType === 'vehicle'">{{vehicleList[issue.unitID]}}</span>
                    </td>
                    <td routerLink="/fleet/maintenance/issues/detail/{{
                        issue.issueID
                      }}">
                      {{ issue.issueName }}
                    </td>
                    <td routerLink="/fleet/maintenance/issues/detail/{{
                        issue.issueID
                      }}">
                      {{issue.reportedDate}}
                    </td>
                    <td routerLink="/fleet/maintenance/issues/detail/{{
                        issue.issueID
                      }}">
                      {{contactList[issue.reportedBy]}}
                    </td>
                    <td routerLink="/fleet/maintenance/issues/detail/{{
                        issue.issueID
                      }}">
                      {{ issue.assignedTo }}
                    </td>
                    <td routerLink="/fleet/maintenance/issues/detail/{{
                        issue.issueID
                      }}">
                      <span class="badge badge-dark p-1">{{
                        issue.currentStatus | uppercase
                      }}</span>
                    </td>
                    <td>
                      <div class="btn-group flex-wrap">
                        <button type="button" class="mb-1 mt-1 mr-1 btn" data-toggle="dropdown">
                          <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div class="dropdown-menu" role="menu">
                          <a routerLink="/fleet/maintenance/issues/edit/{{
                              issue.issueID
                            }}" class="dropdown-item text-1">Edit</a>
                          <button type="button" class="dropdown-item text-1" (click)="deleteIssue(issue.issueID)">
                            Delete
                          </button>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>           
            </div>
          </section>
        </div>
      </div>
    </section>
  </div>
</section>