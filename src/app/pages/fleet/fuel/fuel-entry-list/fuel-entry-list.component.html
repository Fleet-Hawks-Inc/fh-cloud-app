<section class="body">
  <div class="inner-wrapper">
    <section role="main" class="content-body pl-1 pr-0 pt-0">
      <header class="page-header pr19 pl11">
        <form class="form-horizontal" method="get" name="form" id="form_">
          <div class="row" style="padding-top: 10px">
            <div class="col-md-2 col-lg-2 pr-1">
                <ng-select [(ngModel)]="unitID" name="unitID" style="width: 100%"
                  placeholder="Search by vehicle"
                >
                  <ng-option
                    *ngFor="let data of allVehicles"
                    [value]="data.vehicleID"
                    >{{ data.vehicleIdentification }}
                  </ng-option>
                </ng-select>
            </div>
            <!-- <div class="col-md-2 col-lg-2 pr-0 pl-2">
              <div class="input-group input-group-sm mb-3">
                <ng-select [(ngModel)]="assetUnitID" name="assetUnitID" style="width: 100%;"
                  placeholder="Search by reefer">
                  <ng-option *ngFor="let data of allAssets" [value]="data.assetID">{{data.assetIdentification}}
                  </ng-option>
                </ng-select>
              </div>
            </div> -->
            <div class="col-lg-3 col-md-3">
              <div class="input-daterange input-group">
                <span class="input-group-prepend">
                  <span class="input-group-text">
                    <i class="fas fa-calendar-alt"></i>
                  </span>
                </span>
                <input
                  [(ngModel)]="fromDate"
                  name="fromDate"
                  type="text"
                  placeholder="yyyy/mm/dd"
                  (click)="from.toggle()"
                  ngbDatepicker
                  #from="ngbDatepicker"
                  class="form-control"
                  autocomplete="off"
                  [minDate]="dateMinLimit"
                  [maxDate]="futureDatesLimit"
                />
                <span
                  class="
                    input-group-text
                    border-left-0 border-right-0
                    rounded-0
                  "
                >
                  to
                </span>
                <input
                  [(ngModel)]="toDate"
                  name="toDate"
                  type="text"
                  placeholder="yyyy/mm/dd"
                  (click)="to.toggle()"
                  ngbDatepicker
                  #to="ngbDatepicker"
                  class="form-control"
                  autocomplete="off"
                  [minDate]="dateMinLimit"
                  [maxDate]="futureDatesLimit"
                />
              </div>
            </div>
            <div class="col-md-2 col-lg- pl-2">
              <button
                type="submit"
                (click)="searchFilter()"
                class="btn btn-sm btn-success mr-3"
              >
                Search
              </button>
              <button
                type="button"
                (click)="resetFilter()"
                class="btn btn-sm btn-success"
              >
                Reset
              </button>
            </div>
            <div class="col-md-5 text-right pr-1 page-buttons">
              <div class="btn-group flex-wrap" *ngIf="!environment">
                <button
                  type="button"
                  class="btn btn-success btn-sm dropdown-toggle"
                  data-toggle="dropdown"
                  aria-expanded="false"
                >
                  Actions<span class="caret"></span>
                </button>
                <div
                  class="dropdown-menu"
                  role="menu"
                  x-placement="bottom-start"
                  style="
                    position: absolute;
                    will-change: transform;
                    top: 0px;
                    left: 0px;
                    transform: translate3d(0px, 38px, 0px);
                  "
                >
                  <a class="dropdown-item text-1" href="">Import</a>
                  <a class="dropdown-item text-1" href="">Export</a>
                </div>
              </div>

              <!-- <a href="javascript:;" (click)="refreshData()"
                data-toggle="tooltip" title="Refresh data"
                class="btn btn-success btn-sm modal-with-form mr-2">
                <i class="fas fa-sync"></i>
              </a> -->

              <div ngbDropdown class="d-inline-block">
                <button class="btn btn-success" id="dropdownBasic1" ngbDropdownToggle>Import</button>
                <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                  <button ngbDropdownItem data-toggle="modal" data-target="#bvdModal">BVD Report</button>
                  <button ngbDropdownItem data-toggle="modal" data-target="#petroModal">Petro Report</button>
                </div>
              </div>
              <a routerLink="/fleet/fuel/add" class="btn btn-success btn-sm ml-2" style="color:white;"><i
                  class="fas fa-plus"></i> Add Fuel Entry</a>
            </div>
          </div>
        </form>
      </header>
      <section class="m-2">
        <div class="row mb-3">
          <div class="col-lg-12">
            <div class="bg-white p-3 text-dark">
              <div class="form-group row pt-1">
                <div class="col-lg-12">
                  <div
                    class="
                      table-responsive
                      hover
                      table table-bordered table-striped
                    "
                  >
                  <p-table #dt [value]="fuelList" [resizableColumns]="true" columnResizeMode="expand" scrollDirection="both" [columns]="selectedColumns" [loading]="!loaded" styleClass="p-datatable-sm p-datatable-gridlines p-datatable-striped" [scrollable]="true" [loading]="!loaded"
                                        scrollHeight="100%">
                                        <!-- Caption template of data table -->
                                        <ng-template pTemplate="caption">

                                            <div class="p-d-flex d-flex justify-content-between align-items-center">
                                                <div>
                                                    <h3 class="m-0"> Drivers </h3>
                                                </div>


                                                <div class="text-right">
                                                    <button type="button" pButton (click)="refreshData()" pTooltip="Refresh" class="p-button-outlined mr-2" icon="fas fa-sync"></button>
                                                    <button type="button" pButton pTooltip="Add" routerLink="/fleet/drivers/add" class="p-button-outlined mr-2" icon="pi pi-plus"></button>
                                                    <button pButton pRipple pTooltip="Clear Filter" class="p-button-outlined mr-2" icon="pi pi-filter-slash" (click)="clear(dt)"></button>

                                                    <button type="button" pButton pRipple class="p-button-outlined mr-2" icon="fas fa-regular fa-file-excel" (click)="dt.exportCSV()" pTooltip="Excel"></button>

                                                    <p-multiSelect [options]="dataColumns" [(ngModel)]="selectedColumns" optionLabel="header" selectedItemsLabel="{0} columns selected" [style]="{minWidth: '200px'}" placeholder="Choose Columns">
                                                    </p-multiSelect>
                                                </div>
                                            </div>
                                        </ng-template>
                                        <!-- Header template of DataTable -->
                                        <ng-template pTemplate="header" let-columns>
                                            <tr>

                                                <th *ngFor="let dataColumns of columns" [pSortableColumn]="dataColumns.field" pResizableColumn style="width:10%">

                                                    <div [ngSwitch]="dataColumns.field">
                                                        <!-- Driver Status Filter Customization -->
                                                        <span *ngSwitchCase="'driverStatus'">
                                                            <div class="flex justify-content-center align-items-center"
                                                                alignFrozen="left" pFrozenColumn [frozen]="true">
                                                                {{dataColumns.header}}
                                                                <p-sortIcon [field]="dataColumns.field"></p-sortIcon>
                                        <p-columnFilter [type]="dataColumns.type" [field]="dataColumns.field" [showOperator]="false" matchMode="contains" [showMatchModes]="false" [showAddButton]="false" display="menu">                                                          
                                        <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                            <p-multiSelect [options]="[ { name:'Active', value:'active'}, {name: 'InActive', value:'inActive'}]" placeholder="Any" (onChange)="filter($event.value)" optionLabel="name" optionValue="value">
                                                <ng-template let-option pTemplate="item">
                                                    <div>
                                                        <span class="ml-1">{{option.name }}</span>
                                                    </div>
                                        </ng-template>
                                        </p-multiSelect>
                                        </ng-template>


                                        </p-columnFilter>
                                </div>
                                </span>



                                <span *ngSwitchDefault>
                                                            <div class="flex justify-content-center align-items-center"
                                                                alignFrozen="right" pFrozenColumn [frozen]="true">
                                                                {{dataColumns.header}}
                                                                <p-sortIcon [field]="dataColumns.field"></p-sortIcon>
                                                                <p-columnFilter [type]="dataColumns.type" [field]="dataColumns.field" matchMode="contains" [showMatchModes]="false" 
                                                                    [showOperator]="false" [showAddButton]="false" 
                                                                    display="menu"></p-columnFilter>
                                                            </div>
                                                        </span>
                            </div>




                            </th>
                            <th style="width:100px" alignFrozen="right" pFrozenColumn [frozen]="true">Actions</th>

                            </tr>

                            </ng-template>

                            <!-- Body Template of Data Table -->
                            <ng-template pTemplate="body" let-driver let-columns="columns" let-rowIndex="rowIndex">

                                <tr>

                                    <td *ngFor="let dataColumns of columns" style="width:10%;cursor: pointer;" routerLink="/fleet/drivers/detail/{{driver.driverID}}">
                                        <div [ngSwitch]="dataColumns.field">
                                            <span *ngSwitchCase="'firstName'">
                                                         <b>   {{get(driver,dataColumns.field) | titlecase}}</b>
                                                        </span>
                                            <span *ngSwitchCase="'lastName'">
                                                            {{get(driver,dataColumns.field) | titlecase}}
                                                        </span>
                                            <span *ngSwitchCase="'driverType'">
                                                            {{driver[dataColumns.field] | titlecase}}
                                                        </span>
                                            <span *ngSwitchCase="'driverStatus'">
                                                            {{driver[dataColumns.field] | titlecase}}
                                                        </span>
                                            <span *ngSwitchCase="'companyName'">
                                                            {{driver[dataColumns.field] | uppercase}}
                                                        </span>

                                            <span *ngSwitchDefault> {{get(driver,dataColumns.field)}}</span>
                                        </div>

                                    </td>
                                    <td style=" text-align: center; width: 100px;" pFrozenColumn alignFrozen="right" [frozen]="true">

                                        <button id="btnEdit" pButton routerLink="/fleet/drivers/edit/{{driver.driverID}}" type="button" icon="fas fa-user-pen" class="p-button-rounded p-button-text"></button>
                                        <button id="btnDelete" (click)="deactivateDriver(driver)" pButton type="button" icon="fas fa-user-slash" class="p-button-rounded p-button-danger p-button-text"></button>
                                    </td>
                                </tr>
                            </ng-template>
                            <!-- Empty Template -->

                            <ng-template pTemplate="emptymessage" let-columns>
                                <div class="col-lg-12 mt-3 text-center">
                                    {{dataMessage}}
                                    <br /><br>
                                </div>
                            </ng-template>
                            <!-- Summary Section with Load More button -->

                            <ng-template pTemplate="summary" let-columns>
                                <div class="col-lg-12 mt-3 text-center " *ngIf="lastEvaluatedKey !=='end' && drivers.length !==0 ">
                                    <button type="button " (click)="onScroll($event) " class="btn btn-success btn-sm text-light ">Load
                                                    More..</button>

                                    <br /><br>
                                </div>
                                <div class="col-lg-12 mt-3 text-center" *ngIf="lastEvaluatedKey ==='end'">Total Records: {{drivers.length}}</div>
                            </ng-template>


                            </p-table>
                    <ngx-datatable
                      #myTable
                      class="bootstrap expandable fixedTable"
                      [rows]="fuelList"
                      [rowHeight]="rowHeight"
                      [scrollbarV]="true"
                      [messages]="{ emptyMessage: dataMessage }"
                      (scroll)="onScroll($event.offsetY)"
                      [selectionType]="SelectionType.single"
                      (select)="onFuelSelect($event)"
                    >
                      <ngx-datatable-column
                        name="Date Time"
                        [width]="300"
                        prop="dateTime"
                      >
                      </ngx-datatable-column>
                      <ngx-datatable-column
                        name=" Fuel Card#"
                        [width]="200"
                        prop="data.cardNo"
                      >
                      </ngx-datatable-column>
                      <ngx-datatable-column
                        name="Unit#"
                        [width]="200"
                        prop="unitID"
                      >
                        <ng-template
                          ngx-datatable-cell-template
                          let-rowIndex="rowIndex"
                          let-value="value"
                          let-row="row"
                        >
                          <span *ngIf="vehicleList[value]">{{
                            vehicleList[value]
                          }}</span>
                          <span *ngIf="assetList[value]">{{
                            assetList[value]
                          }}</span>
                          <span *ngIf="!assetList[value] && !vehicleList[value]"
                            >-</span
                          >
                        </ng-template>
                      </ngx-datatable-column>
                      <ngx-datatable-column name="Use Type" [width]=200 prop="data.useType">
                      </ngx-datatable-column>
                      <ngx-datatable-column name="Fuel Type" [width]=200 prop="data.type">
                      </ngx-datatable-column>
                      <ngx-datatable-column
                        name="Fuel Amount"
                        [width]="200"
                        prop="data.amt"
                      >
                      </ngx-datatable-column>
                      <ngx-datatable-column name="Fuel Units" [width]=200 prop="data.qty">
                      </ngx-datatable-column>
                      <ngx-datatable-column name="Site" prop="data.site" [width]=200>
                      </ngx-datatable-column>
                      <ngx-datatable-column
                        name="Province"
                        prop="data"
                        [width]="300"
                        [sortable]="false"
                      >
                        <ng-template
                          ngx-datatable-cell-template
                          let-rowIndex="rowIndex"
                          let-value="value"
                          let-row="row"
                        >
                          {{ value.city }}, {{ value.state }}, {{ value.country }}
                        </ng-template>
                      </ngx-datatable-column>
                      <!-- <ngx-datatable-column name="Actions" prop="data" [sortable]=false>
                      <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value"
                          let-row="row">
                      <div class="btn-group flex-wrap">
                        <button type="button" class="mb-1 mt-1 mr-1 btn"
                          
                          data-toggle="dropdown"><i class="fas
                            fa-ellipsis-v"></i></button>
                        <div class="dropdown-menu" role="menu">
                          <a
                            routerLink="/fleet/fuel/edit/{{value.fuelID
                            }}"
                            class="dropdown-item text-1">Edit</a>
                          <button type="button" class="dropdown-item
                            text-1"
                            (click)="deleteFuelEntry(value)">Delete</button>
                        </div>
                      </div>
                      </ng-template>
                    </ngx-datatable-column> -->
                    </ngx-datatable>
                  </div>

                  <!-- <div class="row mt-3 dtPaginate" *ngIf="fuelList.length> 0">
                    <div class="col-6">
                      Showing {{ fuelStartPoint }} to {{ fuelEndPoint }} of {{
                      totalRecords }} enteries
                    </div>
                    <div class="col-6 text-right">
                      <button type="button" class="btn btn-default mr-2"
                        (click)="prevResults()"
                        [disabled]="fuelPrev">Prev</button>
                      <button type="button" class="btn btn-default"
                        (click)="nextResults()"
                        [disabled]="fuelNext">Next</button>
                    </div>
                  </div> -->
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- <div class="col-lg-12 mt-3 text-center" *ngIf="lastEvaluatedKey !== 'end' && fuelList.length !== 0">
          <button type="button" class="btn btn-success btn-sm text-light" (click)=" initDataTable()">Load
            More..</button>
        </div> -->
      </section>
    </section>
  </div>
</section>

<div class="modal fade" id="bvdModal" tabindex="-1" role="dialog" area-labelledby="bvdModal" aria-hidden="true"
  data-keyboard="false" data-backdrop="static">
  <div class="modal-dialog modal-dialog-centered" role="document" style="width: 600px;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">BVD Report Upload</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <i class="far fa-window-close modal-dismiss" style="font-size:25px;"> </i>
        </button>
      </div>
      <div class="modal-body text-dark">
          <div class="col-log-10" style="margin-left:10px">
           <span style="font-size: 20px;">Please upload the BVD report in CSV fromat.</span>
          </div>
        <div class="row">
          <div class="col-lg-12">
            <div class="form-group col-lg-12 mb-3">
              <label class="control-label font-weight-bold labelmt text-3 text-dark">Choose File
                <span class="mandfield text-2 ml-1"><sup>*</sup></span>
              </label>
              <input (change)="selectDoc($event)" name="" id="uploadedDocs" type="file"
                class="form-control-file">
              <span style="font-size: 12px;">
                *Only .csv is accepted. The maximum
                file size can be 15MB.</span>
              <!-- <div *ngIf="newDoc" class="border my-2 p-2">
                <h4 class="mt-0">Uploaded Document</h4>
                <a href="{{newDoc}}" target="_blank">Document</a>
              </div>
            </div> -->

            <div *ngIf="error.hasError">
              </div>
              <span class="text-danger">{{error.message}}</span>

            </div>
            <div style="text-align: right;" >
            <button *ngIf="!reviewing" class="btn btn-primary" (click)="postDocument()">Submit</button>
            <button *ngIf="reviewing" class="btn btn-dark" type="button" disabled>
              <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Reviewing...
            </button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="petroModal" tabindex="-1" role="dialog" area-labelledby="petroModal" aria-hidden="true"
  data-keyboard="false" data-backdrop="static">
  <div class="modal-dialog modal-dialog-centered" role="document" style="width: 600px;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Petro Canada Report Upload</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <i class="far fa-window-close modal-dismiss" style="font-size:25px;"> </i>
        </button>
      </div>
      <div class="modal-body text-dark">
          <div class="col-log-10" style="margin-left:10px">
           <span style="font-size: 20px;">Please upload the Petro report in CSV fromat.</span>
          </div>
        <div class="row">
          <div class="col-lg-12">
            <div class="form-group col-lg-12 mb-3">
              <label class="control-label font-weight-bold labelmt text-3 text-dark">Choose File
                <span class="mandfield text-2 ml-1"><sup>*</sup></span>
              </label>
              <input (change)="selectDoc($event)" name="" id="petroDocs" type="file"
                class="form-control-file">
              <span style="font-size: 12px;">
                *Only .csv is accepted. The maximum
                file size can be 15MB.</span>
              <!-- <div *ngIf="newDoc" class="border my-2 p-2">
                <h4 class="mt-0">Uploaded Document</h4>
                <a href="{{newDoc}}" target="_blank">Document</a>
              </div>
            </div> -->

            <div *ngIf="error.hasError">
              </div>
              <span class="text-danger">{{error.message}}</span>

            </div>
            <div style="text-align: right;" >
            <button *ngIf="!reviewing" class="btn btn-primary" (click)="postPetroDoc()">Submit</button>
            <button *ngIf="reviewing" class="btn btn-dark" type="button" disabled>
              <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Reviewing...
            </button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
