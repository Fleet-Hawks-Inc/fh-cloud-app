<section class="body">
  <div class="inner-wrapper">
    <section role="main" class="content-body pr-0 pl-0 pt-0">
      <header class="page-header pr8 pl11">
        <div class="row" style="padding-top: 10px">
          <div class="col-md-4 col-lg-4 font-weight-bold text-4 text-dark">
            Add Incident
          </div>
          <div class="col-md-8 col-lg-8 text-right">
            <a
              href="javascript:;"
              routerLink="/safety/incidents"
              class="btn btn-default btn-sm"
              ><i class="fas fa-list"></i> Incident List</a
            >
          </div>
        </div>
      </header>

      <section class="m-2">
        <form
          class="form-horizontal form-bordered text-dark"
          #eventForm="ngForm"
        >
          <div class="row mb-3">
            <div class="col-lg-12">
              <div class="bg-white p-3 text-dark">
                <div class="form-group row adddriverpl pt-3">
                  <div class="col-lg-6">
                    <div class="row">
                      <div class="col-lg-5">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Event Date
                          <span class="mandfield text-2 ml-1"
                            ><sup>*</sup></span
                          ></label
                        >
                        <input
                          readonly
                          [(ngModel)]="event.eventDate"
                          name="eventDate"
                          type="text"
                          [maxDate]="birthDateMaxLimit"
                          [minDate]="birthDateMinLimit"
                          placeholder="yyyy/mm/dd"
                          #date="ngModel"
                          (click)="d.toggle()"
                          ngbDatepicker
                          #d="ngbDatepicker"
                          class="form-control"
                          required
                        />
                        <div
                          *ngIf="date.invalid && (date.dirty || date.touched)"
                          class="text-danger"
                        >
                          <div *ngIf="date.errors.required">
                            Event date is required.
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-5">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Event Time
                          <span class="mandfield text-2 ml-1"
                            ><sup>*</sup></span
                          ></label
                        >
                        <input
                          type="time"
                          class="form-control"
                          [(ngModel)]="event.eventTime"
                          name="eventTime"
                          #time="ngModel"
                          placeholder="Enter event time"
                          required
                        />
                        <div
                          *ngIf="time.invalid && (time.dirty || time.touched)"
                          class="text-danger"
                        >
                          <div *ngIf="time.errors.required">
                            Event time is required.
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-lg-5">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Driver Name
                          <span class="mandfield text-2 ml-1"
                            ><sup>*</sup></span
                          >
                        </label>
                        <ng-select
                          [(ngModel)]="event.driverID"
                          name="driverID"
                          #dName="ngModel"
                          required
                          placeholder="Select driver name"
                        >
                          <ng-option
                            class="text-capitalize"
                            *ngFor="let data of drivers"
                            value="{{ data.driverID }}"
                            >{{ data.firstName }} {{ data.lastName }}</ng-option
                          >
                        </ng-select>
                        <div
                          *ngIf="
                            dName.invalid && (dName.dirty || dName.touched)
                          "
                          class="text-danger"
                        >
                          <div *ngIf="dName.errors.required">
                            Driver is required.
                          </div>
                        </div>
                      </div>
                      <div class="col-lg-5">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Trip ID
                          <span class="mandfield text-2 ml-1"
                            ><sup>*</sup></span
                          ></label
                        >
                        <ng-select
                          [(ngModel)]="event.tripID"
                          name="tripID"
                          #trip="ngModel"
                          required
                          placeholder="Select trip"
                        >
                          <ng-option
                            class="text-capitalize"
                            *ngFor="let data of trips"
                            value="{{ data.tripID }}"
                            >{{ data.tripNo }}</ng-option
                          >
                        </ng-select>
                        <div
                          *ngIf="trip.invalid && (trip.dirty || trip.touched)"
                          class="text-danger"
                        >
                          <div *ngIf="trip.errors.required">
                            Trip is required.
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-lg-5">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Vehicle
                          <span class="mandfield text-2 ml-1"
                            ><sup>*</sup></span
                          >
                        </label>
                        <ng-select
                          [(ngModel)]="event.vehicleID"
                          name="vehicleID"
                          placeholder="Select vehicle"
                          #vehicle="ngModel"
                          required
                        >
                          <ng-option
                            class="text-capitalize"
                            *ngFor="let vehicle of vehicles"
                            value="{{ vehicle.vehicleID }}"
                            >{{ vehicle.vehicleIdentification }}
                          </ng-option>
                        </ng-select>
                        <div
                          *ngIf="
                            vehicle.invalid &&
                            (vehicle.dirty || vehicle.touched)
                          "
                          class="text-danger"
                        >
                          <div *ngIf="vehicle.errors.required">
                            Vehicle is required.
                          </div>
                        </div>
                      </div>

                      <div class="col-lg-5">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Assigned To
                          <span class="mandfield text-2 ml-1"
                            ><sup>*</sup></span
                          >
                        </label>
                        <ng-select
                          [(ngModel)]="event.assigned"
                          name="assigned"
                          placeholder="Select assigned to"
                          #assigned="ngModel"
                          required
                        >
                          <ng-option
                            class="text-capitalize"
                            *ngFor="let item of safetyManagers"
                            value="{{ item }}"
                            >{{ item }}
                          </ng-option>
                        </ng-select>
                        <div
                          *ngIf="
                            assigned.invalid &&
                            (assigned.dirty || assigned.touched)
                          "
                          class="text-danger"
                        >
                          <div *ngIf="assigned.errors.required">
                            Assigned is required.
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-lg-5">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Incident Type
                          <span class="mandfield text-2 ml-1"
                            ><sup>*</sup></span
                          >
                        </label>
                        <ng-select
                          [(ngModel)]="event.incidentType"
                          name="incidentType"
                          #incType="ngModel"
                          required
                          placeholder="Select incident type"
                        >
                          <ng-option
                            class="text-capitalize"
                            *ngFor="let data of incidentType"
                            value="{{ data.value }}"
                          >
                            {{ data.name }}</ng-option
                          >
                        </ng-select>
                        <div
                          *ngIf="
                            incType.invalid &&
                            (incType.dirty || incType.touched)
                          "
                          class="text-danger"
                        >
                          <div *ngIf="incType.errors.required">
                            Incident type is required.
                          </div>
                        </div>
                      </div>

                      <div class="col-lg-5">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Severity
                          <span class="mandfield text-2 ml-1"
                            ><sup>*</sup></span
                          >
                        </label>
                        <ng-select
                          [(ngModel)]="event.severity"
                          name="severity"
                          placeholder="Select severity"
                          #sever="ngModel"
                          required
                        >
                          <ng-option
                            class="text-capitalize"
                            *ngFor="let data of severity"
                            value="{{ data.value }}"
                            >{{ data.name }}</ng-option
                          >
                        </ng-select>
                        <div
                          *ngIf="
                            sever.invalid && (sever.dirty || sever.touched)
                          "
                          class="text-danger"
                        >
                          <div *ngIf="sever.errors.required">
                            Severity is required.
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-lg-10">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Location
                          <span class="mandfield text-2 ml-1"
                            ><sup>*</sup></span
                          ></label
                        >
                        <input
                          type="text"
                          class="form-control"
                          (keyup)="searchTerm.next($event)"
                          [(ngModel)]="event.location.label"
                          name="location"
                          placeholder="eg. 71 Ave NW, Calgary, AB T3B, Canada"
                          autocomplete="off"
                          #location="ngModel"
                          required
                        />

                        <div class="map-search__results" *ngIf="searchResults">
                          <ul class="p-0 m-0 text-left bg-white">
                            <li *ngFor="let item of searchResults">
                              <a
                                href="javascript:;"
                                (click)="assignLocation(item)"
                                title="{{ item.address }}"
                                >{{ item.address }}</a
                              >
                            </li>
                          </ul>
                        </div>
                        <div
                          *ngIf="
                            location.invalid &&
                            (location.dirty || location.touched)
                          "
                          class="text-danger"
                        >
                          <div *ngIf="location.errors.required">
                            Location is required.
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-lg-6">
                    <div class="row">
                      <div class="col-lg-10">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Attach Document(s)
                          <!-- <span class="mandfield text-2 ml-1"><sup>*</sup></span> -->
                        </label>
                        <input
                          type="file"
                          class="form-control p-0 border-0"
                          multiple
                          name="upload-doc"
                          (change)="selectDocuments($event, 'uploadedDocs')"
                        />
                        <span *ngIf="docSizeError != ''" class="text-danger">
                          {{ docSizeError }}
                        </span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-lg-5">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Attach Photo(s)
                          <!-- <span class="mandfield text-2 ml-1"><sup>*</sup></span> -->
                        </label>
                        <input
                          type="file"
                          class="form-control border-0 p-0"
                          multiple
                          name="add_vid"
                          (change)="selectDocuments($event, 'uploadedPhotos')"
                        />
                        <span *ngIf="photoSizeError != ''" class="text-danger">
                          {{ photoSizeError }}
                        </span>
                      </div>

                      <div class="col-lg-5">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Attach Video(s)
                          <!-- <span class="mandfield text-2 ml-1"><sup>*</sup></span> -->
                        </label>
                        <input
                          type="file"
                          class="form-control border-0 p-0"
                          multiple
                          name="add_vid"
                          (change)="selectDocuments($event, 'uploadedVideos')"
                        />
                        <span *ngIf="videoSizeError != ''" class="text-danger">
                          {{ videoSizeError }}
                        </span>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-lg-10">
                        <label
                          class="control-label font-weight-bold text-lg-right pt-2"
                          >Safety Manager Internal Notes
                          <!-- <span class="mandfield text-2 ml-1"><sup>*</sup></span> -->
                        </label>
                        <textarea
                          class="form-control h-auto"
                          #notes="ngModel"
                          required
                          rows="3"
                          placeholder="Enter notes for the Safety Manager"
                          name="notes"
                          [(ngModel)]="event.notes"
                        ></textarea>
                        <div
                          *ngIf="event.notes?.length > 500"
                          class="text-danger"
                        >
                          Only 500 characters are allowed.
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-11 text-right">
                    <button
                      type="button"
                      class="btn btn-default mt-4 mr-3"
                      routerLink="/safety/incidents"
                    >
                      Cancel
                    </button>
                    <button
                      [disabled]="disableButton || disabledButton()"
                      (click)="addEvent()"
                      class="btn btn-success mt-4 modal-confirm"
                    >
                      Save
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </section>
    </section>
  </div>
</section>
