<section class="body">
  <form class="form-horizontal" method="get">
    <div class="inner-wrapper">
      <section role="main" class="content-body pr-0 pt-0 pl-0">
        <header class="page-header pr19 pl7">
          <div class="row" style="padding-top: 10px">
            <div class="col-md-2 col-lg-2 pr-1">
              <input type="text" class="form-control" [(ngModel)]="searchValue" name="searchValue"
                (input)="getSuggestions($event.target.value)" autocomplete="off" placeholder="Search User">
              <div *ngIf="suggestedUsers?.length > 0" class="result-suggestions">
                <ul>
                  <li *ngFor="let data of suggestedUsers" style="cursor: pointer;" (click)="setUser(data)">
                    {{ data.firstName }} {{ data.lastName }}</li>
                </ul>
              </div>
            </div>
            <div class="col-md-2 col-lg-2">
              <button type="submit" (click)="searchFilter()" class="btn btn-sm btn-success mr-2">
                Search
              </button>
              <button type="button" (click)="resetFilter()" class="btn btn-sm btn-success">
                Reset
              </button>
            </div>
            <div class="col-md-8 col-lg-8 text-right pr-1">
              <a [routerLink]="['/manage', 'users', 'add']" class="btn btn-success btn-sm ml-2" style="color: white"><i
                  class="fas fa-plus"></i> Add User</a>
            </div>
          </div>
        </header>

        <section class="m-2">
          <div class="row mb-3">
            <div class="col-lg-12">
              <div class="bg-white p-3 text-dark">
                <div class="form-group row">
                  <div class="col-12">
                    <div infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollUpDistance]="1"
                      [infiniteScrollThrottle]="5" (scrolled)="onScroll()">
                      <table class="
                      row-border
                      hover
                      table table-bordered table-striped
                      mb-0
                    ">
                        <thead>
                          <tr>
                            <th>Employee ID</th>
                            <th>Name</th>
                            <th>Username</th>
                            <th>Department</th>
                            <th>User Roles</th>
                            <th>Phone</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngIf="users.length == 0" class="text-center">
                            <td colspan="9">{{ dataMessage }}</td>
                          </tr>
                          <tr *ngFor="let user of users" class="cursorpoint">
                            <td routerLink="/manage/users/detail/{{ user.contactID }}">
                              {{ user.employeeID }}
                            </td>
                            <td class="text-capitalize" routerLink="/manage/users/detail/{{ user.contactID }}">
                              {{ user.firstName }}&nbsp; {{ user.lastName }}
                            </td>
                            <td routerLink="/manage/users/detail/{{ user.contactID }}">
                              {{
                              user.userLoginData.userName
                              ? user.userLoginData.userName
                              : "-"
                              }}
                            </td>
                            <td routerLink="/manage/users/detail/{{ user.contactID }}">
                              {{
                              user.userAccount.department
                              ? user.userAccount.department
                              : "-"
                              }}
                            </td>
                            <td class="text-capitalize" routerLink="/manage/users/detail/{{ user.contactID }}">
                              <span *ngIf="user.userLoginData.userRoles">

                                <span *ngFor="let role of user.userLoginData.userRoles; let i=index">
                                  {{userRoles[role]}}<span
                                    *ngIf="user.userLoginData.userRoles.length>1 && i!=user.userLoginData.userRoles.length-1">,</span>
                                </span>
                              </span>
                              <span *ngIf="!user.userLoginData">
                                -
                              </span>
                            </td>
                            <td routerLink="/manage/users/detail/{{ user.contactID }}">
                              {{ user.workPhone ? user.workPhone : "-" }}
                            </td>
                            <td routerLink="/manage/users/detail/{{ user.contactID }}">
                              {{ user.workEmail ? user.workEmail : "-" }}
                            </td>
                            <td routerLink="/manage/users/detail/{{user.userName}}">{{user.currentStatus}}</td>
                            <td>
                              <div class="btn-group flex-wrap">
                                <button type="button" class="mb-1 mt-1 mr-1 btn" data-toggle="dropdown">
                                  <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="dropdown-menu" role="menu">
                                  <a href="javascript:;" data-toggle="modal" data-target="#assignrole"
                                    (click)="fetchRole(user)" class="dropdown-item"> Assign Roles</a>
                                  <a class="dropdown-item text-1" routerLink="/manage/users/edit/{{
                                  user.contactID
                                }}">Edit</a>
                                  <button class="dropdown-item text-1 modal-with-form" (click)="
                                  deleteUser(
                                    user.contactID
                                  )">
                                    Delete
                                  </button>
                                </div>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <div class="row mt-3 dtPaginate">
                        <div class="col-lg-12 mt-3 text-center" *ngIf="lastItemSK !== 'end' && users.length !== 0">
                          <button type="button" (click)="onScroll()" class="btn btn-success btn-sm text-light">Load
                            More..</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </section>
    </div>
  </form>
</section>

<div class="modal fade" id="assignrole" tabindex="-1" role="dialog" area-labelledby="assignrole" aria-hidden="true"
  data-keyboard="false" data-backdrop="static">
  <div class="modal-dialog modal-dialog-centered" role="document" style="width: 600px;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="assignrole">Assign Roles</h5>
      </div>
      <div class="modal-body ">
        <div class="row">
          <div class="col-lg-12">
            <form>
              <div class="form-row">
                <div class="col-lg-12">
                  <label class="
                  control-label
                  font-weight-semibold
                  labelmt
                  text-3 text-dark
                ">User Name/Email*</label>
                  <input type="text" class="form-control" [value]="setUsrName" disabled />
                </div>
              </div>
              <div class="form-row">
                <div class="col-lg-12">
                  <label class="
                  control-label
                  font-weight-semibold
                  labelmt
                  text-3 text-dark
                ">Role</label>
                  <ng-select [multiple]="true" class="form-control populate" [(ngModel)]="setRoles" name="roles"
                    placeholder="Select User Roles">
                    <ng-option *ngFor="let role of roles" [value]="role.role">{{ role.name }}</ng-option>
                  </ng-select>
                </div>
              </div>

              <div class="form-row">
                <div class="col-lg-12">
                  <label class="
                  control-label
                  font-weight-semibold
                  labelmt
                  text-3 text-dark
                ">Sub Role</label>
                  <ng-select [multiple]="true" class="form-control populate" [(ngModel)]="subRole" name="subRole"
                    placeholder="Select Sub Roles">
                    <ng-option *ngFor="let role of allSubRoles" [value]="role.role">{{ role.name }}</ng-option>
                  </ng-select>
                </div>
              </div>

              <div style="text-align: right;">
                <button class="btn btn-default modal-dismiss" (click)="cancel()">
                  Cancel
                </button>
                <button class="btn btn-success modal-confirm" (click)="assignRole()">
                  Assign Role
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>