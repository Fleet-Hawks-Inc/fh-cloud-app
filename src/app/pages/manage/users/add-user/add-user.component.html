
<section class="body">
	<div class="inner-wrapper">		
		<section role="main" class="content-body pl-0 pr-0 pt-0">
			<header class="page-header pr-5">
				<div class="row pr-1 mr-1" style="padding-top:10px;">
					<div class="col-md-4 col-lg-4">
						<h4 class="text-4 font-weight-bold mt-0 mb-0 text-dark">{{pageTitle}}</h4>
					</div>
					<div class="col-md-8 col-lg-8 text-right pr-1"> <a routerLink="/manage/users/list"
							class="btn btn-default btn-sm"><i class="fas fa-list"></i> Users List</a> </div>
				</div>
			</header>
			<div class="row text-dark">
				<div class="col pr-0">
                    <form id="userForm" class="form-horizontal form-bordered bg-white" #userForm="ngForm" (ngSubmit)="onSubmit(userForm)">
                        <div class="p-2">
                            <ul class="nav nav-tabs top-tabs" id="top-tabs" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link" [ngClass]="{'active': currentTab == 1}" (click)="tabChange(1)" [routerLink]="">Basic Details</a>
                                 </li>
                                <li class="nav-item">
                                    <a class="nav-link" [ngClass]="{'active': currentTab == 2}" (click)="tabChange(2)" [routerLink]="">Address Details</a>
                                 </li>
                                <li class="nav-item">
                                    <a class="nav-link" [ngClass]="{'active': currentTab == 3}" (click)="tabChange(3)" [routerLink]="">Account Details</a>
                                 </li>                                   
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content" id="myTabContent" style="box-shadow:none;border:none;">
                                <div class="tab-pane show active" [ngClass]="{'active show': currentTab == 1}" id="addUserBasic" role="tabpanel" aria-labelledby="addUserBasic-tab">
                                    <div class="form-group row">
                                        <div class="col-lg-10">
                                            <label class="control-label font-weight-bold text-lg-right text-5 pt-2">Basic Details</label>
                                        </div>
                                        <div class="col-lg-5 offset-lg-1">
                                            <div class="row">
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">First Name</label>
                                                    <input type="text" class="form-control" [(ngModel)]="firstName" name="firstName"> </div>
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">Last Name</label>
                                                    <input type="text" class="form-control"  [(ngModel)]="lastName" name="lastName"> </div>
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">Employee ID</label>
                                                    <input type="text" class="form-control"  [(ngModel)]="employeeID" name="employeeID"> </div>
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">Date Of Birth</label>
                                                    <input type="date" class="form-control"  [(ngModel)]="dateOfBirth" name="dateOfBirth"> </div>
                                                <div class="col-lg-10">
                                                      <label class="control-label font-weight-bold text-lg-right pt-2">Status</label>
                                                      <ng-select [(ngModel)]="currentStatus" name="currentStatus"
                                                      placeholder="Select user status"> 
                                                      <ng-option value="ACTIVE">Active</ng-option>
                                                      <ng-option value="INACTIVE">Inactive</ng-option>
                                                   </ng-select>
                                                </div>
                                                
                                            </div>
                                        </div>
                                        <div class="col-lg-5">
                                          <div class="row">
                                             <div class="col-lg-10  text-center">
                                                <div id="male_photo" class="business_image_style position-relative mx-auto"
                                                   style="display: block;">
                                                   <img [src]="userProfileSrc" id="male_photo" class="w-100 h-100"
                                                      style="object-fit: cover;">
                                                      <span class="text-danger profile-cross" 
                                                      (click)="removeProfile()" *ngIf="uploadedPhotos != '' || showIcons"
                                                      style="cursor: pointer;"
                                                      >
                                                      <i class="fa fa-times"></i>
                                                   </span>
                                                </div>
                                                <div class="mt-2">
                                                   <div class="btn btn-sm btn-success overflow-hidden position-relative"><i
                                                         class="fas fa-plus"></i> {{profileTitle}} Photo
                                                      <input (change)="selectPhoto($event)"
                                                         [(ngModel)]="userImage" name="userImage" type="file"
                                                         class="hidden_input1 w-100" />
                                                   </div>
                                                </div>
                                             </div>
                                              
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">Work Phone</label>
                                                    <input type="text" class="form-control"  [(ngModel)]="phone" name="phone"> </div>
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">Work Email</label>
                                                    <input type="text" class="form-control"  [(ngModel)]="email" name="email"> </div>
                                               
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- ADDRESS -->
                                <div class="tab-pane fade" [ngClass]="{'active show': currentTab == 2}" id="addUserAddress" role="tabpanel" aria-labelledby="addUserAddress-tab">
                                    <div class="row">
                                        <div class="col-lg-10">
                                           <label class="control-label font-weight-bold text-lg-right text-5 pt-2">Address
                                              Details</label>
                                        </div>
                                     </div>
                                     <div *ngFor="let item of addressDetails; let i = index;" class="address-item">
                                        <div class="form-group row">
                                           <div class="col-lg-5 offset-lg-1">
                                              <div class="row">
                                                 <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">Address Type&nbsp; <span class="text-1 optional-label-color">(optional)</span></label>
                                                    <ng-select [(ngModel)]="item.addressType" name="addressDetails[{{i}}].addressType"
                                                       placeholder="Select address type"> 
                                                       <!-- <ng-option value="Work">Work</ng-option> -->
                                                       <ng-option  value="Home">Home</ng-option>
                                                       <!-- <ng-option value="Office">Office</ng-option> -->
                                                    </ng-select>
                                                 </div>
                                              </div>
                                           </div>
                                           <div class="col-lg-4">
                                              <label class="control-label font-weight-bold text-lg-right pt-2">Start typing your
                                                 location&nbsp; <span
                                                    class="text-1 optional-label-color">(optional)</span></label>
                                              <input [(ngModel)]="item.userLocation" name="userLocation{{i}}"
                                                 (keyup)="searchTerm.next($event);" type="text" class="form-control"
                                                 placeholder="Type Address">
                                              <div class="checkbox-custom pt-2">
                                                 <input [(ngModel)]="item.manual" name="manual{{i}}"
                                                    (change)="manAddress($event, i)" type="checkbox">
                                                 <label for="man_address">Type Manually</label>
                                              </div>
                                              <div class="map-search__results bg-white">
                                                 <ul class="p-0 m-0 text-left">
                                                    <li *ngFor="let item of searchResults;">
                                                       <a href="javascript:;"
                                                          (click)="userAddress(i, item)">{{item.address.label}}</a>
                                                    </li>
                                                 </ul>
                                              </div>
                                           </div>
                                           <div class="col-lg-2 mar-top-37">
                                              <a class="btn btn-dark mr-2" href="javascript:;"
                                                 (click)="clearUserLocation(i);">Clear</a>
                                              <a *ngIf="i == 0;" (click)="addAddress();" class="btn btn-success" href="javascript:;"
                                                   ><i class="fa fa-plus fa-fw"></i></a>
                                              <a *ngIf="i != 0;" (click)="remove('address', i)" class="btn btn-success"
                                                 href="javascript:;"><i class="fa fa-minus fa-fw"></i></a>
                                           </div>
                                        </div>
                                        <div class="address-inner" *ngIf="item.manual">
                                           <div class="row mb-3 border-bottom pb-4">          
                                              <div class="col-lg-5 offset-lg-1 pt-3">
                                                 <div class="row">
                                                    <div class="col-lg-5">
                                                       <label class="control-label font-weight-bold text-lg-right pt-2">Select
                                                          Country</label>
                                                       <ng-select [(ngModel)]="item.countryID" name="countryID{{i}}"
                                                          data-plugin-selectTwo (change)="getStates($event, i)"
                                                          class="form-control populate" placeholder="Select country">          
                                                          <ng-option class="text-capitalize" *ngFor="let country of countries"
                                                             value="{{country.countryID}}">{{country.countryName}}</ng-option>          
                                                       </ng-select>
                                                    </div>
                                                    <div class="col-lg-5">
                                                       <label class="control-label font-weight-bold text-lg-right pt-2">Select
                                                          State</label>
                                                       <ng-select (change)="getCities($event, i)" [(ngModel)]="item.stateID"
                                                          name="stateID{{i}}" placeholder="Select state">          
                                                          <ng-option class="text-capitalize" *ngFor="let state of states"
                                                             value="{{state.stateID}}">{{state.stateName}}</ng-option>          
                                                       </ng-select>
                                                    </div>
                                                    <div class="col-lg-5">
                                                       <label class="control-label font-weight-bold text-lg-right pt-2">Select
                                                          City</label>
                                                       <ng-select (change)="getCityName(i, $event)" [(ngModel)]="item.cityID"
                                                          name="cityID{{i}}" placeholder="Select city">
          
                                                          <ng-option class="text-capitalize" *ngFor="let city of cities"
                                                             value="{{city.cityID}}">{{city.cityName}}</ng-option>
          
                                                       </ng-select>
                                                    </div>
                                                    <div class="col-lg-5">
                                                       <label class="control-label font-weight-bold text-lg-right pt-2">Zip
                                                          Code</label>
                                                       <input [(ngModel)]="item.zipCode" name="zipCode{{i}}" type="text"
                                                          class="form-control" placeholder="Enter zipode eg. 7V2 3R4">
                                                    </div>
                                                 </div>
                                              </div>
                                              <div class="col-lg-5 pt-4">
                                                 <div class="row">
                                                    <div class="col-lg-10">
                                                       <label class="control-label font-weight-bold text-lg-right">Address
                                                          1</label>
                                                       <input [(ngModel)]="item.address1" name="address1{{i}}" type="text"
                                                          class="form-control" placeholder="Enter street level address">
                                                    </div>
                                                    <div class="col-lg-10">
                                                       <label class="control-label font-weight-bold text-lg-right pt-2">Address
                                                          2&nbsp; <span
                                                             class="text-1 optional-label-color">(optional)</span></label>
                                                       <input [(ngModel)]="item.address2" name="address2{{i}}" type="text"
                                                          class="form-control" placeholder="Enter street level address">
                                                    </div>
                                                 </div>
                                              </div>
                                           </div>
                                        </div>          
                                     </div>
                                </div>
                                <!-- User Account -->
                                <div class="tab-pane fade" [ngClass]="{'active show': currentTab == 3}" id="addUserAccount" role="tabpanel" aria-labelledby="addUserAccount-tab">
                                    <div class="form-group row">
                                        <div class="col-lg-12">
                                            <label class="control-label font-weight-bold text-lg-right text-5 pt-2">Account Details</label>
                                        </div>
                                        <div class="col-lg-5 offset-lg-1">
                                            <div class="row">
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">Select Department</label>
                                                    <ng-select class="form-control populate"  [(ngModel)]="departmentName" name="departmentName">                                                       
                                                            <ng-option value="Fleet">Fleet</ng-option>
                                                            <ng-option value="Operations">Operations</ng-option>
                                                            <ng-option value="Safety">Safety</ng-option>
                                                            <ng-option value="Maintenance">Maintenance</ng-option>
                                                            <ng-option value="Dispatch">Dispatch</ng-option>
                                                            <ng-option value="Compliance">Compliance</ng-option>
                                                            <ng-option value="Road Assistance">Road Assistance</ng-option>
                                                            <ng-option value="Accounts">Accounts</ng-option>                                                  
                                                    </ng-select>
                                                </div>														
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold font-weight-bold text-lg-right pt-2">User Type</label>
                                                    <ng-select class="form-control populate"  [(ngModel)]="userType" name="userType">                                                                
                                                                    <ng-option value="Full Admin">Full Admin</ng-option>
                                                                    <ng-option value="Read Only Admin">Read Only Admin</ng-option>
                                                                    <ng-option value="Dispatch">Dispatch</ng-option>
                                                                    <ng-option value="Maintenance">Maintenance</ng-option>
                                                                    <ng-option value="Safety Manager">Safety Manager</ng-option>
                                                                    <ng-option value="Others">Others</ng-option>                                                               
                                                    </ng-select>															
                                                </div>
                                                <div class="col-lg-2 mar-top-37">
                                                        <!-- <a href="#addUserTypeModal" class="btn btn-sm btn-success modal-with-form"><i class="fas fa-plus"></i></a> -->
                                                          </div>
                                            
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">Group&nbsp; <span
                                                        class="text-1 optional-label-color">(optional)</span></label>
                                                      <ng-select  [(ngModel)]="groupID" name="groupID" style="width: 100%;" placeholder="Select group for the vehicle">                                    
                                                      <optgroup label="Select Group">
                                                         <ng-option *ngFor="let group of groups" value="{{group.groupID}}">
                                                            {{group.groupName}}</ng-option>
                                                      <optgroup>
                                                   </ng-select>
                                                
                                                </div>
                                                <div class="col-lg-2 mar-top-37">
                                                    <button type="button" data-toggle="modal" data-target="#addGroupModal"
                                                    class="modal-with-form btn btn-sm btn-success text-light"><i
                                                       class="fas fa-plus"></i></button>
                                                       </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-5"> 
                                        <div class="row">
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">User Name</label>
                                                    <input type="text" class="form-control" [(ngModel)]="userName" name="userName" [disabled]="disableInput">
                                                 </div>
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">Password</label>
                                                    <input type="text" class="form-control" [(ngModel)]="userPassword" name="userPassword" [disabled]="disableInput">
                                                 </div>
                                                <div class="col-lg-10">
                                                    <label class="control-label font-weight-bold text-lg-right pt-2">Confirm Password</label>
                                                    <input type="text" class="form-control" [(ngModel)]="confirmUserPassword" name="confirmUserPassword" [disabled]="disableInput">
                                                 </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                        <div class="form-group row mt-3">
                            <div class="col-lg-12 text-right pb-4 pr-5">
                                <a type="button" (click)="cancel()" class="btn btn-default btnPrevious mr-2">Cancel</a>
                                <button type="button" *ngIf="currentTab > 1" (click)="prevStep()"
                                   class="btn btn-default btnPrevious mr-2">Prev</button>
                                <a href="javascript:;" (click)="nextStep()" *ngIf="currentTab != 3"
                                   class="btn btn-success btnNext">Next</a>
                                <button type="submit" *ngIf="currentTab == 3 && !userID"
                                   class="btn btn-success">Submit</button>
                                <a href="javascript:;" *ngIf="currentTab == 3 && userID" (click)="updateUser()"
                                   class="btn btn-success">Update</a>        
                             </div>
                        </div>
                    </form>
                </div>
			</div>
		</section>
	</div>
</section>

<div class="modal fade" id="addGroupModal" tabindex="-1" role="dialog" aria-labelledby="addGroupModal"
	aria-hidden="true">
	<div class="modal-dialog" style="max-width: 600px;" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add Users Group</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<i class="far fa-window-close modal-dismiss" style="font-size:25px;"> </i>
				</button>
			</div>
			<div class="modal-body text-dark">
				<div class="card-body p-0">
					<form id="groupForm" class="form-horizontal form-bordered bg-white" method="get" name="form">
						<div class="form-row">
							<div class="form-group col-lg-12 mb-0">
								<label class="control-label font-weight-bold">Users Group Name</label>
								<input [(ngModel)]="groupData.groupName" name="groupName" type="text" placeholder="Enter group name"
									class="form-control">
							</div>
							<div class="form-group col-lg-12">
								<label class="control-label font-weight-bold">Group Members (Users)&nbsp;<span
									class="text-1 optional-label-color">(optional)</span></label>
								<ng-select [multiple]=true [(ngModel)]="groupData.groupMembers" name="groupMembers" placeholder="Select group members"
									style="width: 100%;">
									<ng-option *ngFor="let user of users;" value={{user.userName}}>
										{{user.userName}}</ng-option>
								</ng-select>
							</div>
						</div>
						<div class="form-row">
							<div class="form-group col-lg-12">
								<div class="row">
									<div class="col-lg-12">
										<label
											class="control-label font-weight-bold text-lg-right pt-2">Descriptio&nbsp; <span
											class="text-1 optional-label-color">(optional)</span></label>
										<textarea [(ngModel)]="groupData.description" name="description"
											class="form-control" rows="4" id="comment" placeholder="Enter group description"></textarea>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
			<div class="modal-footer text-right">
				<button type="button" class="btn btn-success" (click)="addGroup()">Save</button>
				<button type="button" class="btn btn-default modal-dismiss" (click)="cancelModel()">Cancel</button>
			</div>
		</div>
	</div>
</div>

