<section class="body">
  <div class="inner-wrapper">
    <section role="main" class="content-body pl-1 pr-0 pt-0">
      <header class="page-header pr27 pl18">
        <div class="row">
          <div class="col-md-4 col-lg-4 font-weight-bold text-4 text-dark">
            <h2 class="font-weight-bold pl-0">Import Drivers</h2>
          </div>

        </div>
      </header>
      <section class="m-2">
        <div class="row mb-3">
          <div class="col-lg-12">
            <div class="bg-white p-3 text-dark">
              <div class="form-group row pt-3">
                <div class="col-lg-12" style="height: calc(100vh - 149px); overflow-y: scroll;">
                  <p-table #dt class="text-capitalize" [value]="importDrivers">
                    <!-- Caption template of data table -->
                    <ng-template pTemplate="caption">

                      <div class="p-d-flex d-flex justify-content-between align-items-center">
                        <div>
                          <h3 class="m-0"> Import Drivers </h3>
                        </div>


                        <div class="text-right">
                          <button type="button" pButton (click)="refreshData()" pTooltip="Refresh"
                            class="p-button-outlined mr-2" icon="fas fa-sync"></button>
                          <button type="button" pButton pTooltip="Import Driver" (click)="openModal()"
                            class="p-button-outlined mr-2" icon="pi pi-plus"></button>
                          <button pButton pRipple pTooltip="Clear Filter" class="p-button-outlined mr-2"
                            icon="pi pi-filter-slash" (click)="clear(dt)"></button>

                          <button type="button" pButton pRipple class="p-button-outlined mr-2"
                            icon="fas fa-regular fa-file-excel" (click)="dt.exportCSV()" pTooltip="Excel"></button>
                        </div>
                      </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                      <tr>
                        <th pSortableColumn="docs[0].displayName">File Name <p-sortIcon field="docs[0].displayName">
                          </p-sortIcon>
                        </th>
                        <th pSortableColumn="timeCreated">Uploaded on <p-sortIcon field="timeCreated">
                          </p-sortIcon>
                        </th>
                        <th pSortableColumn="module">Module <p-sortIcon field="module">
                          </p-sortIcon>
                        </th>
                        <th pSortableColumn="status">Status <p-sortIcon field="status">
                          </p-sortIcon>
                        </th>


                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-driver>
                      <tr>
                        <td>{{driver.docs[0].displayName}}</td>
                        <td>{{driver.timeCreated | date : 'dd/MM/yyyy hh:mm:ss a '}}</td>
                        <td>{{driver.module}}</td>
                        <td><span class="badge badge-dark">{{driver.fileStatus}}</span></td>
                      </tr>
                    </ng-template>
                    <!-- Empty Template -->

                    <ng-template pTemplate="emptymessage" let-columns>
                      <div class="col-lg-12 mt-3 text-center">
                        {{dataMessage}}
                        <br /><br>
                      </div>
                    </ng-template>
                    <ng-template pTemplate="summary" let-columns>

                      <div class="col-lg-12 mt-3 text-center">Total Records: {{importDrivers.length}}</div>
                    </ng-template>
                  </p-table>


                </div>

              </div>
            </div>

          </div>
        </div>
      </section>
    </section>
  </div>
</section>



<ng-template #importModel let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="addDocumentModalLabel">Import Driver</h5>
    <button type="button" (click)="modal.dismiss('Cross click')" class="close" data-dismiss="modal" aria-label="Close">
      <i class="far fa-window-close modal-dismiss" style="font-size:25px;"></i>
    </button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col-lg-12">
        <span>To successfully import driver data please make sure your file confirms following:​</span>
        ​<ul style="margin:0px">
          <li> File must have all the headers. <a href='assets/driver_import_template.csv'>Click Here</a> to
            download the template file.</li>
          <li> File must be comma seperated.</li>
          <li> File must have all the predefined header with valid data.</li>
          <li> File must not contain more than 200 records. </li>
        </ul>
        <div class="form-group col-lg-12 mt-5 mb-3">
          <label class="control-label font-weight-bold label mb text-3 text-dark">Choose File
            <span class="mandfield text-2 ml-1"><sup>*</sup></span>
          </label>
          <input class="form-control choosefileLH" (change)="chooseFile($event)" (change)="validateCSV($event)"
            accept=".csv" id="importDocs" type="file">
          <div *ngIf="inValidMessages.length > 0">
            <br><span><b>Below are the errors in the uploaded file. Please rectify them and upload the file
                again.</b></span>
            <ul>
              <li *ngFor="let error of inValidMessages"><span class="text-danger">{{error}}.</span></li>
            </ul>
          </div>
        </div>

      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button (click)="modal.dismiss('Cross click')" class="btn btn-default modal-dismiss">Cancel</button>
    <button class="btn btn-success" [disabled]="submitDisabled" (click)="uploadImport()">Submit</button>
  </div>
</ng-template>