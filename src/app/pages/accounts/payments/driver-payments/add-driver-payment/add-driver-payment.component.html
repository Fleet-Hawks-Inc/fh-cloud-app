<section class="body">
    <div class="inner-wrapper">
        <section role="main" class="content-body pl-0 pr-0 pt-0">
            <header class="page-header">
                <h2>Payment</h2>
                <div class="right-wrapper text-right">
                    <div class="pull-right pr-2"> <a routerLink="/accounts/payments/driver-payments/list"
                            class="mb-1 mt-1 mr-1 mr-5 btn btn-default btn-sm"><i class="fas fa-list"></i> All
                            Payments</a> </div>
                </div>
            </header>
            <section class="card mt-0 mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col pr-0">
                            <div class="card-body text-dark">
                                <form class="form-horizontal form-bordered" method="get">
                                    <div class="row">
                                        <div class="col-lg-5 offset-lg-1">
                                            <div class="row" id="settlementListDiv">
                                                <div class="col-lg-10">
                                                    <label
                                                        class="control-label font-weight-bold font-bold text-lg-right pt-2">Pay
                                                        To </label>
                                                    <ng-select [(ngModel)]="paymentData.paymentTo" name="paymentTo"
                                                        placeholder="Select type">
                                                        <ng-option value="driver">Driver</ng-option>
                                                        <ng-option value="carrier">Carrier</ng-option>
                                                        <ng-option value="owner_operator">Owner Operator</ng-option>
                                                    </ng-select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-5">
                                            <div class="row" id="settlementListDiv">
                                                <div class="col-lg-5">
                                                    <label
                                                        class="control-label font-weight-bold font-bold text-lg-right pt-2">Payment#</label>
                                                    <input type="text" class="form-control" [(ngModel)]="paymentData.paymentNo" name="paymentNo" placeholder="Enter payment#">
                                                </div>
                                                <div class="col-lg-5">
                                                    <label
                                                        class="control-label font-weight-bold font-bold text-lg-right pt-2">Payment
                                                        Date
                                                    </label>
                                                    <input [(ngModel)]="paymentData.txnDate" name="txnDate" type="text"
                                                        placeholder="yyyy/mm/dd" (click)="txnDate.toggle()" ngbDatepicker
                                                        #txnDate="ngbDatepicker" class="form-control" autocomplete="off"
                                                        [minDate]="dateMinLimit" [maxDate]="futureDatesLimit">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row pt-2">
                                        <div class="col-lg-5 offset-lg-1">
                                            <div class="row" id="driverListDiv" *ngIf="paymentData.paymentTo === 'driver'">
                                                <div class="col-lg-10">
                                                    <label
                                                        class="control-label font-weight-bold font-bold text-lg-right pt-2">Select
                                                        Driver</label>
                                                    <ng-select [(ngModel)]="paymentData.entityId" name="type" placeholder="Select Driver">
                                                        <ng-option value="{{ data.key }}"
                                                            *ngFor="let data of drivers | keyvalue">{{ data.value }}
                                                        </ng-option>
                                                    </ng-select>
                                                </div>
                                            </div>
                                            <div class="row" id="carrierListDiv" *ngIf="paymentData.paymentTo === 'carrier'">
                                                <div class="col-lg-10">
                                                    <label
                                                        class="control-label font-weight-bold font-bold text-lg-right pt-2">Select
                                                        Carrier</label>
                                                    <ng-select [(ngModel)]="paymentData.entityId" name="type" placeholder="Select Carrier">
                                                        <ng-option value="{{ data.key }}"
                                                            *ngFor="let data of carriers | keyvalue">{{ data.value }}
                                                        </ng-option>
                                                    </ng-select>
                                                </div>
                                            </div>
                                            <div class="row" id="ownerOperatorListDiv" *ngIf="paymentData.paymentTo === 'owner_operator'">
                                                <div class="col-lg-10">
                                                    <label
                                                        class="control-label font-weight-bold font-bold text-lg-right pt-2">
                                                        Select Owner Operator</label>
                                                    <ng-select [(ngModel)]="paymentData.entityId" name="type" placeholder="Select Owner Operator">
                                                        <ng-option value="{{ data.key }}"
                                                            *ngFor="let data of ownerOperators | keyvalue">{{ data.value }}
                                                        </ng-option>
                                                    </ng-select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-2">
                                            <label class="control-label font-weight-bold pt-2">From Date</label>
                                            <input [(ngModel)]="paymentData.fromDate" name="fromDate" type="text"
                                                placeholder="yyyy/mm/dd" (click)="fromDate.toggle()" ngbDatepicker
                                                #fromDate="ngbDatepicker" class="form-control" autocomplete="off"
                                                [minDate]="dateMinLimit" [maxDate]="futureDatesLimit">
                                        </div>
                                        <div class="col-lg-2">
                                            <label class="control-label font-weight-bold pt-2">To Date</label>
                                            <input [(ngModel)]="paymentData.toDate" name="toDate" type="text"
                                                placeholder="yyyy/mm/dd" (click)="toDate.toggle()" ngbDatepicker
                                                #toDate="ngbDatepicker" class="form-control" autocomplete="off"
                                                [minDate]="dateMinLimit" [maxDate]="futureDatesLimit">
                                        </div>
                                        <div class="col-lg-2">
                                            <button class="btn btn-success mar-top-37" (click)="fetchSettlements()">Search</button>
                                        </div>
                                    </div>
                                    <!-- DRIVER PAYMENT DIV -->
                                    <div id="driverPaymentDiv" style="display: block;">
                                        <div class="row pt-3">
                                            <div class="col-lg-10 offset-lg-1">
                                                <table
                                                    class="table table-bordered table-responsive-lg  table-striped simple-table">
                                                    <thead>
                                                        <tr class="bgcol2">
                                                            <th></th>
                                                            <th class="text-2">Settlement#</th>
                                                            <th class="text-2">Settlement Date</th>
                                                            <th class="text-2">Settlement Type</th>
                                                            <th class="text-2">Trip#</th>
                                                            <th class="text-2">Settled Amount</th>
                                                            <th class="text-2">Paid Amount</th>
                                                            <th class="text-2">Status</th>
                                                            <th class="text-2">Full Payment</th>
                                                            <th class="text-2">Payment</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr *ngIf="settlements.length === 0" class="text-center">
                                                            <td colspan="10">{{ dataMessage }} </td>
                                                        </tr>
                                                        <tr *ngFor="let data of settlements; let i=index">
                                                            <td>
                                                                <input type="checkbox" name="stl{{i}}" [(ngModel)]="data.selected" (change)="selectedTrip()">
                                                            </td>
                                                            <td>{{ data.setNo }}</td>
                                                            <td>{{ data.txnDate | date:"yyyy/MM/dd" }}</td>
                                                            <td>{{ data.newtype }}: 
                                                                <span *ngIf="data.type === 'driver'">
                                                                    {{ drivers[data.entityId] }}
                                                                </span>
                                                                <span *ngIf="data.type === 'carrier'">
                                                                    {{ carriers[data.entityId] }}
                                                                </span>
                                                                <span *ngIf="data.type === 'owner_operator'">
                                                                    {{ ownerOperators[data.entityId] }}
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <span *ngFor="let trip of data.tripIds; let j=index;">
                                                                    {{ trips[trip] }}
                                                                    <span *ngIf="j < data.tripIds.length-1">,</span>
                                                                </span>
                                                            </td>
                                                            <td>{{ data.finalTotal }} CAD</td>
                                                            <td>-</td>
                                                            <td><span class="badge badge-dark p-1 text-uppercase">{{ data.status }}</span> </td>
                                                            <td class="text-center">
                                                                <input type="checkbox" [(ngModel)]="data.fullPayment" name="final{{i}}" (change)="assignFullPayment(i, data)">
                                                            </td>
                                                            <td>
                                                                <input type="text" class="form-control" [(ngModel)]="data.paidAmount" (input)="paymentCalculation()" name="paidAmount{{i}}">
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="row pt-2">
                                            <div class="col-lg-12">
                                                <h4>Settlement Information</h4>
                                            </div>
                                        </div>
                                        <div class="row pt-2">
                                            <div class="col-lg-5 offset-lg-1">
                                                <div class="row pt-1">
                                                    <div class="col-lg-5">
                                                        <label
                                                            class="control-label font-weight-bold  labelalign">Payment
                                                            Mode</label>
                                                        <ng-select [(ngModel)]="paymentData.payMode" name="payMode"
                                                            placeholder="Select Payment Mode" (change)="changePaymentMode($event)">
                                                            <ng-option value="cash">Cash</ng-option>
                                                            <ng-option value="cheque">Cheque</ng-option>
                                                            <ng-option value="eft">EFT</ng-option>
                                                            <ng-option value="credit_card">Credit Card</ng-option>
                                                            <ng-option value="debit_card">Debit Card</ng-option>
                                                            <ng-option value="demand_draft">Demand Draft</ng-option>
                                                        </ng-select>
                                                    </div>
                                                    <div class="col-lg-5">
                                                        <label class="control-label font-weight-bold">Select
                                                            Account</label>
                                                        <ng-select [(ngModel)]="paymentData.accountID" name="accountID" placeholder="Select Income Account" #accountNo="ngModel" required>
                                                            <ng-option value="{{ data.actID }}" *ngFor="let data of accounts | async">{{ data.actName }} - {{
                                                                data.actNo }}</ng-option>
                                                        </ng-select>
                                                    </div>
                                                </div>
                                                <div class="row pt-1" *ngIf="paymentData.payMode">
                                                    <div class="col-lg-5">
                                                        <label class="control-label font-weight-bold labelalign">{{ payModeLabel }} Number</label>
                                                        <input type="text" class="form-control" [(ngModel)]="paymentData.payModeNo" name="payModeNo" placeholder="{{ payModeLabel }} Number">
                                                    </div>
                                                    <div class="col-lg-5">
                                                        <label class="control-label font-weight-bold labelalign">{{ payModeLabel }} Date</label>
                                                        <input [(ngModel)]="paymentData.payModeDate" name="payModeDate" type="text"
                                                            placeholder="yyyy/mm/dd" (click)="payModeDate.toggle()" ngbDatepicker
                                                            #payModeDate="ngbDatepicker" class="form-control" autocomplete="off"
                                                            [minDate]="dateMinLimit" [maxDate]="futureDatesLimit">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-3 offset-lg-2">
                                                <div class="row">
                                                    <div class="col-lg-6 text-right">
                                                        <label class="control-label font-weight-bold">Settled
                                                            Amount</label>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <input type="text" class="form-control" [(ngModel)]="paymentData.totalAmount" name="totalAmount">
                                                    </div>
                                                    <div class="col-lg-6 offset-lg-6 pt-2" *ngIf="paymentData.paymentTo === 'driver'">
                                                        <a href="#payrollModal" class="btn btn-default modal-with-form btn-sm">Calculate
                                                            Payroll</a> 
                                                    </div>
                                                </div>
                                                <div class="row pt-1">
                                                    <div class="col-lg-6 text-right">
                                                        <label class="control-label font-weight-bold">Other
                                                            Charges</label>
                                                    </div>
                                                </div>
                                                <div class="row pt-1" *ngIf="paymentData.paymentTo === 'driver'">
                                                    <div class="col-lg-6 text-right">
                                                        <label class="control-label font-weight-bold">Taxes</label>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <input type="text" class="form-control" [(ngModel)]="paymentData.taxes" name="taxes">
                                                    </div>
                                                </div>
                                                <div class="row pt-1">
                                                    <div class="col-lg-6 text-right">
                                                        <label class="control-label font-weight-bold">Advance</label>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <input type="text" class="form-control" [(ngModel)]="paymentData.advance" name="advance">
                                                    </div>
                                                </div>
                                                <div class="row pt-1">
                                                    <div class="col-lg-6 text-right">
                                                        <label class="control-label font-weight-bold">Net
                                                            Payable</label>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <input type="text" class="form-control" [(ngModel)]="paymentData.finalAmount" name="finalAmount">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group row mt-4">
                                        <div class="col-lg-11 text-right">
                                            <button type="button" class="btn btn-default">Cancel</button>
                                            <button type="button" class="btn btn-success modal-with-form" *ngIf="!paymentID" (click)="addRecord()">Save</button>
                                            <button type="button" class="btn btn-success modal-with-form" *ngIf="paymentID" (click)="updateRecord()">Update</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </section>
    </div>
</section>

<div class="modal fade" id="payrollModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document" style="max-width: 500px;">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Update Trip Status</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <form>
                <div class="modal-body">
                    <div class="form-group row text-dark">
                        <div class="form-row">
                            <div class="form-group col-lg-6">
                                <label class="control-label font-weight-bold">Pay Period</label>
                                <select data-plugin-selectTwo class="form-control populate">
                                    <optgroup>
                                        <option value="1">Weekly</option>
                                        <option value="2">Monthly</option>
                                        <option value="2">Quaterly</option>
                                        <option value="2">Annually</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group col-lg-6">
                                <label class="control-label font-weight-bold">State</label>
                                <select data-plugin-selectTwo class="form-control populate">
                                    <optgroup>
                                        <option value="1">Alberta</option>
                                        <option value="2">British Columbia</option>
                                        <option value="2">Saskatchewan</option>
                                        <option value="1">Manitoba</option>
                                        <option value="2">Ontario</option>
                                        <option value="2">New Brunswick</option>
                                        <option value="2">Prince Edward Island</option>
                                        <option value="2">NFLD & Labrador</option>
                                        <option value="2">Yukon</option>
                                        <option value="2">Northwest Territories</option>
                                        <option value="2">Nunavut</option>
                                        <option value="2">Quebec</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-lg-12">
                                <label class="control-label font-weight-bold">Federal/Provincial Claim Code</label>
                                <select data-plugin-selectTwo class="form-control populate">
                                    <optgroup>
                                        <option value="0">Code 0 No claim amount</option>
                                        <option value="1">Code 1 12,069.00</option>
                                        <option value="2">Code 2 12,069.01 to 14,375.00</option>
                                        <option value="3">Code 3 14,375.01 to 16,681.00</option>
                                        <option value="4">Code 4 16,681.01 to 18,987.00</option>
                                        <option value="5">Code 5 18,987.01 to 21,293.00</option>
                                        <option value="6">Code 6 21,293.01 to 23,599.00</option>
                                        <option value="7">Code 7 23,599.01 to 25,905.00</option>
                                        <option value="8">Code 8 25,905.01 to 28,211.00</option>
                                        <option value="9">Code 9 28,211.01 to 30,517.00</option>
                                        <option value="10">Code 10 30,517.01 to 32,823.00</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-lg-6">
                                <label class="control-label font-weight-bold">Federal Tax</label>
                                <input type="text" class="form-control"> </div>
                            <div class="form-group col-lg-6">
                                <label class="control-label font-weight-bold">Provincial Tax</label>
                                <input type="text" class="form-control"> </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-lg-6">
                                <label class="control-label font-weight-bold">CPP (Canada Pension Plan)</label>
                                <input type="text" class="form-control"> </div>
                            <div class="form-group col-lg-6">
                                <label class="control-label font-weight-bold">EI (Employment Insurance)</label>
                                <input type="text" class="form-control"> </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>